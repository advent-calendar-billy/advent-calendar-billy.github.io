<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Fighter</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Finger+Paint&family=Patrick+Hand&family=Permanent+Marker&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="tournament-ui.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --paper: #f5f0e1;
            --ink: #333;
            --pencil: #666;
            --red: #e74c3c;
            --blue: #3498db;
            --yellow: #f1c40f;
            --green: #27ae60;
            --orange: #f39c12;
            --purple: #9b59b6;
        }

        body {
            background: var(--paper);
            background-image:
                linear-gradient(rgba(0,0,0,0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,0,0,0.03) 1px, transparent 1px);
            background-size: 25px 25px;
            font-family: 'Patrick Hand', cursive;
            color: var(--ink);
            min-height: 100vh;
            overflow: hidden;
        }

        /* ==================== CHARACTER SELECT ==================== */
        #character-select {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            padding: 20px;
        }

        #character-select h1 {
            font-family: 'Finger Paint', cursive;
            font-size: clamp(2rem, 5vw, 4rem);
            color: var(--ink);
            text-shadow: 3px 3px 0 var(--paper), 4px 4px 0 var(--ink);
            margin-bottom: 10px;
            transform: rotate(-2deg);
        }

        .subtitle {
            font-size: 1.2rem;
            color: var(--pencil);
            margin-bottom: 30px;
        }

        .character-grid {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 900px;
        }

        .char-card {
            width: 180px;
            padding: 15px;
            border: 4px solid var(--ink);
            border-radius: 12px;
            background: var(--paper);
            box-shadow: 6px 6px 0 var(--ink);
            cursor: pointer;
            transition: all 0.15s;
            text-align: center;
        }

        .char-card:hover {
            transform: translate(-3px, -3px);
            box-shadow: 9px 9px 0 var(--ink);
        }

        .char-card.pato { border-color: var(--orange); box-shadow: 6px 6px 0 var(--orange); }
        .char-card.billy { border-color: var(--blue); box-shadow: 6px 6px 0 var(--blue); }
        .char-card.jonas { border-color: var(--green); box-shadow: 6px 6px 0 var(--green); }
        .char-card.lucas { border-color: var(--purple); box-shadow: 6px 6px 0 var(--purple); }
        .char-card.jonasl { border-color: #8b4513; box-shadow: 6px 6px 0 #8b4513; }
        .char-card.vicky { border-color: #c41e3a; box-shadow: 6px 6px 0 #c41e3a; }
        .char-card.fede { border-color: #4a90d9; box-shadow: 6px 6px 0 #4a90d9; }
        .char-card.timo { border-color: #888; box-shadow: 6px 6px 0 #888; }
        .char-card.pancho { border-color: #2563eb; box-shadow: 6px 6px 0 #2563eb; }
        .char-card.madonna { border-color: #e91e8c; box-shadow: 6px 6px 0 #e91e8c; }
        .char-card.frank { border-color: #cc0033; box-shadow: 6px 6px 0 #cc0033; }
        .char-card.charly { border-color: #c0392b; box-shadow: 6px 6px 0 #c0392b; }
        .char-card.audrey { border-color: #228b22; box-shadow: 6px 6px 0 #228b22; }

        .char-card .preview {
            height: 120px;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            margin-bottom: 10px;
        }

        .char-card h3 {
            font-family: 'Finger Paint', cursive;
            font-size: 1.3rem;
        }

        .char-card.pato h3 { color: var(--orange); }
        .char-card.billy h3 { color: var(--blue); }
        .char-card.jonas h3 { color: var(--green); }
        .char-card.lucas h3 { color: var(--purple); }
        .char-card.jonasl h3 { color: #8b4513; }
        .char-card.vicky h3 { color: #c41e3a; }
        .char-card.fede h3 { color: #4a90d9; }
        .char-card.timo h3 { color: #888; }
        .char-card.pancho h3 { color: #2563eb; }
        .char-card.madonna h3 { color: #e91e8c; }
        .char-card.frank h3 { color: #cc0033; }
        .char-card.charly h3 { color: #c0392b; }
        .char-card.audrey h3 { color: #228b22; }

        .char-card .theme {
            font-size: 0.75rem;
            color: var(--pencil);
        }

        /* ==================== GAME ARENA ==================== */
        #game-arena {
            display: none;
            height: 100vh;
            flex-direction: column;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            border-bottom: 3px solid var(--ink);
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .player-info.right {
            flex-direction: row-reverse;
        }

        .player-name {
            font-family: 'Finger Paint', cursive;
            font-size: 1.4rem;
        }

        .health-bar {
            width: 200px;
            height: 25px;
            border: 3px solid var(--ink);
            border-radius: 12px;
            background: var(--paper);
            overflow: hidden;
        }

        .health-fill {
            height: 100%;
            background: var(--green);
            transition: width 0.3s;
        }

        .health-fill.low {
            background: var(--red);
        }

        .energy-bar {
            width: 150px;
            height: 12px;
            border: 2px solid var(--ink);
            border-radius: 6px;
            background: var(--paper);
            margin-top: 5px;
        }

        .energy-fill {
            height: 100%;
            background: var(--yellow);
            transition: width 0.2s;
        }

        .game-title {
            font-family: 'Finger Paint', cursive;
            font-size: 1.5rem;
        }

        .arena {
            flex: 1;
            position: relative;
            overflow: hidden;
            border: 4px solid var(--ink);
            margin: 15px;
            border-radius: 12px;
            background: var(--paper);
        }

        .ground-line {
            position: absolute;
            bottom: 60px;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--ink);
        }

        /* ==================== CONTROLS DISPLAY ==================== */
        .controls-display {
            display: flex;
            justify-content: space-between;
            padding: 10px 30px;
            border-top: 3px solid var(--ink);
            font-size: 0.85rem;
        }

        .control-group {
            display: flex;
            gap: 20px;
        }

        .key {
            display: inline-block;
            padding: 3px 8px;
            border: 2px solid var(--ink);
            border-radius: 5px;
            background: var(--paper);
            font-family: 'Permanent Marker', cursive;
            font-size: 0.75rem;
            margin: 0 3px;
        }

        .combo-display {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Patrick Hand', cursive;
            font-size: 0.9rem;
            color: var(--pencil);
            background: var(--paper);
            padding: 5px 15px;
            border: 2px solid var(--ink);
            border-radius: 20px;
        }

        /* ==================== BASE CHARACTER ==================== */
        .fighter {
            position: absolute;
            bottom: 68px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: left 0.05s linear;
            transform-origin: bottom center;
        }

        .fighter.facing-left {
            transform: scaleX(-1);
        }

        /* ==================== PATO ==================== */
        .pato .head {
            width: 40px;
            height: 48px;
            border: 2px solid var(--ink);
            border-radius: 40% 40% 45% 45%;
            background: var(--paper);
            position: relative;
            z-index: 10;
        }

        .pato .hair {
            position: absolute;
            top: -8px;
            left: 5px;
            width: 30px;
            height: 18px;
            border: 2px solid var(--ink);
            border-bottom: none;
            border-radius: 50% 50% 0 0;
            background: var(--paper);
        }

        .pato .eyes {
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
        }

        .pato .eye {
            width: 6px;
            height: 6px;
            background: var(--ink);
            border-radius: 50%;
        }

        .pato .mouth {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 10px;
            height: 5px;
            border: 2px solid var(--ink);
            border-top: none;
            border-radius: 0 0 50% 50%;
        }

        .pato .body {
            width: 48px;
            height: 48px;
            border: 2px solid var(--ink);
            border-radius: 6px;
            background: var(--paper);
            margin-top: -5px;
            position: relative;
            z-index: 5;
        }

        .pato .logo {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Finger Paint', cursive;
            font-size: 1.2rem;
            color: var(--orange);
            font-weight: bold;
        }

        .pato .arm {
            position: absolute;
            width: 10px;
            height: 32px;
            border: 2px solid var(--ink);
            border-radius: 5px;
            background: var(--paper);
            top: 6px;
            transform-origin: top center;
        }

        .pato .arm.left { left: -8px; }
        .pato .arm.right { right: -8px; }

        .pato .legs {
            display: flex;
            gap: 10px;
            margin-top: -3px;
            z-index: 1;
        }

        .pato .leg {
            width: 12px;
            height: 35px;
            border: 2px solid var(--ink);
            border-radius: 4px;
            background: var(--paper);
        }

        /* ==================== BILLY ==================== */
        .billy .head {
            width: 40px;
            height: 46px;
            border: 2px solid var(--ink);
            border-radius: 45%;
            background: var(--paper);
            position: relative;
            z-index: 10;
        }

        .billy .hair {
            position: absolute;
            top: -12px;
            left: -8px;
            width: 56px;
            height: 28px;
            border: 2px solid var(--ink);
            border-radius: 50%;
            background: var(--paper);
            z-index: -1;
        }

        .billy .glasses {
            position: absolute;
            top: 14px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 3px;
        }

        .billy .lens {
            width: 12px;
            height: 12px;
            border: 2px solid var(--ink);
            background: rgba(52, 152, 219, 0.15);
        }

        .billy .mouth {
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 12px;
            height: 2px;
            background: var(--ink);
        }

        .billy .body {
            width: 52px;
            height: 52px;
            border: 2px solid var(--ink);
            border-radius: 4px;
            background: var(--paper);
            margin-top: -5px;
            position: relative;
            z-index: 5;
        }

        .billy .equation {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Patrick Hand', cursive;
            font-size: 0.6rem;
            color: var(--blue);
        }

        .billy .arm {
            position: absolute;
            width: 10px;
            height: 30px;
            border: 2px solid var(--ink);
            border-radius: 5px;
            background: var(--paper);
            top: 6px;
            transform-origin: top center;
        }

        .billy .arm.left { left: -8px; }
        .billy .arm.right { right: -8px; }

        .billy .legs {
            display: flex;
            gap: 12px;
            margin-top: -3px;
            z-index: 1;
        }

        .billy .leg {
            width: 12px;
            height: 32px;
            border: 2px solid var(--ink);
            border-radius: 4px;
            background: var(--paper);
        }

        /* ==================== JONAS ==================== */
        .jonas .head {
            width: 40px;
            height: 44px;
            border: 2px solid var(--ink);
            border-radius: 40%;
            background: var(--paper);
            position: relative;
            z-index: 10;
        }

        .jonas .hair {
            position: absolute;
            top: -2px;
            left: 6px;
            width: 28px;
            height: 12px;
            border: 2px solid var(--ink);
            border-radius: 50% 50% 0 0;
            background: var(--ink);
        }

        .jonas .eyes {
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
        }

        .jonas .eye {
            width: 8px;
            height: 8px;
            border: 2px solid var(--ink);
            border-radius: 50%;
            background: var(--paper);
        }

        .jonas .mouth {
            position: absolute;
            bottom: 7px;
            left: 50%;
            transform: translateX(-50%);
            width: 16px;
            height: 8px;
            border: 2px solid var(--ink);
            border-radius: 0 0 50% 50%;
            border-top: none;
            background: var(--paper);
        }

        .jonas .body {
            width: 50px;
            height: 50px;
            border: 2px solid var(--ink);
            border-radius: 5px;
            background: var(--paper);
            margin-top: -5px;
            position: relative;
            z-index: 5;
        }

        .jonas .badge {
            position: absolute;
            bottom: 6px;
            left: 50%;
            transform: translateX(-50%);
            padding: 2px 5px;
            background: var(--green);
            color: #fff;
            border-radius: 2px;
            font-size: 0.4rem;
        }

        .jonas .arm {
            position: absolute;
            width: 10px;
            height: 30px;
            border: 2px solid var(--ink);
            border-radius: 5px;
            background: var(--paper);
            top: 5px;
            transform-origin: top center;
        }

        .jonas .arm.left { left: -8px; }
        .jonas .arm.right { right: -8px; }

        .jonas .legs {
            display: flex;
            gap: 10px;
            margin-top: -3px;
            z-index: 1;
        }

        .jonas .leg {
            width: 12px;
            height: 32px;
            border: 2px solid var(--ink);
            border-radius: 4px;
            background: #f5e6d3;
        }

        /* ==================== LUCAS ==================== */
        .lucas .head {
            width: 40px;
            height: 46px;
            border: 2px solid var(--ink);
            border-radius: 42%;
            background: var(--paper);
            position: relative;
            z-index: 10;
        }

        .lucas .hair {
            position: absolute;
            top: -6px;
            left: 4px;
            width: 32px;
            height: 16px;
            border: 2px solid var(--ink);
            border-bottom: none;
            border-radius: 50% 50% 0 0;
            background: var(--ink);
        }

        .lucas .eyes {
            position: absolute;
            top: 16px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
        }

        .lucas .eye {
            width: 6px;
            height: 6px;
            background: var(--ink);
            border-radius: 50%;
        }

        .lucas .mouth {
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 12px;
            height: 6px;
            border: 2px solid var(--ink);
            border-top: none;
            border-radius: 0 0 50% 50%;
        }

        .lucas .body {
            width: 50px;
            height: 50px;
            border: 2px solid var(--ink);
            border-radius: 5px;
            background: var(--paper);
            margin-top: -5px;
            position: relative;
            z-index: 5;
        }

        .lucas .jersey-num {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Finger Paint', cursive;
            font-size: 1.1rem;
            color: var(--purple);
        }

        .lucas .arm {
            position: absolute;
            width: 10px;
            height: 30px;
            border: 2px solid var(--ink);
            border-radius: 5px;
            background: var(--paper);
            top: 5px;
            transform-origin: top center;
        }

        .lucas .arm.left { left: -8px; }
        .lucas .arm.right { right: -8px; }

        .lucas .legs {
            display: flex;
            gap: 10px;
            margin-top: -3px;
            z-index: 1;
        }

        .lucas .leg {
            width: 12px;
            height: 35px;
            border: 2px solid var(--ink);
            border-radius: 4px;
            background: var(--paper);
            position: relative;
        }

        .lucas .sock {
            position: absolute;
            bottom: 0;
            left: -1px;
            right: -1px;
            height: 12px;
            background: var(--purple);
            border: 2px solid var(--ink);
            border-radius: 0 0 3px 3px;
        }

        /* ==================== JONAS L ==================== */
        .jonasl .head {
            width: 40px;
            height: 46px;
            border: 2px solid var(--ink);
            border-radius: 42%;
            background: var(--paper);
            position: relative;
            z-index: 10;
        }

        .jonasl .hair {
            position: absolute;
            top: -4px;
            left: 8px;
            width: 24px;
            height: 12px;
            border: 2px solid var(--ink);
            border-bottom: none;
            border-radius: 50% 50% 0 0;
            background: #5c4033;
        }

        .jonasl .eyes {
            position: absolute;
            top: 16px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
        }

        .jonasl .eye {
            width: 6px;
            height: 6px;
            background: var(--ink);
            border-radius: 50%;
        }

        .jonasl .mouth {
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 10px;
            height: 5px;
            border: 2px solid var(--ink);
            border-top: none;
            border-radius: 0 0 50% 50%;
        }

        .jonasl .body {
            width: 50px;
            height: 50px;
            border: 2px solid var(--ink);
            border-radius: 5px;
            background: #2c1810;
            margin-top: -5px;
            position: relative;
            z-index: 5;
        }

        .jonasl .arm {
            position: absolute;
            width: 10px;
            height: 30px;
            border: 2px solid var(--ink);
            border-radius: 5px;
            background: #2c1810;
            top: 5px;
            transform-origin: top center;
        }

        .jonasl .arm.left { left: -8px; }
        .jonasl .arm.right { right: -8px; }

        .jonasl .legs {
            display: flex;
            gap: 10px;
            margin-top: -3px;
            z-index: 1;
        }

        .jonasl .leg {
            width: 12px;
            height: 35px;
            border: 2px solid var(--ink);
            border-radius: 4px;
            background: #1a1a2e;
        }

        /* Bass guitar on back */
        .jonasl .bass {
            position: absolute;
            left: -25px;
            top: 5px;
            z-index: 3;
            transform: rotate(-20deg);
        }

        .jonasl .bass-neck {
            position: absolute;
            width: 8px;
            height: 55px;
            background: #5c4033;
            border: 2px solid var(--ink);
            border-radius: 2px;
            top: -30px;
            left: 12px;
        }

        .jonasl .bass-body {
            width: 35px;
            height: 45px;
            background: #8b4513;
            border: 3px solid var(--ink);
            border-radius: 30% 30% 40% 40%;
            position: relative;
        }

        .jonasl .bass-strings {
            position: absolute;
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
            width: 12px;
            height: 60px;
            background: repeating-linear-gradient(
                90deg,
                transparent 0px,
                transparent 2px,
                #ccc 2px,
                #ccc 3px
            );
        }

        /* Bass damage states */
        .jonasl .bass.damage-1 .bass-body { background: #7a3c10; }
        .jonasl .bass.damage-2 .bass-body {
            background: #6a2c08;
            border-style: dashed;
        }
        .jonasl .bass.damage-3 .bass-body {
            background: #5a1c00;
            border-style: dashed;
        }
        .jonasl .bass.damage-3::after {
            content: '';
            position: absolute;
            top: 20px;
            left: 10px;
            width: 15px;
            height: 2px;
            background: var(--ink);
            transform: rotate(45deg);
        }
        .jonasl .bass.damage-4 .bass-body {
            background: #4a0c00;
            border-color: var(--red);
        }
        .jonasl .bass.damage-4::after {
            content: '';
            position: absolute;
            top: 15px;
            left: 8px;
            width: 20px;
            height: 2px;
            background: var(--ink);
            transform: rotate(30deg);
        }
        .jonasl .bass.damage-4::before {
            content: '';
            position: absolute;
            top: 25px;
            left: 5px;
            width: 18px;
            height: 2px;
            background: var(--ink);
            transform: rotate(-20deg);
        }

        /* Coffee mug */
        .jonasl .coffee-mug {
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 12px;
            height: 14px;
            background: #fff;
            border: 2px solid var(--ink);
            border-radius: 0 0 3px 3px;
        }

        .jonasl .coffee-mug::after {
            content: '';
            position: absolute;
            right: -6px;
            top: 2px;
            width: 5px;
            height: 8px;
            border: 2px solid var(--ink);
            border-left: none;
            border-radius: 0 50% 50% 0;
        }

        /* ==================== VICKY - Christmas Bride ==================== */
        .vicky .head {
            width: 36px;
            height: 38px;
            border: 2px solid var(--ink);
            border-radius: 50%;
            background: var(--paper);
            position: relative;
            z-index: 10;
        }

        .vicky .hair {
            position: absolute;
            top: -5px;
            left: -6px;
            width: 48px;
            height: 28px;
            border: 2px solid var(--ink);
            border-bottom: none;
            border-radius: 50% 50% 0 0;
            background: #5c4033;
            z-index: 5;
        }

        .vicky .hair-left {
            position: absolute;
            top: 16px;
            left: -8px;
            width: 10px;
            height: 38px;
            background: #5c4033;
            border: 2px solid var(--ink);
            border-top: none;
            border-radius: 0 0 40% 40%;
            z-index: 4;
        }

        .vicky .hair-right {
            position: absolute;
            top: 16px;
            right: -8px;
            width: 10px;
            height: 38px;
            background: #5c4033;
            border: 2px solid var(--ink);
            border-top: none;
            border-radius: 0 0 40% 40%;
            z-index: 4;
        }

        .vicky .eyes {
            position: absolute;
            top: 12px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            z-index: 15;
        }

        .vicky .eye {
            width: 8px;
            height: 5px;
            background: transparent;
            border-top: 3px solid var(--ink);
            border-radius: 50% 50% 0 0;
        }

        .vicky .mouth {
            position: absolute;
            bottom: 6px;
            left: 50%;
            transform: translateX(-50%);
            width: 12px;
            height: 6px;
            border: 2px solid var(--ink);
            border-top: none;
            border-radius: 0 0 50% 50%;
            background: rgba(255,150,150,0.3);
            z-index: 15;
        }

        .vicky .blush {
            position: absolute;
            top: 18px;
            width: 7px;
            height: 4px;
            background: rgba(255, 150, 170, 0.5);
            border-radius: 50%;
            z-index: 14;
        }

        .vicky .blush.left { left: 3px; }
        .vicky .blush.right { right: 3px; }

        .vicky .body {
            width: 32px;
            height: 28px;
            border: 2px solid var(--ink);
            border-radius: 3px 3px 0 0;
            background: #fffafa;
            margin-top: -3px;
            position: relative;
            z-index: 8;
        }

        .vicky .bow {
            position: absolute;
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
            width: 12px;
            height: 6px;
            z-index: 9;
        }

        .vicky .bow::before,
        .vicky .bow::after {
            content: '';
            position: absolute;
            width: 6px;
            height: 6px;
            background: #c41e3a;
            border: 1px solid var(--ink);
            border-radius: 50% 50% 50% 0;
        }

        .vicky .bow::before {
            left: 0;
            transform: rotate(-45deg);
        }

        .vicky .bow::after {
            right: 0;
            transform: rotate(45deg);
        }

        .vicky .bow-center {
            position: absolute;
            top: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 3px;
            height: 3px;
            background: #c41e3a;
            border: 1px solid var(--ink);
            border-radius: 50%;
            z-index: 10;
        }

        .vicky .arm {
            position: absolute;
            width: 7px;
            height: 22px;
            border: 2px solid var(--ink);
            border-radius: 4px;
            background: var(--paper);
            top: 3px;
            transform-origin: top center;
            z-index: 6;
        }

        .vicky .arm.left { left: -5px; }
        .vicky .arm.right { right: -5px; }

        .vicky .skirt {
            width: 50px;
            height: 45px;
            border: 2px solid var(--ink);
            border-top: none;
            background: #fffafa;
            margin-top: -2px;
            position: relative;
            z-index: 4;
            clip-path: polygon(20% 0%, 80% 0%, 100% 100%, 0% 100%);
        }

        .vicky .feet {
            display: flex;
            gap: 8px;
            margin-top: -2px;
            z-index: 3;
        }

        .vicky .foot {
            width: 10px;
            height: 5px;
            border: 2px solid var(--ink);
            border-radius: 50%;
            background: #fffafa;
        }

        /* ==================== FEDE - Globetrotting Gentleman ==================== */
        .fede .head {
            width: 30px;
            height: 32px;
            border: 2px solid var(--ink);
            border-radius: 50%;
            background: var(--paper);
            position: relative;
            z-index: 10;
        }

        .fede .hair {
            position: absolute;
            top: -2px;
            left: 2px;
            width: 26px;
            height: 14px;
            border: 2px solid var(--ink);
            border-bottom: none;
            border-radius: 50% 50% 0 0;
            background: #1a1a1a;
            z-index: 15;
        }

        .fede .eyes {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 6px;
            z-index: 16;
        }

        .fede .eye {
            width: 5px;
            height: 5px;
            background: var(--ink);
            border-radius: 50%;
        }

        .fede .mouth {
            position: absolute;
            bottom: 7px;
            left: 50%;
            transform: translateX(-50%);
            width: 8px;
            height: 4px;
            border: 2px solid var(--ink);
            border-top: none;
            border-radius: 0 0 50% 50%;
            z-index: 16;
        }

        .fede .body {
            width: 28px;
            height: 30px;
            border: 2px solid var(--ink);
            border-radius: 3px 3px 0 0;
            background: #4a90d9;
            margin-top: -3px;
            position: relative;
            z-index: 8;
        }

        .fede .collar-left,
        .fede .collar-right {
            position: absolute;
            top: 0;
            width: 8px;
            height: 10px;
            background: #4a90d9;
            border: 2px solid var(--ink);
            z-index: 9;
        }

        .fede .collar-left {
            left: 2px;
            border-radius: 0 0 0 50%;
            border-right: none;
            transform: rotate(-15deg);
            transform-origin: top right;
        }

        .fede .collar-right {
            right: 2px;
            border-radius: 0 0 50% 0;
            border-left: none;
            transform: rotate(15deg);
            transform-origin: top left;
        }

        .fede .buttons {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            gap: 5px;
            z-index: 10;
        }

        .fede .button {
            width: 4px;
            height: 4px;
            background: #ddd;
            border: 1px solid var(--ink);
            border-radius: 50%;
        }

        .fede .arm {
            position: absolute;
            width: 7px;
            height: 22px;
            border: 2px solid var(--ink);
            border-radius: 4px;
            background: #4a90d9;
            top: 3px;
            transform-origin: top center;
            z-index: 6;
        }

        .fede .arm.left { left: -5px; }
        .fede .arm.right { right: -5px; }

        .fede .legs {
            display: flex;
            gap: 4px;
            margin-top: -2px;
            z-index: 4;
            transition: gap 0.15s;
        }

        .fede .leg {
            width: 10px;
            height: 35px;
            border: 2px solid var(--ink);
            border-radius: 3px;
            background: #2c3e50;
            transform-origin: top center;
            transition: transform 0.15s, height 0.15s;
        }

        .fede .feet {
            display: flex;
            gap: 4px;
            margin-top: -2px;
            z-index: 3;
            transition: gap 0.15s;
        }

        .fede .foot {
            width: 12px;
            height: 5px;
            border: 2px solid var(--ink);
            border-radius: 3px 5px 3px 3px;
            background: #1a1a1a;
        }

        /* Fede leg reset - ensure normal state when not in split */
        .fede .leg {
            position: relative;
            left: auto;
            right: auto;
            top: auto;
            width: 14px;
            height: 30px;
            transform: rotate(0deg);
            animation: none;
        }

        .fede .leg::after {
            content: none;
        }

        .fede.kicking .leg.right {
            animation: kick 0.25s ease-out;
            transform-origin: top center;
        }

        /* Fede split animation - dramatic extending legs at ground level */
        .fede.split {
            animation: splitDrop 0.25s ease-out forwards;
        }

        @keyframes splitDrop {
            0% { transform: translateY(0); }
            100% { transform: translateY(55px); }
        }

        .fede.split .body {
            /* Body drops down during split */
        }

        .fede.split .legs {
            position: absolute;
            bottom: -55px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: row;
            gap: 0;
            align-items: center;
            justify-content: center;
            width: auto;
            z-index: 3;
        }

        .fede.split .leg.left {
            position: relative;
            width: 90px;
            height: 14px;
            background: #2c3e50;
            border: 2px solid var(--ink);
            border-radius: 4px 8px 8px 4px;
            transform-origin: right center;
            animation: legExtendLeft 0.2s ease-out forwards;
            margin-right: -5px;
        }

        .fede.split .leg.right {
            position: relative;
            width: 90px;
            height: 14px;
            background: #2c3e50;
            border: 2px solid var(--ink);
            border-radius: 8px 4px 4px 8px;
            transform-origin: left center;
            animation: legExtendRight 0.2s ease-out forwards;
            margin-left: -5px;
        }

        @keyframes legExtendLeft {
            0% { width: 20px; }
            100% { width: 90px; }
        }

        @keyframes legExtendRight {
            0% { width: 20px; }
            100% { width: 90px; }
        }

        /* Shoes at the end of each leg */
        .fede.split .leg.left::after {
            content: '';
            position: absolute;
            left: -2px;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            height: 12px;
            background: #333;
            border: 2px solid var(--ink);
            border-radius: 6px 2px 2px 6px;
        }

        .fede.split .leg.right::after {
            content: '';
            position: absolute;
            right: -2px;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            height: 12px;
            background: #333;
            border: 2px solid var(--ink);
            border-radius: 2px 6px 6px 2px;
        }

        .fede.split .feet {
            display: none;
        }

        @keyframes splitTextPop {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes shockwaveExpand {
            0% { transform: scaleX(0.3); opacity: 1; }
            100% { transform: scaleX(1); opacity: 0; }
        }

        /* ==================== TIMO - The Perpetual Complainer ==================== */
        .timo .head {
            width: 40px;
            height: 42px;
            border: 2px solid var(--ink);
            border-radius: 50%;
            background: var(--paper);
            position: relative;
            z-index: 10;
        }

        .timo .hair {
            position: absolute;
            top: -8px;
            left: -4px;
            width: 48px;
            height: 20px;
            border: 2px solid var(--ink);
            border-bottom: none;
            border-radius: 50% 50% 0 0;
            background: #4a3728;
            z-index: 5;
        }

        .timo .hair::before {
            content: '';
            position: absolute;
            top: -5px;
            left: 10px;
            width: 8px;
            height: 10px;
            background: #4a3728;
            border: 2px solid var(--ink);
            border-bottom: none;
            border-radius: 50% 50% 0 0;
            transform: rotate(-15deg);
        }

        .timo .hair::after {
            content: '';
            position: absolute;
            top: -3px;
            right: 12px;
            width: 6px;
            height: 8px;
            background: #4a3728;
            border: 2px solid var(--ink);
            border-bottom: none;
            border-radius: 50% 50% 0 0;
            transform: rotate(20deg);
        }

        .timo .eyes {
            position: absolute;
            top: 14px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 15;
        }

        .timo .eye {
            width: 8px;
            height: 3px;
            background: var(--ink);
            border-radius: 0;
            position: relative;
        }

        .timo .eye::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: -1px;
            width: 10px;
            height: 3px;
            border-bottom: 1px solid var(--pencil);
            border-radius: 0 0 50% 50%;
            opacity: 0.5;
        }

        .timo .mouth {
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 10px;
            height: 5px;
            border: 2px solid var(--ink);
            border-bottom: none;
            border-radius: 50% 50% 0 0;
            background: transparent;
            z-index: 15;
        }

        .timo .drool-drop {
            position: absolute;
            bottom: 2px;
            left: 18px;
            width: 4px;
            height: 8px;
            background: #a8d4e6;
            border: 1px solid var(--ink);
            border-radius: 50% 50% 50% 50% / 30% 30% 70% 70%;
            z-index: 16;
            animation: droolBob 1.5s ease-in-out infinite;
        }

        @keyframes droolBob {
            0%, 100% { transform: translateY(0) scaleY(1); }
            50% { transform: translateY(2px) scaleY(1.1); }
        }

        .timo .body {
            width: 36px;
            height: 32px;
            border: 2px solid var(--ink);
            border-radius: 5px 5px 0 0;
            background: #666;
            margin-top: -3px;
            position: relative;
            z-index: 8;
        }

        .timo .body::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 8px;
            width: 20px;
            height: 1px;
            background: var(--pencil);
            opacity: 0.4;
        }

        .timo .arm {
            position: absolute;
            width: 8px;
            height: 24px;
            border: 2px solid var(--ink);
            border-radius: 4px;
            background: var(--paper);
            top: 3px;
            transform-origin: top center;
            z-index: 6;
        }

        .timo .arm.left {
            left: -6px;
            transform: rotate(5deg);
        }

        .timo .arm.right {
            right: -6px;
            transform: rotate(-5deg);
        }

        .timo .pants {
            width: 38px;
            height: 35px;
            border: 2px solid var(--ink);
            border-top: none;
            background: #444;
            margin-top: -2px;
            position: relative;
            z-index: 4;
            border-radius: 0 0 5px 5px;
        }

        .timo .pants::before,
        .timo .pants::after {
            content: '';
            position: absolute;
            bottom: -12px;
            width: 14px;
            height: 14px;
            background: #444;
            border: 2px solid var(--ink);
            border-top: none;
            border-radius: 0 0 4px 4px;
        }

        .timo .pants::before { left: 3px; }
        .timo .pants::after { right: 3px; }

        .timo .feet {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            z-index: 3;
        }

        .timo .foot {
            width: 12px;
            height: 5px;
            border: 2px solid var(--ink);
            border-radius: 50%;
            background: #333;
        }

        .timo .flag-pole {
            position: absolute;
            right: -20px;
            top: 5px;
            width: 3px;
            height: 50px;
            background: #8b4513;
            border: 1px solid var(--ink);
            transform-origin: bottom center;
            z-index: 7;
        }

        .timo .flag {
            position: absolute;
            top: 0;
            left: 3px;
            width: 35px;
            height: 22px;
            background: #009ee0;
            border: 1px solid var(--ink);
            z-index: 7;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .timo .flag::before {
            content: 'AfD';
            position: absolute;
            font-family: 'Arial Black', sans-serif;
            font-size: 9px;
            font-weight: bold;
            color: #e30613;
            text-shadow: 0 0 1px #fff;
            letter-spacing: -0.5px;
        }

        .timo.drooling .drool-drop {
            animation: droolHeavy 0.5s ease-in-out;
        }

        @keyframes droolHeavy {
            0% { transform: scaleY(1); }
            50% { transform: scaleY(2); }
            100% { transform: scaleY(1); }
        }

        .timo.complaining .mouth {
            animation: yap 0.15s infinite;
        }

        @keyframes yap {
            0%, 100% { height: 5px; }
            50% { height: 8px; }
        }

        .timo.waving-flag .flag-pole {
            animation: waveFlag 0.3s ease-in-out infinite;
        }

        @keyframes waveFlag {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }

        @keyframes spinStun {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        /* ==================== PANCHO - The Tech Superman ==================== */
        .pancho .head {
            width: 38px;
            height: 40px;
            border: 3px solid var(--ink);
            border-radius: 50%;
            background: var(--paper);
            position: relative;
            z-index: 10;
        }

        .pancho .hair {
            position: absolute;
            top: -2px;
            left: 2px;
            right: 2px;
            height: 18px;
            background: #1a1a1a;
            border: 2px solid var(--ink);
            border-radius: 50% 50% 0 0;
            z-index: 11;
        }

        .pancho .hair::before {
            content: '';
            position: absolute;
            top: 8px;
            left: 3px;
            width: 6px;
            height: 8px;
            background: #1a1a1a;
            border-radius: 0 0 3px 3px;
        }

        .pancho .eyes {
            position: absolute;
            top: 14px;
            left: 6px;
            right: 6px;
            display: flex;
            justify-content: space-between;
        }

        .pancho .eye {
            width: 8px;
            height: 8px;
            background: white;
            border: 2px solid var(--ink);
            border-radius: 50%;
            position: relative;
        }

        .pancho .eye::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 3px;
            height: 3px;
            background: #1a1a1a;
            border-radius: 50%;
        }

        .pancho .mouth {
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 10px;
            height: 4px;
            border: 2px solid var(--ink);
            border-top: none;
            border-radius: 0 0 10px 10px;
            background: #ff9999;
        }

        .pancho .body {
            width: 42px;
            height: 45px;
            border: 3px solid var(--ink);
            border-radius: 8px;
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            margin-top: -5px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .pancho .body .logo {
            font-family: 'Permanent Marker', cursive;
            font-size: 18px;
            color: #fbbf24;
            text-shadow: 1px 1px 0 var(--ink);
        }

        .pancho .arm {
            position: absolute;
            width: 12px;
            height: 35px;
            border: 3px solid var(--ink);
            border-radius: 6px;
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
        }

        .pancho .arm.left {
            left: -12px;
            top: 5px;
            transform: rotate(15deg);
        }

        .pancho .arm.right {
            right: -12px;
            top: 5px;
            transform: rotate(-15deg);
        }

        .pancho .cape {
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 55px;
            height: 70px;
            background: linear-gradient(180deg,
                #ef4444 0%,
                #dc2626 20%,
                #b91c1c 60%,
                #991b1b 100%);
            border: 2px solid var(--ink);
            border-radius: 8px 8px 35px 35px;
            z-index: -1;
            transform-origin: top center;
            box-shadow: -3px 0 8px rgba(0,0,0,0.3), 3px 0 8px rgba(0,0,0,0.3);
        }

        .pancho .cape::before {
            content: '';
            position: absolute;
            top: 0;
            left: 5px;
            right: 5px;
            height: 8px;
            background: linear-gradient(180deg, #fcd34d, #f59e0b);
            border: 2px solid var(--ink);
            border-radius: 3px;
        }

        /* Keep cape visible during all actions */
        .pancho.punching .cape,
        .pancho.kicking .cape,
        .pancho.laser-eyes .cape,
        .pancho.flying .cape,
        .pancho .cape {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }

        .pancho.punching .cape {
            animation: capeSwish 0.2s ease-out;
        }

        .pancho.kicking .cape {
            animation: capeSwish 0.25s ease-out;
        }

        .pancho.laser-eyes .cape {
            animation: capeDramatic 0.5s ease-in-out infinite alternate;
        }

        @keyframes capeDramatic {
            0% { transform: translateX(-50%) rotate(-5deg) scale(1); }
            100% { transform: translateX(-50%) rotate(5deg) scale(1.05); }
        }

        @keyframes capeSwish {
            0% { transform: translateX(-50%) rotate(0deg); }
            50% { transform: translateX(-50%) rotate(10deg); }
            100% { transform: translateX(-50%) rotate(0deg); }
        }

        @keyframes heatTextPulse {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.1); opacity: 0.9; }
        }

        .pancho .legs {
            display: flex;
            gap: 6px;
            margin-top: -3px;
        }

        .pancho .leg {
            width: 14px;
            height: 35px;
            border: 3px solid var(--ink);
            border-radius: 5px;
            background: #1e3a5f;
        }

        .pancho.flying {
            animation: fly 0.3s ease-in-out infinite alternate;
        }

        .pancho.flying .cape {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            animation: capeFlutter 0.2s ease-in-out infinite alternate;
        }

        .pancho.laser-eyes .eye::after {
            background: #ff0000;
            box-shadow: 0 0 8px #ff0000, 0 0 15px #ff4444;
        }

        @keyframes fly {
            0% { transform: translateY(0) rotate(-5deg); }
            100% { transform: translateY(-10px) rotate(5deg); }
        }

        @keyframes capeFlutter {
            0% { transform: translateX(-50%) skewX(-5deg); }
            100% { transform: translateX(-50%) skewX(5deg); }
        }

        @keyframes attack {
            0% { transform: translateX(0); }
            30% { transform: translateX(10px) rotate(-5deg); }
            60% { transform: translateX(15px); }
            100% { transform: translateX(0); }
        }

        @keyframes laserBeam {
            0% { opacity: 1; width: 0; }
            50% { opacity: 1; }
            100% { opacity: 0.8; width: 100%; }
        }

        @keyframes freezeBreath {
            0% { transform: scaleX(0); opacity: 0.8; }
            100% { transform: scaleX(1); opacity: 0.3; }
        }

        @keyframes burning {
            0%, 100% {
                filter: brightness(1.2) saturate(1.5);
                box-shadow: 0 0 20px rgba(255, 100, 0, 0.8);
            }
            50% {
                filter: brightness(1.5) saturate(2) hue-rotate(-10deg);
                box-shadow: 0 0 40px rgba(255, 50, 0, 1), 0 0 60px rgba(255, 150, 0, 0.5);
            }
        }

        .npc-dummy.burning {
            animation: burning 0.2s ease-in-out infinite;
            background: linear-gradient(to top, rgba(255, 100, 0, 0.3), transparent);
        }

        .npc-dummy.frozen {
            filter: brightness(1.3) saturate(0.3) hue-rotate(180deg);
            animation: none;
        }

        .npc-dummy.frozen::after {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            border: 4px solid #87ceeb;
            border-radius: 10px;
            background: rgba(135, 206, 235, 0.2);
            pointer-events: none;
        }

        /* ==================== MADONNA - Material Girl ==================== */
        .madonna .head {
            width: 28px;
            height: 30px;
            border: 2px solid var(--ink);
            border-radius: 50%;
            background: var(--paper);
            position: relative;
            z-index: 10;
        }

        .madonna .hair {
            position: absolute;
            top: -6px;
            left: -8px;
            width: 44px;
            height: 35px;
            border: 2px solid var(--ink);
            border-radius: 50% 50% 40% 40%;
            background: #f4d03f;
            z-index: 5;
        }

        .madonna .hair::before,
        .madonna .hair::after {
            content: '';
            position: absolute;
            top: 20px;
            width: 15px;
            height: 20px;
            border: 2px solid var(--ink);
            background: #f4d03f;
        }

        .madonna .hair::before {
            left: -4px;
            border-top: none;
            border-right: none;
            border-radius: 0 0 0 50%;
        }

        .madonna .hair::after {
            right: -4px;
            border-top: none;
            border-left: none;
            border-radius: 0 0 50% 0;
        }

        .madonna .hair-highlight {
            position: absolute;
            top: 2px;
            left: 8px;
            width: 20px;
            height: 10px;
            background: rgba(255,255,255,0.4);
            border-radius: 50%;
            z-index: 6;
        }

        .madonna .eyes {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 6px;
            z-index: 16;
        }

        .madonna .eye {
            width: 5px;
            height: 5px;
            background: var(--ink);
            border-radius: 50%;
        }

        .madonna .mouth {
            position: absolute;
            bottom: 6px;
            left: 50%;
            transform: translateX(-50%);
            width: 8px;
            height: 4px;
            background: #e74c3c;
            border: 1px solid var(--ink);
            border-radius: 0 0 50% 50%;
            z-index: 16;
        }

        .madonna .beauty-mark {
            position: absolute;
            bottom: 10px;
            right: 6px;
            width: 3px;
            height: 3px;
            background: var(--ink);
            border-radius: 50%;
            z-index: 17;
        }

        .madonna .body {
            width: 26px;
            height: 28px;
            border: 2px solid var(--ink);
            border-radius: 3px 3px 0 0;
            background: #e91e8c;
            margin-top: -3px;
            position: relative;
            z-index: 8;
        }

        .madonna .cone-left,
        .madonna .cone-right {
            position: absolute;
            top: 3px;
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-bottom: 10px solid #c2185b;
            z-index: 9;
        }

        .madonna .cone-left { left: 1px; transform: rotate(-10deg); }
        .madonna .cone-right { right: 1px; transform: rotate(10deg); }

        .madonna .belt {
            position: absolute;
            bottom: 0;
            left: -1px;
            right: -1px;
            height: 5px;
            background: #ffd700;
            border: 1px solid var(--ink);
            z-index: 10;
        }

        .madonna .arm {
            position: absolute;
            width: 6px;
            height: 20px;
            border: 2px solid var(--ink);
            border-radius: 3px;
            background: var(--paper);
            top: 3px;
        }

        .madonna .arm.left { left: -8px; transform: rotate(15deg); }
        .madonna .arm.right { right: -8px; transform: rotate(-15deg); }

        .madonna .legs {
            display: flex;
            gap: 4px;
            margin-top: -2px;
        }

        .madonna .leg {
            width: 8px;
            height: 25px;
            border: 2px solid var(--ink);
            border-radius: 3px;
            background: var(--paper);
        }

        .madonna .feet {
            display: flex;
            gap: 6px;
        }

        .madonna .foot {
            width: 10px;
            height: 8px;
            border: 2px solid var(--ink);
            border-radius: 2px;
            background: #1a1a1a;
        }

        /* ==================== FRANK - Dr. Frank-N-Furter ==================== */
        .frank .head {
            width: 34px;
            height: 38px;
            border: 2px solid var(--ink);
            border-radius: 50%;
            background: var(--paper);
            position: relative;
            z-index: 10;
        }

        .frank .hair {
            position: absolute;
            top: -8px;
            left: -6px;
            width: 46px;
            height: 30px;
            border: 2px solid var(--ink);
            border-radius: 50%;
            background: #1a1a1a;
            z-index: 5;
        }

        .frank .hair::before {
            content: '';
            position: absolute;
            top: 12px;
            left: 5px;
            width: 36px;
            height: 20px;
            border: 2px solid var(--ink);
            border-top: none;
            border-radius: 0 0 50% 50%;
            background: #1a1a1a;
        }

        .frank .eyes {
            position: absolute;
            top: 14px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            z-index: 16;
        }

        .frank .eye {
            width: 8px;
            height: 6px;
            background: #2d4a6f;
            border: 1px solid var(--ink);
            border-radius: 50%;
        }

        .frank .mouth {
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 16px;
            height: 6px;
            background: #cc0033;
            border: 2px solid var(--ink);
            border-radius: 0 0 50% 50%;
            z-index: 16;
        }

        .frank .beauty-mark {
            position: absolute;
            bottom: 12px;
            left: 8px;
            width: 3px;
            height: 3px;
            background: var(--ink);
            border-radius: 50%;
            z-index: 17;
        }

        .frank .pearls {
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 6px;
            background: repeating-linear-gradient(90deg, #f5f5f0 0px, #f5f5f0 5px, transparent 5px, transparent 7px);
            z-index: 11;
        }

        .frank .body {
            width: 28px;
            height: 30px;
            border: 2px solid var(--ink);
            border-radius: 3px;
            background: #1a1a1a;
            margin-top: -3px;
            position: relative;
            z-index: 8;
        }

        .frank .body::before {
            content: '';
            position: absolute;
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 20px;
            background: repeating-linear-gradient(180deg, #cc0033 0px, #cc0033 3px, transparent 3px, transparent 5px);
        }

        .frank .arm {
            position: absolute;
            width: 6px;
            height: 22px;
            border: 2px solid var(--ink);
            border-radius: 3px;
            background: var(--paper);
            top: 3px;
        }

        .frank .arm.left { left: -8px; transform: rotate(15deg); }
        .frank .arm.right { right: -8px; transform: rotate(-15deg); }

        .frank .legs {
            display: flex;
            gap: 4px;
            margin-top: -2px;
        }

        .frank .leg {
            width: 8px;
            height: 28px;
            border: 2px solid var(--ink);
            border-radius: 3px;
            background: repeating-linear-gradient(45deg, #2a2a2a 0px, #2a2a2a 2px, var(--paper) 2px, var(--paper) 4px);
        }

        .frank .feet {
            display: flex;
            gap: 8px;
        }

        .frank .foot {
            width: 10px;
            height: 12px;
            border: 2px solid var(--ink);
            border-radius: 2px 2px 4px 4px;
            background: #1a1a1a;
            position: relative;
        }

        .frank .foot::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 2px;
            width: 3px;
            height: 6px;
            background: #cc0033;
            border-radius: 2px;
        }

        /* ==================== CHARLY - Biker ==================== */
        .fighter.charly {
            width: 100px;
            height: 70px;
        }

        .fighter.charly .motorbike {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 80px;
            height: 40px;
        }

        .fighter.charly .wheel {
            position: absolute;
            bottom: 0;
            width: 22px;
            height: 22px;
            border: 3px solid var(--ink);
            border-radius: 50%;
            background: #333;
        }

        .fighter.charly .wheel.back { left: 5px; }
        .fighter.charly .wheel.front { right: 5px; }

        .fighter.charly .wheel::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            border: 2px solid #666;
            border-radius: 50%;
            background: #888;
        }

        .fighter.charly .bike-body {
            position: absolute;
            bottom: 10px;
            left: 15px;
            width: 50px;
            height: 18px;
            background: linear-gradient(180deg, #c0392b 0%, #922b21 100%);
            border: 2px solid var(--ink);
            border-radius: 5px 15px 3px 3px;
        }

        .fighter.charly .exhaust {
            position: absolute;
            bottom: 8px;
            left: 0;
            width: 15px;
            height: 6px;
            background: #bdc3c7;
            border: 2px solid var(--ink);
            border-radius: 3px;
        }

        .fighter.charly .headlight {
            position: absolute;
            bottom: 15px;
            right: 2px;
            width: 8px;
            height: 8px;
            background: #f1c40f;
            border: 2px solid var(--ink);
            border-radius: 50%;
        }

        .fighter.charly .rider {
            position: absolute;
            bottom: 25px;
            left: 25px;
        }

        .fighter.charly .rider .head {
            width: 20px;
            height: 22px;
            border: 2px solid var(--ink);
            border-radius: 50%;
            background: var(--paper);
            position: relative;
        }

        .fighter.charly .rider .hair {
            position: absolute;
            top: -4px;
            left: -2px;
            width: 24px;
            height: 14px;
            background: #1a1a1a;
            border: 2px solid var(--ink);
            border-radius: 50%;
            z-index: 5;
        }

        .fighter.charly .rider .beard {
            position: absolute;
            bottom: -2px;
            left: 2px;
            width: 16px;
            height: 8px;
            background: #1a1a1a;
            border: 1px solid var(--ink);
            border-radius: 0 0 50% 50%;
        }

        .fighter.charly .rider .eyes {
            position: absolute;
            top: 8px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 4px;
        }

        .fighter.charly .rider .eye {
            width: 3px;
            height: 3px;
            background: var(--ink);
            border-radius: 50%;
        }

        .fighter.charly .rider .body {
            width: 22px;
            height: 20px;
            background: #2c3e50;
            border: 2px solid var(--ink);
            border-radius: 3px;
            margin-top: -3px;
        }

        .fighter.charly .rider .arm {
            position: absolute;
            width: 5px;
            height: 15px;
            border: 2px solid var(--ink);
            border-radius: 3px;
            background: #2c3e50;
            top: 22px;
        }

        .fighter.charly .rider .arm.left { left: -6px; transform: rotate(30deg); }
        .fighter.charly .rider .arm.right { right: -6px; transform: rotate(-30deg); }

        /* ==================== AUDREY II - Man-Eating Plant ==================== */
        .fighter.audrey {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .fighter.audrey .pot {
            width: 40px;
            height: 30px;
            background: linear-gradient(to bottom, #8b4513 0%, #5c3317 100%);
            border: 3px solid var(--ink);
            border-radius: 5px 5px 8px 8px;
            position: relative;
            z-index: 5;
        }

        .fighter.audrey .pot-rim {
            position: absolute;
            top: -6px;
            left: -5px;
            width: 50px;
            height: 10px;
            background: #8b4513;
            border: 2px solid var(--ink);
            border-radius: 3px;
            z-index: 6;
        }

        .fighter.audrey .stem {
            width: 12px;
            height: 35px;
            background: linear-gradient(90deg, #1a6b1a 0%, #228b22 50%, #1a6b1a 100%);
            border: 2px solid var(--ink);
            border-radius: 6px;
            position: absolute;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 4;
        }

        .fighter.audrey .head {
            width: 55px;
            height: 50px;
            position: absolute;
            bottom: 55px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
        }

        .fighter.audrey .upper-jaw {
            position: absolute;
            width: 55px;
            height: 28px;
            background: linear-gradient(to bottom, #228b22 0%, #1a6b1a 100%);
            border: 3px solid var(--ink);
            border-radius: 50% 50% 0 0;
            top: 0;
            transform-origin: bottom center;
            z-index: 12;
        }

        .fighter.audrey .spot {
            position: absolute;
            background: #32cd32;
            border-radius: 50%;
            opacity: 0.6;
        }

        .fighter.audrey .spot1 { width: 8px; height: 8px; top: 5px; left: 10px; }
        .fighter.audrey .spot2 { width: 6px; height: 6px; top: 8px; right: 12px; }

        .fighter.audrey .lower-jaw {
            position: absolute;
            width: 55px;
            height: 25px;
            background: linear-gradient(to top, #228b22 0%, #1a6b1a 100%);
            border: 3px solid var(--ink);
            border-radius: 0 0 50% 50%;
            bottom: 0;
            transform-origin: top center;
            z-index: 11;
        }

        .fighter.audrey .upper-lip {
            position: absolute;
            bottom: -2px;
            left: 5px;
            right: 5px;
            height: 8px;
            background: linear-gradient(to bottom, #dc143c 0%, #8b0000 100%);
            border-radius: 0 0 50% 50%;
            z-index: 13;
        }

        .fighter.audrey .lower-lip {
            position: absolute;
            top: -2px;
            left: 5px;
            right: 5px;
            height: 8px;
            background: linear-gradient(to top, #dc143c 0%, #8b0000 100%);
            border-radius: 50% 50% 0 0;
            z-index: 13;
        }

        .fighter.audrey .teeth-upper,
        .fighter.audrey .teeth-lower {
            position: absolute;
            left: 8px;
            right: 8px;
            height: 6px;
            display: flex;
            justify-content: space-around;
            z-index: 14;
        }

        .fighter.audrey .teeth-upper { bottom: 5px; }
        .fighter.audrey .teeth-lower { top: 5px; }

        .fighter.audrey .tooth {
            width: 5px;
            height: 8px;
            background: #fffef0;
            border: 1px solid var(--ink);
            clip-path: polygon(50% 100%, 0% 0%, 100% 0%);
        }

        .fighter.audrey .teeth-lower .tooth {
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
        }

        .fighter.audrey .tongue {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 12px;
            background: #ff69b4;
            border: 2px solid #cc5599;
            border-radius: 50%;
            z-index: 10;
        }

        .fighter.audrey .eye-stalk {
            position: absolute;
            width: 6px;
            height: 20px;
            background: #228b22;
            border: 2px solid var(--ink);
            border-radius: 4px;
            top: -15px;
            z-index: 15;
        }

        .fighter.audrey .eye-stalk.left { left: 10px; transform: rotate(-15deg); }
        .fighter.audrey .eye-stalk.right { right: 10px; transform: rotate(15deg); }

        .fighter.audrey .eye {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #fffef0;
            border: 2px solid var(--ink);
            border-radius: 50%;
            top: -8px;
            left: -3px;
        }

        .fighter.audrey .pupil {
            position: absolute;
            width: 6px;
            height: 6px;
            background: var(--ink);
            border-radius: 50%;
            top: 2px;
            left: 2px;
        }

        .fighter.audrey .vine {
            position: absolute;
            width: 40px;
            height: 8px;
            background: linear-gradient(90deg, #228b22, #32cd32, #228b22);
            border: 2px solid var(--ink);
            border-radius: 4px;
            bottom: 50px;
        }

        .fighter.audrey .vine.left { left: -35px; transform: rotate(-10deg); }
        .fighter.audrey .vine.right { right: -35px; transform: rotate(10deg); }

        .fighter.audrey .vine-tip {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #32cd32;
            border: 2px solid var(--ink);
            border-radius: 50%;
            top: -3px;
        }

        .fighter.audrey .vine.left .vine-tip { left: -5px; }
        .fighter.audrey .vine.right .vine-tip { right: -5px; }

        .fighter.audrey.biting .upper-jaw {
            animation: bite-upper 0.3s ease-out;
        }

        .fighter.audrey.biting .lower-jaw {
            animation: bite-lower 0.3s ease-out;
        }

        @keyframes bite-upper {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(-20deg); }
        }

        @keyframes bite-lower {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(20deg); }
        }

        /* New character animations */
        @keyframes vogueFlash {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(1.5) translateY(-30px); }
        }

        @keyframes discoSpin {
            from { transform: translateX(-50%) rotate(0deg); }
            to { transform: translateX(-50%) rotate(360deg); }
        }

        @keyframes lightFlash {
            0% { opacity: 0.8; }
            100% { opacity: 0; transform: scaleY(1.2); }
        }

        @keyframes heartFloat {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-80px) scale(0.5); }
        }

        @keyframes lightning {
            0% { opacity: 1; }
            50% { opacity: 0.3; }
            100% { opacity: 1; }
        }

        @keyframes fadeOut {
            to { opacity: 0; }
        }

        @keyframes spotlightPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        @keyframes stageEffect {
            0% { opacity: 0; transform: scale(0) rotate(-180deg); }
            50% { opacity: 1; transform: scale(1.2) rotate(0deg); }
            100% { opacity: 0; transform: scale(1) translateY(-50px); }
        }

        @keyframes smokePuff {
            0% { opacity: 0.6; transform: scale(1); }
            100% { opacity: 0; transform: scale(2) translateY(-30px); }
        }

        @keyframes shockwave {
            0% { width: 20px; height: 10px; opacity: 1; }
            100% { width: 300px; height: 50px; opacity: 0; left: calc(var(--start-x, 0px) - 140px); }
        }

        @keyframes fireTrail {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(0.3) translateY(-20px); }
        }

        @keyframes acidSplash {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }

        @keyframes tentacleWhip {
            0% { transform: rotate(var(--angle, 0deg)) scaleX(0); }
            50% { transform: rotate(var(--angle, 0deg)) scaleX(1.2); }
            100% { transform: rotate(var(--angle, 0deg)) scaleX(0); }
        }

        @keyframes portalSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes explosionPulse {
            0% { transform: scale(0.5); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.8; }
            100% { transform: scale(2); opacity: 0; }
        }

        /* ==================== NPC DUMMY ==================== */
        .npc-dummy {
            position: absolute;
            bottom: 68px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .npc-dummy .dummy-head {
            width: 35px;
            height: 40px;
            border: 3px solid var(--ink);
            border-radius: 40%;
            background: var(--paper);
        }

        .npc-dummy .dummy-body {
            width: 45px;
            height: 55px;
            border: 3px solid var(--ink);
            border-radius: 5px;
            background: var(--paper);
            margin-top: -5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .npc-dummy .target {
            width: 25px;
            height: 25px;
            border: 2px solid var(--red);
            border-radius: 50%;
            position: relative;
        }

        .npc-dummy .target::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 12px;
            height: 12px;
            border: 2px solid var(--red);
            border-radius: 50%;
        }

        .npc-dummy .target::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 4px;
            height: 4px;
            background: var(--red);
            border-radius: 50%;
        }

        .npc-dummy .dummy-legs {
            display: flex;
            gap: 10px;
            margin-top: -3px;
        }

        .npc-dummy .dummy-leg {
            width: 14px;
            height: 38px;
            border: 3px solid var(--ink);
            border-radius: 4px;
            background: var(--paper);
        }

        .npc-dummy.stunned {
            animation: stunShake 0.1s ease-in-out infinite;
            filter: brightness(1.2) saturate(0.5);
        }

        @keyframes stunShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px); }
            75% { transform: translateX(3px); }
        }

        /* ==================== PROJECTILES ==================== */
        .projectile {
            position: absolute;
            pointer-events: none;
            z-index: 100;
        }

        .bitcoin-coin {
            width: 28px;
            height: 28px;
            border: 3px solid var(--orange);
            border-radius: 50%;
            background: var(--yellow);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Finger Paint', cursive;
            font-size: 1rem;
            color: var(--orange);
            font-weight: bold;
        }

        .film-strip {
            width: 80px;
            height: 18px;
            background: repeating-linear-gradient(90deg, var(--ink) 0px, var(--ink) 12px, var(--paper) 12px, var(--paper) 16px);
            border: 2px solid var(--ink);
        }

        .code-bracket {
            font-family: monospace;
            font-size: 2rem;
            font-weight: bold;
            color: var(--orange);
        }

        .rocket {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .rocket-body {
            width: 30px;
            height: 50px;
            background: var(--paper);
            border: 3px solid var(--ink);
            border-radius: 50% 50% 6px 6px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .rocket-body span {
            font-family: 'Finger Paint', cursive;
            font-size: 1rem;
            color: var(--orange);
            font-weight: bold;
        }

        .rocket-fin {
            position: absolute;
            bottom: 3px;
            width: 10px;
            height: 18px;
            border: 2px solid var(--ink);
            background: var(--orange);
        }

        .rocket-fin.left { left: -6px; border-radius: 0 0 0 50%; }
        .rocket-fin.right { right: -6px; border-radius: 0 0 50% 0; }

        .rocket-flame {
            width: 16px;
            height: 24px;
            background: linear-gradient(180deg, var(--orange), var(--yellow), var(--red));
            border-radius: 50% 50% 50% 50% / 30% 30% 70% 70%;
            margin-top: -3px;
            animation: flame-flicker 0.1s infinite;
        }

        @keyframes flame-flicker {
            0%, 100% { transform: scaleX(1); }
            50% { transform: scaleX(0.9); }
        }

        .whiteboard {
            width: 120px;
            height: 85px;
            background: #fff;
            border: 6px solid #8b7355;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-family: 'Patrick Hand', cursive;
            font-size: 0.6rem;
            color: var(--blue);
            line-height: 1.3;
        }

        .sticky-note {
            width: 24px;
            height: 24px;
            background: var(--yellow);
            border: 2px solid var(--ink);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .shield-bubble {
            width: 120px;
            height: 120px;
            border: 4px dashed var(--green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: shield-pulse 0.5s infinite;
        }

        @keyframes shield-pulse {
            0%, 100% { box-shadow: 0 0 10px var(--green); }
            50% { box-shadow: 0 0 25px var(--green); }
        }

        .buzzword {
            font-family: 'Patrick Hand', cursive;
            font-size: 0.7rem;
            color: var(--green);
            font-weight: bold;
            position: absolute;
        }

        .flipchart {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .flipchart-board {
            width: 100px;
            height: 75px;
            background: #fff;
            border: 3px solid var(--ink);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .flipchart-board .slide-title {
            font-family: 'Permanent Marker', cursive;
            font-size: 0.7rem;
            color: var(--green);
        }

        .flipchart-board .slide-content {
            font-size: 0.5rem;
            color: var(--ink);
        }

        .flipchart-stand {
            width: 4px;
            height: 40px;
            background: var(--ink);
        }

        .soccer-ball {
            width: 24px;
            height: 24px;
            border: 3px solid var(--ink);
            border-radius: 50%;
            background: var(--paper);
            position: relative;
        }

        .soccer-ball::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            background: var(--ink);
            clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%);
        }

        .cat {
            width: 50px;
            height: 40px;
            position: relative;
            display: block;
        }

        .cat-body {
            width: 38px;
            height: 26px;
            border: 3px solid var(--ink);
            border-radius: 40%;
            position: relative;
            background: var(--paper);
        }

        .cat-head {
            position: absolute;
            top: -14px;
            right: -10px;
            width: 22px;
            height: 20px;
            border: 3px solid var(--ink);
            border-radius: 50%;
            background: inherit;
        }

        .cat-ear {
            position: absolute;
            top: -7px;
            width: 8px;
            height: 10px;
            border: 2px solid var(--ink);
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
            background: inherit;
        }

        .cat-ear.left { left: 2px; }
        .cat-ear.right { right: 2px; }

        .cat-tail {
            position: absolute;
            left: -14px;
            top: 8px;
            width: 16px;
            height: 6px;
            border: 2px solid var(--ink);
            border-radius: 50%;
            background: inherit;
        }

        .cat.orange .cat-body,
        .cat.orange .cat-head,
        .cat.orange .cat-ear,
        .cat.orange .cat-tail { background: #f39c12; }
        .cat.gray .cat-body,
        .cat.gray .cat-head,
        .cat.gray .cat-ear,
        .cat.gray .cat-tail { background: #95a5a6; }

        /* ==================== EFFECTS ==================== */
        .impact-effect {
            position: absolute;
            pointer-events: none;
            z-index: 200;
        }

        .impact-star {
            width: 60px;
            height: 60px;
            background: var(--yellow);
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
            animation: impact-pop 0.3s forwards;
        }

        @keyframes impact-pop {
            0% { transform: scale(0); opacity: 1; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(0.8); opacity: 0; }
        }

        .hit-text {
            font-family: 'Finger Paint', cursive;
            font-size: 2rem;
            color: var(--red);
            text-shadow: 2px 2px 0 var(--ink);
            animation: text-pop 0.4s forwards;
        }

        @keyframes text-pop {
            0% { transform: scale(0.5) rotate(-10deg); opacity: 1; }
            50% { transform: scale(1.2) rotate(-5deg); opacity: 1; }
            100% { transform: scale(1) translateY(-20px); opacity: 0; }
        }

        .damage-number {
            font-family: 'Permanent Marker', cursive;
            font-size: 1.5rem;
            color: var(--red);
            animation: damage-float 0.6s forwards;
        }

        @keyframes damage-float {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-40px); opacity: 0; }
        }

        /* ==================== FIGHTER ANIMATIONS ==================== */
        .fighter.idle {
            animation: idle-bounce 0.7s ease-in-out infinite;
        }

        @keyframes idle-bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        .fighter.walking .legs .leg:first-child {
            animation: walk-leg-1 0.3s ease-in-out infinite;
        }

        .fighter.walking .legs .leg:last-child {
            animation: walk-leg-2 0.3s ease-in-out infinite;
        }

        @keyframes walk-leg-1 {
            0%, 100% { transform: rotate(-10deg); }
            50% { transform: rotate(10deg); }
        }

        @keyframes walk-leg-2 {
            0%, 100% { transform: rotate(10deg); }
            50% { transform: rotate(-10deg); }
        }

        .fighter.jumping {
            animation: jump 0.5s ease-out;
        }

        @keyframes jump {
            0% { transform: translateY(0); }
            50% { transform: translateY(-100px); }
            100% { transform: translateY(0); }
        }

        .fighter.punching .arm.right {
            animation: punch 0.2s ease-out;
        }

        @keyframes punch {
            0% { transform: rotate(0deg); }
            50% { transform: rotate(-90deg) translateX(15px); }
            100% { transform: rotate(0deg); }
        }

        .fighter.kicking .leg:last-child {
            animation: kick 0.25s ease-out;
            transform-origin: top center;
        }

        @keyframes kick {
            0% { transform: rotate(0deg); }
            50% { transform: rotate(-60deg); }
            100% { transform: rotate(0deg); }
        }

        .fighter.hit {
            animation: hit-stagger 0.3s ease-out;
        }

        @keyframes hit-stagger {
            0% { transform: translateX(0); }
            25% { transform: translateX(15px) rotate(5deg); }
            75% { transform: translateX(10px) rotate(3deg); }
            100% { transform: translateX(0) rotate(0deg); }
        }

        .npc-dummy.hit {
            animation: dummy-hit 0.3s ease-out;
        }

        @keyframes dummy-hit {
            0% { transform: translateX(0); }
            30% { transform: translateX(20px) rotate(8deg); }
            100% { transform: translateX(0) rotate(0deg); }
        }

        /* ==================== SPECIAL MOVE ANIMATIONS ==================== */
        .fighter.special-bitcoin .arm.right {
            animation: throw-arm 0.4s ease-out;
        }

        .fighter.special-director {
            animation: rush-forward 0.5s ease-out;
        }

        @keyframes rush-forward {
            0% { transform: translateX(0); }
            50% { transform: translateX(100px); }
            100% { transform: translateX(0); }
        }

        .fighter.special-stack {
            animation: summon-pose 0.6s ease-out;
        }

        @keyframes summon-pose {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .fighter.special-moon .arm {
            animation: arms-up 0.5s ease-out forwards;
        }

        @keyframes arms-up {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(-130deg); }
        }

        @keyframes throw-arm {
            0% { transform: rotate(0deg); }
            30% { transform: rotate(60deg); }
            100% { transform: rotate(-80deg); }
        }

        .fighter.special-pyth {
            animation: triangle-dash 0.8s ease-in-out;
        }

        @keyframes triangle-dash {
            0% { transform: translateY(0) translateX(0); }
            25% { transform: translateY(-60px) translateX(0); }
            50% { transform: translateY(-60px) translateX(-50px); }
            100% { transform: translateY(0) translateX(100px); }
        }

        .fighter.special-whiteboard .arm.right {
            animation: throw-board 0.5s ease-out;
        }

        @keyframes throw-board {
            0% { transform: rotate(0deg); }
            40% { transform: rotate(80deg); }
            100% { transform: rotate(-60deg); }
        }

        .fighter.special-action .arm.right {
            animation: rapid-throw 0.6s ease-out;
        }

        @keyframes rapid-throw {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-70deg); }
            50% { transform: rotate(0deg); }
            75% { transform: rotate(-70deg); }
        }

        .fighter.special-paradigm {
            animation: shield-stance 0.8s ease-out;
        }

        @keyframes shield-stance {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .fighter.special-review {
            animation: present-stance 1s ease-out;
        }

        @keyframes present-stance {
            0% { transform: translateX(0); }
            30%, 80% { transform: translateX(-30px); }
            100% { transform: translateX(0); }
        }

        .fighter.special-bicycle {
            animation: bicycle-flip 0.6s ease-out;
        }

        @keyframes bicycle-flip {
            0% { transform: translateY(0) rotate(0deg); }
            40% { transform: translateY(-50px) rotate(-90deg); }
            70% { transform: translateY(-30px) rotate(-60deg); }
            100% { transform: translateY(0) rotate(0deg); }
        }

        .fighter.special-cats .arm {
            animation: cat-throw-arms 0.7s ease-out;
        }

        @keyframes cat-throw-arms {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(-70deg); }
            50% { transform: rotate(0deg); }
            75% { transform: rotate(-70deg); }
            100% { transform: rotate(0deg); }
        }

        .fighter.special-hattrick {
            animation: hattrick-kicks 1s ease-out;
        }

        @keyframes hattrick-kicks {
            0%, 100% { transform: translateX(0); }
            33% { transform: translateX(20px); }
            66% { transform: translateX(40px); }
        }

        @keyframes twinkle {
            from { opacity: 0.5; }
            to { opacity: 1; }
        }

        /* ==================== COMBO LIST ==================== */
        .move-list {
            position: absolute;
            top: 80px;
            left: 10px;
            background: var(--paper);
            border: 2px solid var(--ink);
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 0.7rem;
            max-width: 180px;
            z-index: 50;
        }

        .move-list h4 {
            font-family: 'Finger Paint', cursive;
            font-size: 0.8rem;
            margin-bottom: 5px;
            border-bottom: 1px dashed var(--pencil);
            padding-bottom: 3px;
        }

        .move-list .move {
            margin: 3px 0;
        }

        .move-list .move-name {
            color: var(--pencil);
        }

        /* ==================== WIN/LOSE SCREEN ==================== */
        .result-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 1000;
        }

        .result-overlay.show {
            display: flex;
        }

        .result-text {
            font-family: 'Finger Paint', cursive;
            font-size: 4rem;
            color: var(--paper);
            text-shadow: 4px 4px 0 var(--ink);
            margin-bottom: 30px;
        }

        .result-btn {
            font-family: 'Patrick Hand', cursive;
            font-size: 1.5rem;
            padding: 15px 40px;
            border: 3px solid var(--ink);
            border-radius: 12px;
            background: var(--paper);
            cursor: pointer;
            transition: all 0.2s;
        }

        .result-btn:hover {
            background: var(--ink);
            color: var(--paper);
        }
    </style>
</head>
<body>
    <!-- CHARACTER SELECT SCREEN -->
    <div id="character-select">
        <h1>FAMILY FIGHTER</h1>
        <p class="subtitle">Choose Your Fighter</p>
        <div class="character-grid">
            <div class="char-card pato" onclick="selectCharacter('pato')">
                <div class="preview">
                    <div class="fighter pato" style="position:relative;bottom:0;">
                        <div class="head">
                            <div class="hair"></div>
                            <div class="eyes"><div class="eye"></div><div class="eye"></div></div>
                            <div class="mouth"></div>
                        </div>
                        <div class="body">
                            <span class="logo">B</span>
                            <div class="arm left"></div>
                            <div class="arm right"></div>
                        </div>
                        <div class="legs"><div class="leg"></div><div class="leg"></div></div>
                    </div>
                </div>
                <h3>PATO</h3>
                <p class="theme">Bitcoin / Cinema / Code</p>
            </div>

            <div class="char-card billy" onclick="selectCharacter('billy')">
                <div class="preview">
                    <div class="fighter billy" style="position:relative;bottom:0;">
                        <div class="head">
                            <div class="hair"></div>
                            <div class="glasses"><div class="lens"></div><div class="lens"></div></div>
                            <div class="mouth"></div>
                        </div>
                        <div class="body">
                            <span class="equation">f(x)</span>
                            <div class="arm left"></div>
                            <div class="arm right"></div>
                        </div>
                        <div class="legs"><div class="leg"></div><div class="leg"></div></div>
                    </div>
                </div>
                <h3>BILLY</h3>
                <p class="theme">Mathematics</p>
            </div>

            <div class="char-card jonas" onclick="selectCharacter('jonas')">
                <div class="preview">
                    <div class="fighter jonas" style="position:relative;bottom:0;">
                        <div class="head">
                            <div class="hair"></div>
                            <div class="eyes"><div class="eye"></div><div class="eye"></div></div>
                            <div class="mouth"></div>
                        </div>
                        <div class="body">
                            <span class="badge">COACH</span>
                            <div class="arm left"></div>
                            <div class="arm right"></div>
                        </div>
                        <div class="legs"><div class="leg"></div><div class="leg"></div></div>
                    </div>
                </div>
                <h3>JONAS M</h3>
                <p class="theme">Coaching</p>
            </div>

            <div class="char-card lucas" onclick="selectCharacter('lucas')">
                <div class="preview">
                    <div class="fighter lucas" style="position:relative;bottom:0;">
                        <div class="head">
                            <div class="hair"></div>
                            <div class="eyes"><div class="eye"></div><div class="eye"></div></div>
                            <div class="mouth"></div>
                        </div>
                        <div class="body">
                            <span class="jersey-num">10</span>
                            <div class="arm left"></div>
                            <div class="arm right"></div>
                        </div>
                        <div class="legs">
                            <div class="leg"><div class="sock"></div></div>
                            <div class="leg"><div class="sock"></div></div>
                        </div>
                    </div>
                </div>
                <h3>LUCAS</h3>
                <p class="theme">Soccer / Cats</p>
            </div>

            <div class="char-card jonasl" onclick="selectCharacter('jonasl')">
                <div class="preview">
                    <div class="fighter jonasl" style="position:relative;bottom:0;">
                        <div class="bass">
                            <div class="bass-neck"></div>
                            <div class="bass-body"></div>
                        </div>
                        <div class="head">
                            <div class="hair"></div>
                            <div class="eyes"><div class="eye"></div><div class="eye"></div></div>
                            <div class="mouth"></div>
                        </div>
                        <div class="body">
                            <div class="arm left"></div>
                            <div class="arm right"></div>
                        </div>
                        <div class="legs"><div class="leg"></div><div class="leg"></div></div>
                    </div>
                </div>
                <h3>JONAS L</h3>
                <p class="theme">Bass / Coffee</p>
            </div>

            <div class="char-card vicky" onclick="selectCharacter('vicky')">
                <div class="preview">
                    <div class="fighter vicky" style="position:relative;bottom:0;">
                        <div class="head">
                            <div class="hair"></div>
                            <div class="hair-left"></div>
                            <div class="hair-right"></div>
                            <div class="eyes"><div class="eye"></div><div class="eye"></div></div>
                            <div class="mouth"></div>
                            <div class="blush left"></div>
                            <div class="blush right"></div>
                        </div>
                        <div class="body">
                            <div class="bow"><div class="bow-center"></div></div>
                            <div class="arm left"></div>
                            <div class="arm right"></div>
                        </div>
                        <div class="skirt"></div>
                        <div class="feet"><div class="foot"></div><div class="foot"></div></div>
                    </div>
                </div>
                <h3>VICKY</h3>
                <p class="theme">Silks / Christmas</p>
            </div>

            <div class="char-card fede" onclick="selectCharacter('fede')">
                <div class="preview">
                    <div class="fighter fede" style="position:relative;bottom:0;">
                        <div class="head">
                            <div class="hair"></div>
                            <div class="eyes"><div class="eye"></div><div class="eye"></div></div>
                            <div class="mouth"></div>
                        </div>
                        <div class="body">
                            <div class="collar-left"></div>
                            <div class="collar-right"></div>
                            <div class="buttons">
                                <div class="button"></div>
                                <div class="button"></div>
                                <div class="button"></div>
                            </div>
                            <div class="arm left"></div>
                            <div class="arm right"></div>
                        </div>
                        <div class="legs"><div class="leg left"></div><div class="leg right"></div></div>
                        <div class="feet"><div class="foot"></div><div class="foot"></div></div>
                    </div>
                </div>
                <h3>FEDE</h3>
                <p class="theme">Travel / Salmon</p>
            </div>

            <div class="char-card timo" onclick="selectCharacter('timo')">
                <div class="preview">
                    <div class="fighter timo" style="position:relative;bottom:0;">
                        <div class="head">
                            <div class="hair"></div>
                            <div class="eyes"><div class="eye"></div><div class="eye"></div></div>
                            <div class="mouth"></div>
                            <div class="drool-drop"></div>
                        </div>
                        <div class="body">
                            <div class="arm left"></div>
                            <div class="arm right">
                                <div class="flag-pole">
                                    <div class="flag"></div>
                                </div>
                            </div>
                        </div>
                        <div class="pants"></div>
                        <div class="feet"><div class="foot"></div><div class="foot"></div></div>
                    </div>
                </div>
                <h3>TIMO</h3>
                <p class="theme">Drool / Complain</p>
            </div>

            <div class="char-card pancho" onclick="selectCharacter('pancho')">
                <div class="preview">
                    <div class="fighter pancho" style="position:relative;bottom:0;">
                        <div class="head">
                            <div class="hair"></div>
                            <div class="eyes"><div class="eye"></div><div class="eye"></div></div>
                            <div class="mouth"></div>
                        </div>
                        <div class="body">
                            <span class="logo">P</span>
                            <div class="arm left"></div>
                            <div class="arm right"></div>
                            <div class="cape"></div>
                        </div>
                        <div class="legs"><div class="leg"></div><div class="leg"></div></div>
                    </div>
                </div>
                <h3>PANCHO</h3>
                <p class="theme">Tech / Superman</p>
            </div>

            <div class="char-card madonna" onclick="selectCharacter('madonna')">
                <div class="preview">
                    <div class="fighter madonna" style="position:relative;bottom:0;">
                        <div class="head">
                            <div class="hair"><div class="hair-highlight"></div></div>
                            <div class="eyes"><div class="eye"></div><div class="eye"></div></div>
                            <div class="mouth"></div>
                            <div class="beauty-mark"></div>
                        </div>
                        <div class="body">
                            <div class="cone-left"></div>
                            <div class="cone-right"></div>
                            <div class="belt"></div>
                            <div class="arm left"></div>
                            <div class="arm right"></div>
                        </div>
                        <div class="legs"><div class="leg"></div><div class="leg"></div></div>
                    </div>
                </div>
                <h3>MADONNA</h3>
                <p class="theme">Pop / Vogue</p>
            </div>

            <div class="char-card frank" onclick="selectCharacter('frank')">
                <div class="preview">
                    <div class="fighter frank" style="position:relative;bottom:0;">
                        <div class="head">
                            <div class="hair"></div>
                            <div class="eyes"><div class="eye"></div><div class="eye"></div></div>
                            <div class="mouth"></div>
                            <div class="beauty-mark"></div>
                        </div>
                        <div class="body">
                            <div class="pearls"></div>
                            <div class="arm left"></div>
                            <div class="arm right"></div>
                        </div>
                        <div class="legs"><div class="leg"></div><div class="leg"></div></div>
                    </div>
                </div>
                <h3>FRANK</h3>
                <p class="theme">Rocky Horror</p>
            </div>

            <div class="char-card charly" onclick="selectCharacter('charly')">
                <div class="preview">
                    <div class="fighter charly" style="position:relative;bottom:0;">
                        <div class="motorbike">
                            <div class="wheel back"></div>
                            <div class="wheel front"></div>
                            <div class="bike-body"></div>
                        </div>
                        <div class="rider">
                            <div class="head">
                                <div class="hair"></div>
                                <div class="beard"></div>
                            </div>
                            <div class="body"></div>
                        </div>
                    </div>
                </div>
                <h3>CHARLY</h3>
                <p class="theme">Biker / Excel</p>
            </div>

            <div class="char-card audrey" onclick="selectCharacter('audrey')">
                <div class="preview">
                    <div class="fighter audrey" style="position:relative;bottom:0;">
                        <div class="pot">
                            <div class="pot-rim"></div>
                        </div>
                        <div class="stem"></div>
                        <div class="head">
                            <div class="upper-jaw"></div>
                            <div class="lower-jaw"></div>
                            <div class="eye-stalk left"><div class="eye"></div></div>
                            <div class="eye-stalk right"><div class="eye"></div></div>
                        </div>
                    </div>
                </div>
                <h3>AUDREY II</h3>
                <p class="theme">Plant / Horror</p>
            </div>
        </div>
    </div>

    <!-- TOURNAMENT LADDER SCREEN -->
    <div id="tournament-ladder" style="display: none;">
        <!-- Populated by tournament-integration.js -->
    </div>

    <!-- PRE-FIGHT VS SCREEN -->
    <div id="pre-fight-screen">
        <!-- Populated by tournament-integration.js -->
    </div>

    <!-- ROUND RESULT OVERLAY -->
    <div class="round-result-overlay" id="round-result-overlay">
        <!-- Populated by tournament-integration.js -->
    </div>

    <!-- GAME OVER SCREEN -->
    <div id="game-over-screen">
        <!-- Populated by tournament-integration.js -->
    </div>

    <!-- VICTORY SCREEN -->
    <div id="victory-screen">
        <!-- Populated by tournament-integration.js -->
    </div>

    <!-- GAME ARENA -->
    <div id="game-arena">
        <div class="game-header">
            <div class="player-info">
                <div>
                    <div class="player-name" id="player-name">PLAYER</div>
                    <div class="health-bar">
                        <div class="health-fill" id="player-health"></div>
                    </div>
                    <div class="energy-bar">
                        <div class="energy-fill" id="player-energy"></div>
                    </div>
                </div>
            </div>
            <div class="game-title">VS</div>
            <div class="player-info right">
                <div>
                    <div class="player-name" id="opponent-name">OPPONENT</div>
                    <div class="health-bar">
                        <div class="health-fill" id="dummy-health"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="arena" id="arena">
            <div class="ground-line"></div>
            <div class="combo-display" id="combo-display">Ready to fight!</div>

            <!-- Player fighter gets inserted here -->
            <div id="player-fighter-container"></div>

            <!-- Opponent Fighter Container (for tournament mode) -->
            <div id="opponent-fighter-container"></div>

            <!-- NPC Dummy (fallback for non-tournament mode) -->
            <div class="npc-dummy" id="npc-dummy" style="left: 650px;">
                <div class="dummy-head"></div>
                <div class="dummy-body">
                    <div class="target"></div>
                </div>
                <div class="dummy-legs">
                    <div class="dummy-leg"></div>
                    <div class="dummy-leg"></div>
                </div>
            </div>

            <!-- Round Indicator -->
            <div class="round-counter" id="round-indicator"></div>

            <div class="move-list" id="move-list"></div>
        </div>

        <div class="controls-display">
            <div class="control-group">
                <span><span class="key"></span><span class="key"></span> Move</span>
                <span><span class="key">Z</span> Punch</span>
                <span><span class="key">X</span> Kick</span>
                <span><span class="key">C</span> Jump</span>
            </div>
            <div class="control-group">
                <span>Special moves: combos shown in move list</span>
            </div>
        </div>
    </div>

    <!-- Result Overlay -->
    <div class="result-overlay" id="result-overlay">
        <div class="result-text" id="result-text">YOU WIN!</div>
        <button class="result-btn" onclick="restartGame()">Play Again</button>
    </div>

    <script>
        // Game State
        const game = {
            selectedCharacter: null,
            playerHealth: 100,
            dummyHealth: 200,  // Reduced for faster matches
            playerEnergy: 0,
            playerX: 100,
            isJumping: false,
            isAttacking: false,
            comboBuffer: [],
            comboTimeout: null,
            keys: {},
            bassDamage: 0,  // Track bass damage for Jonas L (0-4)
            // NPC movement
            dummyX: 650,
            dummyTargetX: 650,
            dummyMoveTimer: 0,
            dummyDirection: -1,
            // Pancho flight
            isFlying: false,
            flyHeight: 68
        };

        // Character move lists
        const moveLists = {
            pato: {
                name: 'PATO',
                color: 'var(--orange)',
                specials: [
                    { name: 'Bitcoin Throw', combo: ['down', 'left', 'z'], damage: 15, energy: 20 },
                    { name: "Director's Cut", combo: ['right', 'right', 'z'], damage: 20, energy: 25 },
                    { name: 'Stack Overflow', combo: ['down', 'down', 'x'], damage: 18, energy: 25 },
                    { name: 'TO THE MOON!', combo: ['down', 'right', 'down', 'right', 'z'], damage: 40, energy: 100, ultimate: true }
                ]
            },
            billy: {
                name: 'BILLY',
                color: 'var(--blue)',
                specials: [
                    { name: 'Pythagorean Punch', combo: ['left', 'right', 'z'], damage: 22, energy: 25 },
                    { name: 'Infinite Loop', combo: ['down', 'left', 'x'], damage: 20, energy: 25 },
                    { name: 'Division Split', combo: ['down', 'down', 'z'], damage: 18, energy: 20 },
                    { name: 'WHITEBOARD SLAM', combo: ['down', 'right', 'down', 'right', 'z'], damage: 45, energy: 100, ultimate: true }
                ]
            },
            jonas: {
                name: 'JONAS M',
                color: 'var(--green)',
                specials: [
                    { name: 'Post-its', combo: ['down', 'right', 'z'], damage: 15, energy: 20 },
                    { name: 'Paradigm Shift', combo: ['down', 'down', 'x'], damage: 0, energy: 25, defensive: true },
                    { name: 'Circle Back', combo: ['right', 'left', 'z'], damage: 18, energy: 25 },
                    { name: 'PERFORMANCE REVIEW', combo: ['down', 'down', 'down', 'z'], damage: 50, energy: 100, ultimate: true }
                ]
            },
            lucas: {
                name: 'LUCAS',
                color: 'var(--purple)',
                specials: [
                    { name: 'Bicycle Kick', combo: ['left', 'right', 'x'], damage: 20, energy: 25 },
                    { name: 'Cat Throw', combo: ['down', 'left', 'z'], damage: 18, energy: 20 },
                    { name: 'Sliding Tackle', combo: ['right', 'right', 'x'], damage: 15, energy: 15 },
                    { name: 'HAT TRICK!', combo: ['down', 'right', 'down', 'right', 'x'], damage: 45, energy: 100, ultimate: true }
                ]
            },
            jonasl: {
                name: 'JONAS L',
                color: '#8b4513',
                specials: [
                    { name: 'Paddle Ball', combo: ['right', 'down', 'z'], damage: 16, energy: 20 },
                    { name: 'Hot Coffee', combo: ['down', 'left', 'z'], damage: 20, energy: 25 },
                    { name: 'Bass Swing', combo: ['right', 'right', 'z'], damage: 22, energy: 20 },
                    { name: 'BASS SOLO!', combo: ['down', 'right', 'down', 'right', 'z'], damage: 50, energy: 100, ultimate: true }
                ]
            },
            vicky: {
                name: 'VICKY',
                color: '#c41e3a',
                specials: [
                    { name: 'Silk Wrap', combo: ['down', 'left', 'z'], damage: 18, energy: 20 },
                    { name: 'Naughty List', combo: ['right', 'right', 'z'], damage: 20, energy: 25 },
                    { name: 'Nice List', combo: ['down', 'down', 'z'], damage: 18, energy: 20 },
                    { name: 'Christmas Spirit', combo: ['left', 'right', 'x'], damage: 15, energy: 50, heal: true },
                    { name: 'SILK DROP MIRACLE!', combo: ['down', 'right', 'down', 'right', 'z'], damage: 50, energy: 100, ultimate: true }
                ]
            },
            fede: {
                name: 'FEDE',
                color: '#4a90d9',
                specials: [
                    { name: 'The Split', combo: ['down', 'down', 'x'], damage: 25, energy: 20 },
                    { name: 'Salmon Sashimi', combo: ['right', 'right', 'z'], damage: 20, energy: 25 },
                    { name: 'Country Throw', combo: ['down', 'left', 'z'], damage: 18, energy: 20 },
                    { name: 'WORLD TOUR!', combo: ['down', 'right', 'down', 'right', 'z'], damage: 55, energy: 100, ultimate: true }
                ]
            },
            timo: {
                name: 'TIMO',
                color: '#888',
                specials: [
                    { name: 'Excessive Drool', combo: ['down', 'down', 'z'], damage: 0, energy: 10 },
                    { name: 'Loud Complaining', combo: ['left', 'right', 'z'], damage: 0, energy: 10 },
                    { name: 'Wave the Flag', combo: ['right', 'right', 'x'], damage: 0, energy: 10 },
                    { name: 'MEGA TANTRUM!', combo: ['down', 'right', 'down', 'right', 'z'], damage: 0, energy: 100, ultimate: true }
                ]
            },
            pancho: {
                name: 'PANCHO',
                color: '#2563eb',
                specials: [
                    { name: 'Gadget Throw', combo: ['down', 'right', 'z'], damage: 22, energy: 20 },
                    { name: 'Superman Flight', combo: ['up', 'up', 'x'], damage: 0, energy: 25 },
                    { name: 'Heat Vision', combo: ['down', 'right', 'down', 'z'], damage: 30, energy: 30, burn: true },
                    { name: 'FREEZE BREATH!', combo: ['down', 'right', 'down', 'right', 'z'], damage: 45, energy: 100, ultimate: true, freeze: true }
                ]
            },
            madonna: {
                name: 'MADONNA',
                color: '#e91e8c',
                specials: [
                    { name: 'Vogue Strike', combo: ['down', 'down', 'z'], damage: 18, energy: 20 },
                    { name: 'Mic Drop', combo: ['down', 'right', 'z'], damage: 22, energy: 25 },
                    { name: 'Blond Ambition', combo: ['left', 'down', 'right', 'z'], damage: 25, energy: 30 },
                    { name: 'MATERIAL WORLD!', combo: ['down', 'right', 'down', 'right', 'z'], damage: 50, energy: 100, ultimate: true }
                ]
            },
            frank: {
                name: 'FRANK',
                color: '#cc0033',
                specials: [
                    { name: 'Sweet Transvestite', combo: ['down', 'down', 'z'], damage: 15, energy: 20, charm: true },
                    { name: 'Lab Lightning', combo: ['down', 'right', 'z'], damage: 25, energy: 25 },
                    { name: 'Time Warp', combo: ['left', 'down', 'right', 'x'], damage: 0, energy: 30, teleport: true },
                    { name: 'FLOOR SHOW!', combo: ['down', 'right', 'down', 'right', 'z'], damage: 55, energy: 100, ultimate: true }
                ]
            },
            charly: {
                name: 'CHARLY',
                color: '#c0392b',
                specials: [
                    { name: 'Wheelie Strike', combo: ['down', 'left', 'right', 'z'], damage: 22, energy: 20 },
                    { name: 'Excel Throw', combo: ['down', 'right', 'z'], damage: 20, energy: 25 },
                    { name: 'Rev Bomb', combo: ['down', 'down', 'x'], damage: 18, energy: 20 },
                    { name: 'HIGHWAY TO HELL!', combo: ['down', 'right', 'down', 'right', 'z'], damage: 50, energy: 100, ultimate: true }
                ]
            },
            audrey: {
                name: 'AUDREY II',
                color: '#228b22',
                specials: [
                    { name: 'Vine Whip', combo: ['left', 'right', 'down', 'z'], damage: 20, energy: 20 },
                    { name: 'Feed Me!', combo: ['down', 'down', 'z'], damage: 28, energy: 25 },
                    { name: 'Siren Song', combo: ['down', 'right', 'z'], damage: 22, energy: 25 },
                    { name: 'MEAN GREEN MOTHER!', combo: ['down', 'right', 'down', 'right', 'z'], damage: 55, energy: 100, ultimate: true }
                ]
            }
        };

        // Character HTML templates
        const characterTemplates = {
            pato: `
                <div class="fighter pato idle" id="player-fighter">
                    <div class="head">
                        <div class="hair"></div>
                        <div class="eyes"><div class="eye"></div><div class="eye"></div></div>
                        <div class="mouth"></div>
                    </div>
                    <div class="body">
                        <span class="logo">B</span>
                        <div class="arm left"></div>
                        <div class="arm right"></div>
                    </div>
                    <div class="legs"><div class="leg"></div><div class="leg"></div></div>
                </div>
            `,
            billy: `
                <div class="fighter billy idle" id="player-fighter">
                    <div class="head">
                        <div class="hair"></div>
                        <div class="glasses"><div class="lens"></div><div class="lens"></div></div>
                        <div class="mouth"></div>
                    </div>
                    <div class="body">
                        <span class="equation">f(x)</span>
                        <div class="arm left"></div>
                        <div class="arm right"></div>
                    </div>
                    <div class="legs"><div class="leg"></div><div class="leg"></div></div>
                </div>
            `,
            jonas: `
                <div class="fighter jonas idle" id="player-fighter">
                    <div class="head">
                        <div class="hair"></div>
                        <div class="eyes"><div class="eye"></div><div class="eye"></div></div>
                        <div class="mouth"></div>
                    </div>
                    <div class="body">
                        <span class="badge">COACH</span>
                        <div class="arm left"></div>
                        <div class="arm right"></div>
                    </div>
                    <div class="legs"><div class="leg"></div><div class="leg"></div></div>
                </div>
            `,
            lucas: `
                <div class="fighter lucas idle" id="player-fighter">
                    <div class="head">
                        <div class="hair"></div>
                        <div class="eyes"><div class="eye"></div><div class="eye"></div></div>
                        <div class="mouth"></div>
                    </div>
                    <div class="body">
                        <span class="jersey-num">10</span>
                        <div class="arm left"></div>
                        <div class="arm right"></div>
                    </div>
                    <div class="legs">
                        <div class="leg"><div class="sock"></div></div>
                        <div class="leg"><div class="sock"></div></div>
                    </div>
                </div>
            `,
            jonasl: `
                <div class="fighter jonasl idle" id="player-fighter">
                    <div class="bass" id="player-bass">
                        <div class="bass-neck"></div>
                        <div class="bass-body"></div>
                        <div class="bass-strings"></div>
                    </div>
                    <div class="head">
                        <div class="hair"></div>
                        <div class="eyes"><div class="eye"></div><div class="eye"></div></div>
                        <div class="mouth"></div>
                    </div>
                    <div class="body">
                        <span class="coffee-mug"></span>
                        <div class="arm left"></div>
                        <div class="arm right"></div>
                    </div>
                    <div class="legs"><div class="leg"></div><div class="leg"></div></div>
                </div>
            `,
            vicky: `
                <div class="fighter vicky idle" id="player-fighter">
                    <div class="head">
                        <div class="hair"></div>
                        <div class="hair-left"></div>
                        <div class="hair-right"></div>
                        <div class="eyes"><div class="eye"></div><div class="eye"></div></div>
                        <div class="mouth"></div>
                        <div class="blush left"></div>
                        <div class="blush right"></div>
                    </div>
                    <div class="body">
                        <div class="bow"><div class="bow-center"></div></div>
                        <div class="arm left"></div>
                        <div class="arm right"></div>
                    </div>
                    <div class="skirt"></div>
                    <div class="feet"><div class="foot"></div><div class="foot"></div></div>
                </div>
            `,
            fede: `
                <div class="fighter fede idle" id="player-fighter">
                    <div class="head">
                        <div class="hair"></div>
                        <div class="eyes"><div class="eye"></div><div class="eye"></div></div>
                        <div class="mouth"></div>
                    </div>
                    <div class="body">
                        <div class="collar-left"></div>
                        <div class="collar-right"></div>
                        <div class="buttons">
                            <div class="button"></div>
                            <div class="button"></div>
                            <div class="button"></div>
                        </div>
                        <div class="arm left"></div>
                        <div class="arm right"></div>
                    </div>
                    <div class="legs">
                        <div class="leg left"></div>
                        <div class="leg right"></div>
                    </div>
                    <div class="feet"><div class="foot"></div><div class="foot"></div></div>
                </div>
            `,
            timo: `
                <div class="fighter timo idle" id="player-fighter">
                    <div class="head">
                        <div class="hair"></div>
                        <div class="eyes"><div class="eye"></div><div class="eye"></div></div>
                        <div class="mouth"></div>
                        <div class="drool-drop"></div>
                    </div>
                    <div class="body">
                        <div class="arm left"></div>
                        <div class="arm right">
                            <div class="flag-pole">
                                <div class="flag"></div>
                            </div>
                        </div>
                    </div>
                    <div class="pants"></div>
                    <div class="feet"><div class="foot"></div><div class="foot"></div></div>
                </div>
            `,
            pancho: `
                <div class="fighter pancho idle" id="player-fighter">
                    <div class="head">
                        <div class="hair"></div>
                        <div class="eyes"><div class="eye"></div><div class="eye"></div></div>
                        <div class="mouth"></div>
                    </div>
                    <div class="body">
                        <span class="logo">P</span>
                        <div class="arm left"></div>
                        <div class="arm right"></div>
                        <div class="cape"></div>
                    </div>
                    <div class="legs"><div class="leg"></div><div class="leg"></div></div>
                </div>
            `,
            madonna: `
                <div class="fighter madonna idle" id="player-fighter">
                    <div class="head">
                        <div class="hair"><div class="hair-highlight"></div></div>
                        <div class="eyes"><div class="eye"></div><div class="eye"></div></div>
                        <div class="mouth"></div>
                        <div class="beauty-mark"></div>
                    </div>
                    <div class="body">
                        <div class="cone-left"></div>
                        <div class="cone-right"></div>
                        <div class="belt"></div>
                        <div class="arm left"></div>
                        <div class="arm right"></div>
                    </div>
                    <div class="legs"><div class="leg"></div><div class="leg"></div></div>
                    <div class="feet"><div class="foot"></div><div class="foot"></div></div>
                </div>
            `,
            frank: `
                <div class="fighter frank idle" id="player-fighter">
                    <div class="head">
                        <div class="hair"></div>
                        <div class="eyes"><div class="eye"></div><div class="eye"></div></div>
                        <div class="mouth"></div>
                        <div class="beauty-mark"></div>
                    </div>
                    <div class="body">
                        <div class="pearls"></div>
                        <div class="arm left"></div>
                        <div class="arm right"></div>
                    </div>
                    <div class="legs"><div class="leg"></div><div class="leg"></div></div>
                    <div class="feet"><div class="foot"></div><div class="foot"></div></div>
                </div>
            `,
            charly: `
                <div class="fighter charly idle" id="player-fighter">
                    <div class="motorbike">
                        <div class="wheel back"></div>
                        <div class="wheel front"></div>
                        <div class="bike-body"></div>
                        <div class="exhaust"></div>
                        <div class="headlight"></div>
                    </div>
                    <div class="rider">
                        <div class="head">
                            <div class="hair"></div>
                            <div class="eyes"><div class="eye"></div><div class="eye"></div></div>
                            <div class="beard"></div>
                        </div>
                        <div class="body"></div>
                        <div class="arm left"></div>
                        <div class="arm right"></div>
                    </div>
                </div>
            `,
            audrey: `
                <div class="fighter audrey idle" id="player-fighter">
                    <div class="pot">
                        <div class="pot-rim"></div>
                    </div>
                    <div class="stem"></div>
                    <div class="head">
                        <div class="upper-jaw">
                            <div class="spot spot1"></div>
                            <div class="spot spot2"></div>
                            <div class="upper-lip"></div>
                            <div class="teeth-upper">
                                <div class="tooth"></div><div class="tooth"></div><div class="tooth"></div><div class="tooth"></div><div class="tooth"></div>
                            </div>
                        </div>
                        <div class="lower-jaw">
                            <div class="lower-lip"></div>
                            <div class="teeth-lower">
                                <div class="tooth"></div><div class="tooth"></div><div class="tooth"></div><div class="tooth"></div>
                            </div>
                            <div class="tongue"></div>
                        </div>
                        <div class="eye-stalk left"><div class="eye"><div class="pupil"></div></div></div>
                        <div class="eye-stalk right"><div class="eye"><div class="pupil"></div></div></div>
                    </div>
                    <div class="vine left"><div class="vine-tip"></div></div>
                    <div class="vine right"><div class="vine-tip"></div></div>
                </div>
            `
        };

        // Export to window for tournament integration
        window.game = game;
        window.moveLists = moveLists;
        window.characterTemplates = characterTemplates;

        function selectCharacter(char) {
            game.selectedCharacter = char;
            game.bassDamage = 0;  // Reset bass damage for Jonas L
            document.getElementById('character-select').style.display = 'none';
            document.getElementById('game-arena').style.display = 'flex';

            // Setup player
            document.getElementById('player-name').textContent = moveLists[char].name;
            document.getElementById('player-name').style.color = moveLists[char].color;
            document.getElementById('player-fighter-container').innerHTML = characterTemplates[char];

            // Setup move list
            const moveListEl = document.getElementById('move-list');
            moveListEl.innerHTML = `<h4>Moves</h4>` +
                moveLists[char].specials.map(m =>
                    `<div class="move"><span class="move-name">${m.name}:</span> ${m.combo.map(k => {
                        if (k === 'down') return '';
                        if (k === 'up') return '';
                        if (k === 'right') return '';
                        if (k === 'left') return '';
                        return k.toUpperCase();
                    }).join(' ')}</div>`
                ).join('');

            resetGame();
            startGameLoop();
        }

        function resetGame() {
            game.playerHealth = 100;
            game.dummyHealth = 200;
            game.playerEnergy = 0;
            game.playerX = 100;
            game.isJumping = false;
            game.isAttacking = false;
            game.comboBuffer = [];
            game.dummyX = 650;
            game.dummyTargetX = 650;
            game.dummyMoveTimer = 0;
            updateUI();

            const fighter = document.getElementById('player-fighter');
            if (fighter) {
                fighter.style.left = game.playerX + 'px';
            }

            const dummy = document.getElementById('npc-dummy');
            if (dummy) {
                dummy.style.left = game.dummyX + 'px';
                dummy.classList.remove('frozen', 'burning', 'stunned');
            }
        }

        function updateUI() {
            document.getElementById('player-health').style.width = game.playerHealth + '%';
            document.getElementById('dummy-health').style.width = game.dummyHealth + '%';
            document.getElementById('player-energy').style.width = game.playerEnergy + '%';

            if (game.playerHealth < 30) {
                document.getElementById('player-health').classList.add('low');
            } else {
                document.getElementById('player-health').classList.remove('low');
            }
        }

        function startGameLoop() {
            function loop() {
                // Movement
                const fighter = document.getElementById('player-fighter');
                if (!fighter) return;

                const arena = document.getElementById('arena');
                const maxX = arena.offsetWidth - 100;

                if (game.keys['ArrowLeft'] && !game.isAttacking) {
                    game.playerX = Math.max(50, game.playerX - 5);
                    fighter.classList.add('walking');
                    fighter.classList.add('facing-left');
                } else if (game.keys['ArrowRight'] && !game.isAttacking) {
                    game.playerX = Math.min(maxX, game.playerX + 5);
                    fighter.classList.add('walking');
                    fighter.classList.remove('facing-left');
                } else {
                    fighter.classList.remove('walking');
                }

                fighter.style.left = game.playerX + 'px';

                // Vertical movement while flying
                if (game.isFlying) {
                    const minHeight = 68;
                    const maxHeight = 280;
                    if (game.keys['ArrowUp']) {
                        game.flyHeight = Math.min(maxHeight, game.flyHeight + 6);
                    } else if (game.keys['ArrowDown']) {
                        game.flyHeight = Math.max(minHeight, game.flyHeight - 6);
                    }
                    fighter.style.bottom = game.flyHeight + 'px';
                }

                // NPC Random Movement
                const dummy = document.getElementById('npc-dummy');
                if (dummy && !dummy.classList.contains('frozen') && !dummy.classList.contains('stunned')) {
                    game.dummyMoveTimer++;

                    // Every 60-120 frames, pick a new target
                    if (game.dummyMoveTimer >= 60 + Math.random() * 60) {
                        game.dummyMoveTimer = 0;
                        // Random movement within bounds (400-750)
                        const minX = 400;
                        const maxDummyX = arena.offsetWidth - 80;
                        game.dummyTargetX = minX + Math.random() * (maxDummyX - minX);
                    }

                    // Move towards target
                    const dummySpeed = 1.5;
                    if (Math.abs(game.dummyX - game.dummyTargetX) > dummySpeed) {
                        if (game.dummyX < game.dummyTargetX) {
                            game.dummyX += dummySpeed;
                            game.dummyDirection = 1;
                        } else {
                            game.dummyX -= dummySpeed;
                            game.dummyDirection = -1;
                        }
                        dummy.style.left = game.dummyX + 'px';
                    }
                }

                requestAnimationFrame(loop);
            }
            loop();
        }
        window.startGameLoop = startGameLoop;

        // Input handling
        document.addEventListener('keydown', (e) => {
            game.keys[e.key] = true;

            // Map keys to combo inputs
            let input = null;
            if (e.key === 'ArrowDown') input = 'down';
            else if (e.key === 'ArrowUp') input = 'up';
            else if (e.key === 'ArrowRight') input = 'right';
            else if (e.key === 'ArrowLeft') input = 'left';
            else if (e.key === 'z' || e.key === 'Z') input = 'z';
            else if (e.key === 'x' || e.key === 'X') input = 'x';
            else if (e.key === 'c' || e.key === 'C') input = 'c';

            if (input && game.selectedCharacter) {
                handleInput(input);
            }
        });

        document.addEventListener('keyup', (e) => {
            game.keys[e.key] = false;
        });

        function handleInput(input) {
            if (game.isAttacking) return;

            const fighter = document.getElementById('player-fighter');
            if (!fighter) return;

            // Add to combo buffer
            game.comboBuffer.push(input);
            if (game.comboBuffer.length > 6) game.comboBuffer.shift();

            // Clear combo timeout
            clearTimeout(game.comboTimeout);
            game.comboTimeout = setTimeout(() => {
                game.comboBuffer = [];
                updateComboDisplay('');
            }, 800);

            // Update combo display
            updateComboDisplay(game.comboBuffer.map(k => {
                if (k === 'down') return '';
                if (k === 'up') return '';
                if (k === 'right') return '';
                if (k === 'left') return '';
                return k.toUpperCase();
            }).join(' '));

            // Check for special moves - check LONGER combos first (ultimates before regular moves)
            const specials = moveLists[game.selectedCharacter].specials;
            const sortedSpecials = [...specials].sort((a, b) => b.combo.length - a.combo.length);
            for (const special of sortedSpecials) {
                if (matchesCombo(special.combo)) {
                    if (special.ultimate && game.playerEnergy < 100) {
                        updateComboDisplay('Need full energy!');
                        continue;
                    }
                    executeSpecial(special);
                    game.comboBuffer = [];
                    return;
                }
            }

            // Basic attacks
            if (input === 'z') {
                executePunch();
            } else if (input === 'x') {
                executeKick();
            } else if (input === 'c' && !game.isJumping) {
                executeJump();
            }
        }

        function matchesCombo(combo) {
            if (game.comboBuffer.length < combo.length) return false;
            const recent = game.comboBuffer.slice(-combo.length);
            return combo.every((key, i) => recent[i] === key);
        }

        function updateComboDisplay(text) {
            document.getElementById('combo-display').textContent = text || 'Ready to fight!';
        }

        // Helper to update bass damage for Jonas L
        function incrementBassDamage() {
            if (game.selectedCharacter === 'jonasl') {
                const bass = document.getElementById('player-bass');
                if (bass && game.bassDamage < 4) {
                    game.bassDamage++;
                    bass.classList.remove('damage-0', 'damage-1', 'damage-2', 'damage-3', 'damage-4');
                    bass.classList.add('damage-' + game.bassDamage);
                }
            }
        }

        function executePunch() {
            const fighter = document.getElementById('player-fighter');
            const arena = document.getElementById('arena');
            game.isAttacking = true;

            fighter.classList.remove('idle');
            fighter.classList.add('punching');

            const fighterX = parseFloat(fighter.style.left) || game.playerX;
            const char = game.selectedCharacter;
            const inRange = isInRange();

            // Character-specific animated punch attacks
            if (char === 'billy') {
                // Billy: Ruler Smack - animate his ACTUAL arm holding a ruler
                const rightArm = fighter.querySelector('.arm.right');
                const originalArmTransform = rightArm ? getComputedStyle(rightArm).transform : '';

                // Create hand at end of arm
                const hand = document.createElement('div');
                hand.style.cssText = `
                    position: absolute; right: -8px; bottom: -5px;
                    width: 7px; height: 7px;
                    background: var(--paper, #ffeedd); border: 1px solid var(--ink, #333);
                    border-radius: 50%; z-index: 151;
                `;

                // Create ruler held by hand
                const ruler = document.createElement('div');
                ruler.style.cssText = `
                    position: absolute; right: -4px; bottom: 2px;
                    width: 40px; height: 8px;
                    background: linear-gradient(180deg, #deb887 0%, #c49660 100%);
                    border: 1px solid #8b7355; border-radius: 1px;
                    transform: rotate(-20deg); transform-origin: left center;
                    z-index: 150;
                `;
                // Ruler markings
                for (let i = 1; i <= 4; i++) {
                    const mark = document.createElement('div');
                    mark.style.cssText = `position: absolute; left: ${i * 8}px; top: 1px; width: 1px; height: 4px; background: #333;`;
                    ruler.appendChild(mark);
                }
                hand.appendChild(ruler);

                if (rightArm) {
                    rightArm.appendChild(hand);
                    rightArm.style.transition = 'transform 0.04s linear';
                    rightArm.style.transformOrigin = 'top center';
                }

                let frame = 0;
                const swing = setInterval(() => {
                    frame++;
                    // Swing arm from idle (-15deg) to forward (70deg)
                    const armAngle = -15 + frame * 9;
                    if (rightArm) {
                        rightArm.style.transform = `rotate(${armAngle}deg)`;
                    }
                    // Ruler swings with arm
                    ruler.style.transform = `rotate(${-20 + frame * 5}deg)`;

                    if (frame >= 10) {
                        clearInterval(swing);
                        // Return arm to normal
                        setTimeout(() => {
                            if (rightArm) {
                                rightArm.style.transition = 'transform 0.15s';
                                rightArm.style.transform = originalArmTransform || 'rotate(-15deg)';
                            }
                            hand.remove();
                        }, 100);
                    }
                }, 28);

                if (inRange) setTimeout(() => dealDamage(8, 'RULER!'), 200);

            } else if (char === 'jonas') {
                // Jonas M: Briefcase Swing - animate his ACTUAL arm holding the briefcase
                const rightArm = fighter.querySelector('.arm.right');
                const originalArmTransform = rightArm ? rightArm.style.transform : '';

                // Create hand at end of arm
                const hand = document.createElement('div');
                hand.style.cssText = `
                    position: absolute; right: -10px; bottom: -6px;
                    width: 8px; height: 8px;
                    background: var(--paper, #ffd699); border: 1px solid var(--ink, #333);
                    border-radius: 50%; z-index: 151;
                `;

                // Create briefcase held by hand
                const briefcase = document.createElement('div');
                briefcase.innerHTML = `
                    <div style="width: 32px; height: 22px; background: linear-gradient(180deg, #8b4513 0%, #654321 100%); border: 2px solid #4a2c0a; border-radius: 3px; position: relative; box-shadow: 1px 1px 3px rgba(0,0,0,0.4);">
                        <div style="position: absolute; top: -4px; left: 50%; transform: translateX(-50%); width: 10px; height: 5px; background: #4a2c0a; border-radius: 3px 3px 0 0;"></div>
                        <div style="position: absolute; top: 8px; left: 50%; transform: translateX(-50%); width: 8px; height: 4px; background: #ffd700; border-radius: 2px;"></div>
                    </div>
                `;
                briefcase.style.cssText = `
                    position: absolute; right: -30px; bottom: -10px;
                    transform: rotate(-20deg); transform-origin: left center;
                    z-index: 150;
                `;
                hand.appendChild(briefcase);

                if (rightArm) {
                    rightArm.appendChild(hand);
                    rightArm.style.transition = 'transform 0.04s linear';
                    rightArm.style.transformOrigin = 'top center';
                }

                let frame = 0;
                const swing = setInterval(() => {
                    frame++;
                    // Swing arm from -15deg (idle) to 70deg (forward swing)
                    const armAngle = -15 + frame * 9;
                    if (rightArm) {
                        rightArm.style.transform = `rotate(${armAngle}deg)`;
                    }
                    // Briefcase wobbles with swing momentum
                    const wobble = Math.sin(frame * 1.5) * 6;
                    briefcase.style.transform = `rotate(${-20 + frame * 4 + wobble}deg)`;

                    // Motion blur trail
                    if (frame % 2 === 0) {
                        const blur = document.createElement('div');
                        blur.style.cssText = `
                            position: absolute; left: ${fighterX + 40 + frame * 2}px; bottom: ${95 + Math.random() * 10}px;
                            width: 25px; height: 18px;
                            background: rgba(139, 69, 19, 0.3);
                            border-radius: 3px; z-index: 149;
                        `;
                        arena.appendChild(blur);
                        setTimeout(() => blur.remove(), 80);
                    }

                    if (frame >= 10) {
                        clearInterval(swing);
                        // Papers fly out on impact
                        for (let i = 0; i < 4; i++) {
                            const paper = document.createElement('div');
                            paper.style.cssText = `
                                position: absolute; left: ${fighterX + 70}px; bottom: 95px;
                                width: 10px; height: 12px; background: #fff; border: 1px solid #ccc;
                                z-index: 148; box-shadow: 1px 1px 2px rgba(0,0,0,0.2);
                            `;
                            arena.appendChild(paper);
                            const angle = (i / 4) * Math.PI - Math.PI/3;
                            let px = 0, py = 0, rot = 0;
                            const fly = setInterval(() => {
                                px += Math.cos(angle) * 5;
                                py += Math.sin(angle) * 5 - 2;
                                rot += 15;
                                paper.style.transform = `translate(${px}px, ${py}px) rotate(${rot}deg)`;
                                paper.style.opacity = 1 - Math.abs(px) / 60;
                                if (Math.abs(px) > 50) { clearInterval(fly); paper.remove(); }
                            }, 25);
                        }
                        // Return arm to normal
                        setTimeout(() => {
                            if (rightArm) {
                                rightArm.style.transition = 'transform 0.15s';
                                rightArm.style.transform = originalArmTransform || 'rotate(-15deg)';
                            }
                            hand.remove();
                        }, 100);
                    }
                }, 28);

                if (inRange) setTimeout(() => dealDamage(8, 'BUSINESS!'), 200);

            } else if (char === 'jonasl') {
                // Jonas L: Coffee Mug Swing - arm swings with mug in arena
                const rightArm = fighter.querySelector('.arm.right');
                const originalArmTransform = rightArm ? rightArm.style.transform : '';

                // Create coffee mug positioned in arena (tracks arm position)
                const mug = document.createElement('div');
                mug.innerHTML = `
                    <div style="width: 18px; height: 22px; background: linear-gradient(180deg, #fff 0%, #f0f0f0 100%); border: 2px solid #ccc; border-radius: 2px 2px 4px 4px; position: relative;">
                        <div style="position: absolute; right: -7px; top: 5px; width: 7px; height: 10px; border: 2px solid #ccc; border-left: none; border-radius: 0 6px 6px 0;"></div>
                        <div style="position: absolute; top: 3px; left: 3px; width: 10px; height: 8px; background: linear-gradient(180deg, #4a2c0a, #2d1a06); border-radius: 2px;"></div>
                    </div>
                `;
                mug.style.cssText = `position: absolute; left: ${fighterX + 45}px; bottom: 95px; z-index: 150; transform: rotate(-30deg); transform-origin: center;`;
                arena.appendChild(mug);

                if (rightArm) {
                    rightArm.style.transition = 'transform 0.04s linear';
                    rightArm.style.transformOrigin = 'top center';
                }

                let frame = 0;
                const swing = setInterval(() => {
                    frame++;
                    // Swing arm toward enemy
                    const armAngle = -15 - frame * 8;
                    if (rightArm) {
                        rightArm.style.transform = `rotate(${armAngle}deg)`;
                    }

                    // Mug follows arm arc - calculate position based on arm angle
                    const radians = (armAngle - 90) * Math.PI / 180;
                    const armLength = 30;
                    const mugX = fighterX + 45 + Math.cos(radians) * armLength * 0.5;
                    const mugY = 95 + Math.sin(radians) * armLength * 0.3;
                    mug.style.left = mugX + 'px';
                    mug.style.bottom = mugY + 'px';
                    mug.style.transform = `rotate(${armAngle + 15}deg)`;

                    // Coffee splash trail
                    if (frame % 2 === 0 && frame > 4) {
                        const splash = document.createElement('div');
                        splash.style.cssText = `
                            position: absolute; left: ${mugX + 15}px; bottom: ${mugY + 10}px;
                            width: 4px; height: 4px;
                            background: #4a2c0a;
                            border-radius: 50%; z-index: 148;
                        `;
                        arena.appendChild(splash);
                        let splashY = 0, splashX = 0;
                        const drip = setInterval(() => {
                            splashX += 3;
                            splashY -= 2;
                            splash.style.transform = `translate(${splashX}px, ${splashY}px)`;
                            splash.style.opacity = 1 - splashX / 25;
                            if (splashX > 20) { clearInterval(drip); splash.remove(); }
                        }, 25);
                    }

                    if (frame >= 10) {
                        clearInterval(swing);
                        // Return arm to normal
                        setTimeout(() => {
                            if (rightArm) {
                                rightArm.style.transition = 'transform 0.15s';
                                rightArm.style.transform = originalArmTransform || 'rotate(-15deg)';
                            }
                            mug.style.transition = 'opacity 0.15s';
                            mug.style.opacity = '0';
                            setTimeout(() => mug.remove(), 150);
                        }, 80);
                    }
                }, 28);

                if (inRange) setTimeout(() => dealDamage(8, 'COFFEE!'), 220);

            } else if (char === 'vicky') {
                // Vicky: Handbag Whack - swinging designer bag
                const bag = document.createElement('div');
                bag.innerHTML = `
                    <div style="width: 30px; height: 24px; background: linear-gradient(135deg, #c41e3a 0%, #8b0000 100%); border-radius: 5px 5px 8px 8px; position: relative; box-shadow: 2px 2px 4px rgba(0,0,0,0.3);">
                        <div style="position: absolute; top: -7px; left: 7px; width: 14px; height: 8px; border: 2px solid #ffd700; border-bottom: none; border-radius: 6px 6px 0 0;"></div>
                        <div style="position: absolute; top: 7px; left: 50%; transform: translateX(-50%); width: 10px; height: 6px; background: #ffd700; border-radius: 2px;"></div>
                    </div>
                `;
                bag.style.cssText = `position: absolute; left: ${fighterX + 35}px; bottom: 100px; z-index: 150; transform: rotate(-45deg); transform-origin: top center;`;
                arena.appendChild(bag);

                let angle = -45;
                let frame = 0;
                const swing = setInterval(() => {
                    frame++;
                    angle += 9;
                    bag.style.transform = `rotate(${angle}deg)`;
                    bag.style.left = (fighterX + 35 + (angle + 45) * 0.7) + 'px';

                    // Sparkle trail
                    if (frame % 2 === 0) {
                        const sparkle = document.createElement('div');
                        sparkle.style.cssText = `
                            position: absolute; left: ${parseFloat(bag.style.left) + 20 + Math.random() * 10}px;
                            bottom: ${95 + Math.random() * 15}px;
                            width: 5px; height: 5px;
                            background: #ffd700;
                            border-radius: 50%; z-index: 151;
                            box-shadow: 0 0 5px #ffd700;
                        `;
                        arena.appendChild(sparkle);
                        setTimeout(() => { sparkle.style.transition = 'opacity 0.2s, transform 0.2s'; sparkle.style.opacity = '0'; sparkle.style.transform = 'scale(0)'; setTimeout(() => sparkle.remove(), 200); }, 50);
                    }

                    if (angle >= 55) {
                        clearInterval(swing);
                        // Lipstick and compact fly out
                        const items = ['#ff69b4', '#ffd700'];
                        items.forEach((color, i) => {
                            const item = document.createElement('div');
                            item.style.cssText = `
                                position: absolute; left: ${fighterX + 90}px; bottom: 95px;
                                width: 8px; height: ${i === 0 ? 14 : 8}px;
                                background: ${color};
                                border-radius: ${i === 0 ? '2px' : '50%'}; z-index: 148;
                            `;
                            arena.appendChild(item);
                            const itemAngle = (i - 0.5) * 0.8;
                            let ix = 0, iy = 0;
                            const fly = setInterval(() => {
                                ix += 4;
                                iy += itemAngle * 4 - 2;
                                item.style.transform = `translate(${ix}px, ${iy}px) rotate(${ix * 10}deg)`;
                                item.style.opacity = 1 - ix / 50;
                                if (ix > 40) { clearInterval(fly); item.remove(); }
                            }, 25);
                        });
                        bag.style.transition = 'opacity 0.2s';
                        bag.style.opacity = '0';
                        setTimeout(() => bag.remove(), 200);
                    }
                }, 25);

                if (inRange) setTimeout(() => dealDamage(8, 'DESIGNER!'), 200);

            } else if (char === 'fede') {
                // Fede: Hollow Knight Plushie - swings cute plushie toward opponent
                const opponent = document.getElementById('opponent-fighter') || document.getElementById('npc-dummy');
                const opponentX = opponent ? (parseFloat(opponent.style.left) || game.dummyX) : game.dummyX;
                const punchingRight = opponentX > fighterX;

                // Face opponent
                const originalFighterTransform = fighter.style.transform || '';
                if (!punchingRight) {
                    fighter.style.transform = 'scaleX(-1)';
                }

                const rightArm = fighter.querySelector('.arm.right');
                const originalArmTransform = rightArm ? rightArm.style.transform : '';

                // Create hand at end of arm
                const hand = document.createElement('div');
                hand.style.cssText = `
                    position: absolute; right: -8px; bottom: -5px;
                    width: 8px; height: 8px;
                    background: var(--paper, #ffeedd); border: 1px solid var(--ink, #333);
                    border-radius: 50%; z-index: 151;
                `;

                // Create Hollow Knight plushie held by hand
                const plushie = document.createElement('div');
                plushie.innerHTML = `
                    <div style="width: 28px; height: 32px; position: relative;">
                        <div style="width: 28px; height: 24px; background: #1a1a2e; border-radius: 50% 50% 45% 45%; position: relative;">
                            <div style="position: absolute; top: -6px; left: 2px; width: 6px; height: 12px; background: #fff; border-radius: 50% 50% 30% 30%; transform: rotate(-15deg);"></div>
                            <div style="position: absolute; top: -6px; right: 2px; width: 6px; height: 12px; background: #fff; border-radius: 50% 50% 30% 30%; transform: rotate(15deg);"></div>
                            <div style="position: absolute; top: 8px; left: 6px; width: 5px; height: 8px; background: #000; border-radius: 50%;"></div>
                            <div style="position: absolute; top: 8px; right: 6px; width: 5px; height: 8px; background: #000; border-radius: 50%;"></div>
                        </div>
                        <div style="position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 16px; height: 10px; background: #2a2a4e; border-radius: 0 0 6px 6px;"></div>
                    </div>
                `;
                plushie.style.cssText = `
                    position: absolute; right: -25px; bottom: -8px;
                    transform: rotate(-20deg); transform-origin: left center;
                    z-index: 150;
                `;
                hand.appendChild(plushie);

                if (rightArm) {
                    rightArm.appendChild(hand);
                    rightArm.style.transition = 'transform 0.04s linear';
                    rightArm.style.transformOrigin = 'top center';
                }

                let frame = 0;
                const swing = setInterval(() => {
                    frame++;
                    const armAngle = -15 + frame * 9;
                    if (rightArm) {
                        rightArm.style.transform = `rotate(${armAngle}deg)`;
                    }
                    const wobble = Math.sin(frame * 1.5) * 5;
                    plushie.style.transform = `rotate(${-20 + frame * 4 + wobble}deg)`;

                    // Cute dust puffs trail
                    if (frame % 3 === 0) {
                        const puff = document.createElement('div');
                        puff.style.cssText = `
                            position: absolute; left: ${fighterX + 35 + frame * 3}px; bottom: ${95 + Math.random() * 10}px;
                            width: 8px; height: 8px;
                            background: rgba(255,255,255,0.6);
                            border-radius: 50%; z-index: 149;
                        `;
                        arena.appendChild(puff);
                        let puffSize = 8;
                        const expand = setInterval(() => {
                            puffSize += 2;
                            puff.style.width = puffSize + 'px';
                            puff.style.height = puffSize + 'px';
                            puff.style.opacity = 1 - puffSize / 25;
                            if (puffSize > 20) { clearInterval(expand); puff.remove(); }
                        }, 30);
                    }

                    if (armAngle >= 70) {
                        clearInterval(swing);
                        // Squish effect on impact
                        plushie.style.transition = 'transform 0.1s';
                        plushie.style.transform = `rotate(50deg) scale(1.2, 0.7)`;
                        setTimeout(() => {
                            plushie.style.transform = `rotate(50deg) scale(0.9, 1.1)`;
                            setTimeout(() => {
                                if (rightArm) {
                                    rightArm.style.transition = 'transform 0.15s ease-out';
                                    rightArm.style.transform = originalArmTransform || '';
                                    setTimeout(() => {
                                        hand.remove();
                                        rightArm.style.transition = '';
                                        // Restore fighter facing
                                        fighter.style.transform = originalFighterTransform;
                                    }, 150);
                                }
                            }, 100);
                        }, 100);
                    }
                }, 28);

                if (inRange) setTimeout(() => dealDamage(8, 'SHAW!'), 220);

            } else if (char === 'pancho') {
                // Pancho: Power Punch - superhero fist with energy attached to arm
                const rightArm = fighter.querySelector('.arm.right');
                const originalArmTransform = rightArm ? rightArm.style.transform : '';

                // Create glowing fist at end of arm
                const fist = document.createElement('div');
                fist.style.cssText = `
                    position: absolute; right: -12px; bottom: -8px;
                    width: 14px; height: 12px;
                    background: linear-gradient(135deg, #ffd699 0%, #e6b84d 100%);
                    border-radius: 4px 8px 8px 4px;
                    border: 2px solid #cc9933; z-index: 151;
                    box-shadow: 0 0 10px #ff0000, 0 0 20px #ff4444;
                `;

                if (rightArm) {
                    rightArm.appendChild(fist);
                    rightArm.style.transition = 'transform 0.04s linear';
                    rightArm.style.transformOrigin = 'top center';
                }

                let frame = 0;
                const punch = setInterval(() => {
                    frame++;
                    const armAngle = -15 + frame * 10;
                    if (rightArm) {
                        rightArm.style.transform = `rotate(${armAngle}deg)`;
                    }
                    fist.style.boxShadow = `0 0 ${10 + frame * 3}px #ff0000, 0 0 ${20 + frame * 5}px #ff4444`;

                    // Energy trail
                    if (frame % 2 === 0) {
                        const spark = document.createElement('div');
                        spark.style.cssText = `
                            position: absolute; left: ${fighterX + 35 + frame * 3}px; bottom: ${95 + Math.random() * 15}px;
                            width: 8px; height: 8px;
                            background: radial-gradient(circle, #ffcc00 0%, #ff6600 50%, transparent 70%);
                            border-radius: 50%; z-index: 149;
                        `;
                        arena.appendChild(spark);
                        setTimeout(() => { spark.style.transition = 'opacity 0.1s'; spark.style.opacity = '0'; setTimeout(() => spark.remove(), 100); }, 50);
                    }

                    if (armAngle >= 75) {
                        clearInterval(punch);
                        // Impact burst
                        const burst = document.createElement('div');
                        burst.style.cssText = `
                            position: absolute; left: ${fighterX + 60}px; bottom: 90px;
                            width: 30px; height: 30px;
                            background: radial-gradient(circle, #ffcc00 0%, #ff6600 50%, transparent 70%);
                            border-radius: 50%; z-index: 152;
                        `;
                        arena.appendChild(burst);
                        let burstSize = 30;
                        const expandBurst = setInterval(() => {
                            burstSize += 6;
                            burst.style.width = burstSize + 'px';
                            burst.style.height = burstSize + 'px';
                            burst.style.opacity = 1 - burstSize / 80;
                            if (burstSize > 60) { clearInterval(expandBurst); burst.remove(); }
                        }, 25);

                        setTimeout(() => {
                            if (rightArm) {
                                rightArm.style.transition = 'transform 0.15s ease-out';
                                rightArm.style.transform = originalArmTransform || '';
                                setTimeout(() => {
                                    fist.remove();
                                    rightArm.style.transition = '';
                                }, 150);
                            }
                        }, 100);
                    }
                }, 25);

                if (inRange) setTimeout(() => dealDamage(8, 'SUPER!'), 200);

            } else if (char === 'madonna') {
                // Madonna: Microphone Whack - swings mic by the cord
                const micContainer = document.createElement('div');
                micContainer.style.cssText = `position: absolute; left: ${fighterX + 35}px; bottom: 100px; z-index: 150;`;
                arena.appendChild(micContainer);

                // Cord (curved line)
                const cord = document.createElement('div');
                cord.style.cssText = `
                    position: absolute; left: 0; bottom: 0;
                    width: 40px; height: 20px;
                    border: 3px solid #333;
                    border-top: none; border-left: none;
                    border-radius: 0 0 50% 0;
                `;
                micContainer.appendChild(cord);

                // Microphone head
                const mic = document.createElement('div');
                mic.innerHTML = `
                    <div style="width: 18px; height: 28px; position: relative;">
                        <div style="width: 18px; height: 18px; background: linear-gradient(180deg, #888 0%, #444 100%); border-radius: 50%; border: 2px solid #333;"></div>
                        <div style="width: 8px; height: 14px; background: linear-gradient(90deg, #555, #333); margin: 0 auto; border-radius: 0 0 3px 3px;"></div>
                    </div>
                `;
                mic.style.cssText = `position: absolute; left: 35px; bottom: -25px; transform: rotate(45deg);`;
                micContainer.appendChild(mic);

                let swingAngle = 0;
                let frame = 0;
                const swing = setInterval(() => {
                    frame++;
                    swingAngle += 12;

                    // Animate the whole thing swinging
                    micContainer.style.transform = `rotate(${-30 + swingAngle}deg)`;
                    micContainer.style.left = (fighterX + 35 + swingAngle * 0.5) + 'px';

                    // Sparkle effects
                    if (frame % 3 === 0) {
                        const sparkle = document.createElement('div');
                        sparkle.style.cssText = `
                            position: absolute; left: ${fighterX + 60 + swingAngle * 0.4}px; bottom: ${90 + Math.random() * 30}px;
                            width: 4px; height: 4px;
                            background: #e91e8c;
                            border-radius: 50%; z-index: 151;
                            box-shadow: 0 0 6px #e91e8c;
                        `;
                        arena.appendChild(sparkle);
                        setTimeout(() => sparkle.remove(), 150);
                    }

                    if (swingAngle >= 90) {
                        clearInterval(swing);
                        // Mic drop effect
                        micContainer.style.transition = 'opacity 0.2s, transform 0.2s';
                        micContainer.style.opacity = '0';
                        micContainer.style.transform += ' translateY(20px)';
                        setTimeout(() => micContainer.remove(), 200);
                    }
                }, 25);

                if (inRange) setTimeout(() => dealDamage(8, 'MIC DROP!'), 220);

            } else if (char === 'frank') {
                // Frank: Dildo Whack - animate his ACTUAL arm holding the dildo
                const rightArm = fighter.querySelector('.arm.right');
                const originalArmTransform = rightArm ? rightArm.style.transform : '';

                // Create hand at end of arm
                const hand = document.createElement('div');
                hand.style.cssText = `
                    position: absolute; right: -10px; bottom: -6px;
                    width: 8px; height: 8px;
                    background: var(--paper, #ffd699); border: 1px solid var(--ink, #333);
                    border-radius: 50%; z-index: 151;
                `;

                // Create dildo held by hand
                const dildo = document.createElement('div');
                dildo.style.cssText = `
                    position: absolute; right: -6px; bottom: 2px;
                    width: 8px; height: 22px;
                    background: linear-gradient(90deg, #ff69b4 0%, #ff1493 50%, #ff69b4 100%);
                    border-radius: 4px 4px 2px 2px;
                    transform: rotate(-30deg); transform-origin: bottom center;
                    z-index: 150;
                `;
                hand.appendChild(dildo);

                if (rightArm) {
                    rightArm.appendChild(hand);
                    rightArm.style.transition = 'transform 0.05s linear';
                    rightArm.style.transformOrigin = 'top center';
                }

                let frame = 0;
                const swing = setInterval(() => {
                    frame++;
                    // Swing arm from -15deg (idle) to 60deg (forward swing)
                    const armAngle = -15 + frame * 8;
                    if (rightArm) {
                        rightArm.style.transform = `rotate(${armAngle}deg)`;
                    }
                    // Dildo follows arm, wobbles slightly
                    const wobble = Math.sin(frame * 1.2) * 8;
                    dildo.style.transform = `rotate(${-30 + frame * 3 + wobble}deg)`;

                    // Pink sparkle trail
                    if (frame % 2 === 0) {
                        const sparkle = document.createElement('div');
                        sparkle.style.cssText = `
                            position: absolute; left: ${fighterX + 45 + frame * 2}px; bottom: ${95 + Math.random() * 15}px;
                            width: 4px; height: 4px;
                            background: #ff69b4; border-radius: 50%;
                            z-index: 149; opacity: 0.8;
                        `;
                        arena.appendChild(sparkle);
                        setTimeout(() => sparkle.remove(), 120);
                    }

                    if (frame >= 10) {
                        clearInterval(swing);
                        // Return arm to normal
                        setTimeout(() => {
                            if (rightArm) {
                                rightArm.style.transition = 'transform 0.15s';
                                rightArm.style.transform = originalArmTransform || 'rotate(-15deg)';
                            }
                            hand.remove();
                        }, 100);
                    }
                }, 28);

                if (inRange) setTimeout(() => dealDamage(8, 'SMACK!'), 200);

            } else if (char === 'charly') {
                // Charly: Punch - simple but powerful biker fist
                const fist = document.createElement('div');
                fist.innerHTML = `
                    <div style="width: 30px; height: 25px; background: linear-gradient(135deg, #ffd699 0%, #daa520 100%); border-radius: 8px; position: relative; border: 2px solid #b8860b;">
                        <div style="position: absolute; top: 5px; left: 3px; width: 5px; height: 15px; background: #c0c0c0; border-radius: 2px;"></div>
                        <div style="position: absolute; top: 5px; left: 10px; width: 5px; height: 15px; background: #c0c0c0; border-radius: 2px;"></div>
                        <div style="position: absolute; top: 5px; left: 17px; width: 5px; height: 15px; background: #c0c0c0; border-radius: 2px;"></div>
                    </div>
                `;
                fist.style.cssText = `position: absolute; left: ${fighterX + 30}px; bottom: 105px; z-index: 150; transform: scale(0.8);`;
                arena.appendChild(fist);

                // Wind-up
                let phase = 0;
                let punchX = -10;
                const windup = setInterval(() => {
                    phase++;
                    if (phase <= 4) {
                        // Pull back
                        punchX -= 3;
                        fist.style.left = (fighterX + 30 + punchX) + 'px';
                        fist.style.transform = `scale(${0.8 + phase * 0.05})`;
                    } else {
                        clearInterval(windup);
                        // Launch forward
                        const punch = setInterval(() => {
                            punchX += 12;
                            fist.style.left = (fighterX + 30 + punchX) + 'px';
                            fist.style.transform = 'scale(1.1)';

                            // Motion blur
                            const blur = document.createElement('div');
                            blur.style.cssText = `
                                position: absolute; left: ${fighterX + 30 + punchX - 15}px; bottom: 105px;
                                width: 20px; height: 25px;
                                background: rgba(255, 214, 153, 0.4);
                                border-radius: 8px; z-index: 149;
                            `;
                            arena.appendChild(blur);
                            setTimeout(() => blur.remove(), 60);

                            if (punchX >= 55) {
                                clearInterval(punch);
                                // Impact
                                const impact = document.createElement('div');
                                impact.style.cssText = `
                                    position: absolute; left: ${fighterX + 85}px; bottom: 100px;
                                    font-family: 'Bangers', cursive; font-size: 24px;
                                    color: #ff6600; z-index: 152;
                                    text-shadow: 2px 2px 0 #000;
                                `;
                                impact.textContent = 'BAM!';
                                arena.appendChild(impact);
                                setTimeout(() => { impact.style.transition = 'opacity 0.2s'; impact.style.opacity = '0'; setTimeout(() => impact.remove(), 200); }, 150);

                                fist.style.transition = 'opacity 0.15s';
                                fist.style.opacity = '0';
                                setTimeout(() => fist.remove(), 150);
                            }
                        }, 20);
                    }
                }, 30);

                if (inRange) setTimeout(() => dealDamage(8, 'KNUCKLES!'), 180);

            } else if (char === 'audrey') {
                // Audrey: Vine Whip - thorny vine lashes out
                const vineBase = document.createElement('div');
                vineBase.style.cssText = `position: absolute; left: ${fighterX + 45}px; bottom: 100px; z-index: 150;`;
                arena.appendChild(vineBase);

                let vineLength = 0;
                let frame = 0;
                const segments = [];

                const whip = setInterval(() => {
                    frame++;
                    vineLength += 8;

                    // Build segmented vine
                    vineBase.innerHTML = '';
                    const numSegments = Math.floor(vineLength / 12);
                    for (let i = 0; i < numSegments; i++) {
                        const segment = document.createElement('div');
                        const waveOffset = Math.sin((frame + i) * 0.5) * 8;
                        segment.style.cssText = `
                            position: absolute;
                            left: ${i * 11}px;
                            bottom: ${waveOffset}px;
                            width: 12px; height: 10px;
                            background: linear-gradient(180deg, #32cd32 0%, #228b22 50%, #1a5c1a 100%);
                            border-radius: 50%;
                            box-shadow: inset 1px 1px 2px rgba(255,255,255,0.3);
                        `;
                        vineBase.appendChild(segment);

                        // Thorns every other segment
                        if (i % 2 === 0 && i > 0) {
                            const thorn = document.createElement('div');
                            thorn.style.cssText = `
                                position: absolute;
                                left: ${i * 11 + 3}px;
                                bottom: ${waveOffset + 10}px;
                                width: 0; height: 0;
                                border-left: 4px solid transparent;
                                border-right: 4px solid transparent;
                                border-bottom: 10px solid #1a5c1a;
                            `;
                            vineBase.appendChild(thorn);
                        }
                    }

                    if (vineLength >= 80) {
                        clearInterval(whip);
                        // Snap back animation
                        const retract = setInterval(() => {
                            vineLength -= 15;
                            if (vineLength <= 0) {
                                clearInterval(retract);
                                vineBase.remove();
                            } else {
                                vineBase.innerHTML = '';
                                const numSegs = Math.floor(vineLength / 12);
                                for (let i = 0; i < numSegs; i++) {
                                    const seg = document.createElement('div');
                                    seg.style.cssText = `
                                        position: absolute;
                                        left: ${i * 11}px; bottom: 0;
                                        width: 12px; height: 10px;
                                        background: linear-gradient(180deg, #32cd32, #228b22);
                                        border-radius: 50%;
                                    `;
                                    vineBase.appendChild(seg);
                                }
                            }
                        }, 30);
                    }
                }, 25);

                if (inRange) setTimeout(() => dealDamage(8, 'WHIP!'), 200);

            } else {
                // Default punch
                if (inRange) dealDamage(8, 'POW!');
            }

            if (inRange) incrementBassDamage();

            setTimeout(() => {
                fighter.classList.remove('punching');
                fighter.classList.add('idle');
                game.isAttacking = false;
            }, 400);
        }

        function executeKick() {
            const fighter = document.getElementById('player-fighter');
            const arena = document.getElementById('arena');
            game.isAttacking = true;

            fighter.classList.remove('idle');
            fighter.classList.add('kicking');

            const fighterX = parseFloat(fighter.style.left) || game.playerX;
            const fighterHeightOffset = parseFloat(fighter.style.bottom) || 0; // For jump-adjusted projectiles
            const char = game.selectedCharacter;
            const inRange = isInRange(80);

            // Character-specific animated kick attacks
            if (char === 'billy') {
                // Billy: Eraser Throw - arm throws eraser as projectile
                const rightArm = fighter.querySelector('.arm.right');
                const originalArmTransform = rightArm ? getComputedStyle(rightArm).transform : '';

                // Create hand with eraser (initially attached to arm)
                const hand = document.createElement('div');
                hand.style.cssText = `
                    position: absolute; right: -8px; bottom: -5px;
                    width: 7px; height: 7px;
                    background: var(--paper, #ffeedd); border: 1px solid var(--ink, #333);
                    border-radius: 50%; z-index: 151;
                `;

                // Eraser in hand
                const eraserInHand = document.createElement('div');
                eraserInHand.style.cssText = `
                    position: absolute; right: -2px; bottom: 3px;
                    width: 22px; height: 10px;
                    background: linear-gradient(180deg, #8b8b8b 0%, #666 100%);
                    border: 1px solid #444; border-radius: 2px;
                    z-index: 150;
                `;
                hand.appendChild(eraserInHand);

                if (rightArm) {
                    rightArm.appendChild(hand);
                    rightArm.style.transition = 'transform 0.04s linear';
                    rightArm.style.transformOrigin = 'top center';
                }

                // Wind-up then throw
                let frame = 0;
                let thrown = false;
                const throwMotion = setInterval(() => {
                    frame++;

                    if (frame <= 4) {
                        // Wind-up - pull arm back
                        const armAngle = -15 - frame * 10;
                        if (rightArm) rightArm.style.transform = `rotate(${armAngle}deg)`;
                    } else if (frame <= 8) {
                        // Throw forward
                        const armAngle = -55 + (frame - 4) * 25;
                        if (rightArm) rightArm.style.transform = `rotate(${armAngle}deg)`;

                        // Release eraser at frame 6
                        if (frame === 6 && !thrown) {
                            thrown = true;
                            eraserInHand.style.display = 'none';

                            // Create flying eraser projectile (height adjusted for jumping)
                            const eraserBaseHeight = 105 + fighterHeightOffset;
                            const eraser = document.createElement('div');
                            eraser.style.cssText = `
                                position: absolute; left: ${fighterX + 45}px; bottom: ${eraserBaseHeight}px;
                                width: 22px; height: 10px;
                                background: linear-gradient(180deg, #8b8b8b 0%, #666 100%);
                                border: 1px solid #444; border-radius: 2px;
                                z-index: 150;
                            `;
                            arena.appendChild(eraser);

                            // Eraser flies as projectile with proper hit detection
                            let eraserX = fighterX + 45;
                            let eraserY = eraserBaseHeight;
                            const fly = setInterval(() => {
                                eraserX += 15;
                                eraserY -= 1; // Slight arc down
                                eraser.style.left = eraserX + 'px';
                                eraser.style.bottom = eraserY + 'px';
                                eraser.style.transform = `rotate(${(eraserX - fighterX) * 4}deg)`;

                                // Chalk dust
                                if (Math.random() > 0.5) {
                                    const dust = document.createElement('div');
                                    dust.style.cssText = `
                                        position: absolute; left: ${eraserX}px; bottom: ${eraserY - 2 + Math.random() * 6}px;
                                        width: 4px; height: 4px;
                                        background: rgba(255,255,255,0.7); border-radius: 50%; z-index: 149;
                                    `;
                                    arena.appendChild(dust);
                                    setTimeout(() => dust.remove(), 150);
                                }

                                // Hit detection - check current enemy position
                                if (Math.abs(eraserX - game.dummyX) < 40) {
                                    clearInterval(fly);
                                    dealDamage(10, 'ERASED!');
                                    eraser.remove();
                                } else if (eraserX > fighterX + 200) {
                                    clearInterval(fly);
                                    eraser.remove();
                                }
                            }, 25);
                        }
                    } else {
                        clearInterval(throwMotion);
                        // Return arm
                        setTimeout(() => {
                            if (rightArm) {
                                rightArm.style.transition = 'transform 0.15s';
                                rightArm.style.transform = originalArmTransform || 'rotate(-15deg)';
                            }
                            hand.remove();
                        }, 100);
                    }
                }, 35);

            } else if (char === 'jonas') {
                // Jonas M: Punch - animate his ACTUAL arm punching forward
                const rightArm = fighter.querySelector('.arm.right');
                const originalArmTransform = rightArm ? rightArm.style.transform : '';

                // Create fist at end of arm
                const fist = document.createElement('div');
                fist.style.cssText = `
                    position: absolute; right: -14px; bottom: -8px;
                    width: 12px; height: 10px;
                    background: linear-gradient(135deg, var(--paper, #ffd699) 0%, #e6b84d 100%);
                    border: 1px solid var(--ink, #cc9933);
                    border-radius: 4px; z-index: 151;
                `;
                // Knuckle details
                const knuckles = document.createElement('div');
                knuckles.style.cssText = `
                    position: absolute; top: 2px; left: 1px; right: 1px;
                    height: 2px; background: rgba(0,0,0,0.15); border-radius: 1px;
                `;
                fist.appendChild(knuckles);

                if (rightArm) {
                    rightArm.appendChild(fist);
                    rightArm.style.transition = 'transform 0.03s linear';
                    rightArm.style.transformOrigin = 'top center';
                }

                let frame = 0;
                const jab = setInterval(() => {
                    frame++;
                    // Quick jab: arm rotates forward rapidly
                    const armAngle = -15 + frame * 15;
                    if (rightArm) {
                        rightArm.style.transform = `rotate(${Math.min(armAngle, 75)}deg)`;
                    }

                    // Speed blur
                    if (frame % 2 === 0 && frame < 6) {
                        const blur = document.createElement('div');
                        blur.style.cssText = `
                            position: absolute; left: ${fighterX + 35 + frame * 4}px; bottom: 100px;
                            width: 12px; height: 10px;
                            background: rgba(255, 214, 153, 0.4);
                            border-radius: 4px; z-index: 149;
                        `;
                        arena.appendChild(blur);
                        setTimeout(() => blur.remove(), 50);
                    }

                    if (frame >= 6) {
                        // Hold for impact, then retract
                        setTimeout(() => {
                            let retractFrame = 0;
                            const retract = setInterval(() => {
                                retractFrame++;
                                const retractAngle = 75 - retractFrame * 20;
                                if (rightArm) {
                                    rightArm.style.transform = `rotate(${Math.max(retractAngle, -15)}deg)`;
                                }
                                if (retractFrame >= 5) {
                                    clearInterval(retract);
                                    if (rightArm) {
                                        rightArm.style.transition = 'transform 0.1s';
                                        rightArm.style.transform = originalArmTransform || 'rotate(-15deg)';
                                    }
                                    fist.remove();
                                }
                            }, 25);
                        }, 50);
                        clearInterval(jab);
                    }
                }, 20);

                if (inRange) setTimeout(() => dealDamage(10, 'JAB!'), 120);

            } else if (char === 'jonasl') {
                // Jonas L: Bass Slam - animate ACTUAL arms swinging bass overhead
                const rightArm = fighter.querySelector('.arm.right');
                const leftArm = fighter.querySelector('.arm.left');
                const originalRightTransform = rightArm ? rightArm.style.transform : '';
                const originalLeftTransform = leftArm ? leftArm.style.transform : '';

                // Create bass guitar attached to right arm
                const bass = document.createElement('div');
                bass.innerHTML = `
                    <div style="width: 45px; height: 14px; position: relative;">
                        <div style="width: 32px; height: 12px; background: linear-gradient(180deg, #8b0000 0%, #5c0000 100%); border-radius: 8px 2px 2px 8px; position: absolute; left: 0; top: 1px; border: 1px solid #3d0000;"></div>
                        <div style="width: 16px; height: 5px; background: linear-gradient(180deg, #654321, #3d2314); position: absolute; right: 0; top: 5px; border-radius: 2px;"></div>
                        <div style="position: absolute; left: 10px; top: 5px; width: 12px; height: 1px; background: #c0c0c0;"></div>
                        <div style="position: absolute; left: 10px; top: 8px; width: 12px; height: 1px; background: #c0c0c0;"></div>
                    </div>
                `;
                bass.style.cssText = `
                    position: absolute; right: -40px; bottom: -5px;
                    transform: rotate(-40deg); transform-origin: left center;
                    z-index: 150;
                `;

                if (rightArm) {
                    rightArm.appendChild(bass);
                    rightArm.style.transition = 'transform 0.03s linear';
                    rightArm.style.transformOrigin = 'top center';
                }
                if (leftArm) {
                    leftArm.style.transition = 'transform 0.03s linear';
                    leftArm.style.transformOrigin = 'top center';
                }

                let frame = 0;
                const slam = setInterval(() => {
                    frame++;
                    if (frame <= 5) {
                        // Raise arms up (wind up)
                        const raiseAngle = -15 - frame * 20;
                        if (rightArm) rightArm.style.transform = `rotate(${raiseAngle}deg)`;
                        if (leftArm) leftArm.style.transform = `rotate(${raiseAngle - 10}deg)`;
                        bass.style.transform = `rotate(${-40 - frame * 10}deg)`;
                    } else {
                        // Slam down fast
                        const slamAngle = -115 + (frame - 5) * 30;
                        if (rightArm) rightArm.style.transform = `rotate(${Math.min(slamAngle, 70)}deg)`;
                        if (leftArm) leftArm.style.transform = `rotate(${Math.min(slamAngle - 10, 60)}deg)`;
                        bass.style.transform = `rotate(${-90 + (frame - 5) * 20}deg)`;

                        if (frame >= 11) {
                            clearInterval(slam);
                            // Impact - musical notes fly out
                            const notes = ['', '', ''];
                            for (let i = 0; i < 3; i++) {
                                const note = document.createElement('div');
                                note.textContent = notes[i % 3];
                                note.style.cssText = `
                                    position: absolute; left: ${fighterX + 65}px; bottom: 85px;
                                    font-size: 14px; color: #8b0000; z-index: 152;
                                    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
                                `;
                                arena.appendChild(note);
                                const noteAngle = (i / 3) * Math.PI - Math.PI/4;
                                let nx = 0, ny = 0;
                                const fly = setInterval(() => {
                                    nx += Math.cos(noteAngle) * 4;
                                    ny += Math.sin(noteAngle) * 4 - 2;
                                    note.style.transform = `translate(${nx}px, ${ny}px) rotate(${nx * 3}deg)`;
                                    note.style.opacity = 1 - Math.abs(nx) / 40;
                                    if (Math.abs(nx) > 35) { clearInterval(fly); note.remove(); }
                                }, 25);
                            }
                            // Return arms to normal
                            setTimeout(() => {
                                if (rightArm) {
                                    rightArm.style.transition = 'transform 0.15s';
                                    rightArm.style.transform = originalRightTransform || 'rotate(-15deg)';
                                }
                                if (leftArm) {
                                    leftArm.style.transition = 'transform 0.15s';
                                    leftArm.style.transform = originalLeftTransform || 'rotate(15deg)';
                                }
                                bass.remove();
                            }, 120);
                        }
                    }
                }, 28);

                if (inRange) setTimeout(() => dealDamage(10, 'BASS DROP!'), 250);

            } else if (char === 'vicky') {
                // Vicky: Stiletto Kick - animate actual foot with stiletto effect
                const feet = fighter.querySelector('.feet');
                const rightFoot = feet ? feet.children[1] : null;
                const originalFootTransform = rightFoot ? rightFoot.style.transform : '';

                // Create stiletto heel effect attached to foot position
                const stiletto = document.createElement('div');
                stiletto.innerHTML = `
                    <div style="width: 16px; height: 14px; background: linear-gradient(180deg, #c41e3a, #8b0000); clip-path: polygon(0 0, 100% 0, 100% 50%, 80% 100%, 30% 100%, 0 50%); position: relative;">
                        <div style="width: 2px; height: 10px; background: #8b0000; position: absolute; bottom: -8px; right: 2px; transform: rotate(15deg);"></div>
                    </div>
                `;
                stiletto.style.cssText = `position: absolute; left: ${fighterX + 55}px; bottom: 75px; z-index: 150; transform: rotate(-60deg); transform-origin: left center;`;
                arena.appendChild(stiletto);

                if (rightFoot) {
                    rightFoot.style.transition = 'transform 0.03s linear';
                    rightFoot.style.transformOrigin = 'top center';
                }

                let frame = 0;
                const kick = setInterval(() => {
                    frame++;
                    // Animate foot kicking outward
                    const footAngle = -frame * 8;
                    if (rightFoot) {
                        rightFoot.style.transform = `rotate(${footAngle}deg) translateX(${frame * 2}px)`;
                    }

                    // Stiletto follows kick arc
                    const kickProgress = frame / 12;
                    const stilettoX = fighterX + 55 + frame * 5;
                    const stilettoY = 75 + Math.sin(kickProgress * Math.PI) * 20;
                    stiletto.style.left = stilettoX + 'px';
                    stiletto.style.bottom = stilettoY + 'px';
                    stiletto.style.transform = `rotate(${-60 + frame * 8}deg)`;

                    // Elegant sparkle trail
                    if (frame % 2 === 0) {
                        const sparkle = document.createElement('div');
                        sparkle.style.cssText = `
                            position: absolute; left: ${stilettoX + 10}px; bottom: ${stilettoY + 5}px;
                            width: 5px; height: 5px;
                            background: radial-gradient(circle, #fff 0%, #c41e3a 100%);
                            border-radius: 50%; z-index: 151;
                            box-shadow: 0 0 6px #c41e3a;
                        `;
                        arena.appendChild(sparkle);
                        setTimeout(() => { sparkle.style.transition = 'opacity 0.2s, transform 0.2s'; sparkle.style.opacity = '0'; sparkle.style.transform = 'scale(0)'; setTimeout(() => sparkle.remove(), 200); }, 80);
                    }

                    if (frame >= 12) {
                        clearInterval(kick);
                        // Return foot to normal
                        setTimeout(() => {
                            if (rightFoot) {
                                rightFoot.style.transition = 'transform 0.15s';
                                rightFoot.style.transform = originalFootTransform || '';
                            }
                            stiletto.style.transition = 'opacity 0.15s';
                            stiletto.style.opacity = '0';
                            setTimeout(() => stiletto.remove(), 150);
                        }, 80);
                    }
                }, 22);

                if (inRange) setTimeout(() => dealDamage(10, 'STILETTO!'), 200);

            } else if (char === 'fede') {
                // Fede: Traveler's Kick - always kick toward opponent
                // Simple, clean animation - just tilt the character
                const opponent = document.getElementById('opponent-fighter') || document.getElementById('npc-dummy');
                const opponentX = opponent ? (parseFloat(opponent.style.left) || game.dummyX) : game.dummyX;
                const kickingRight = opponentX > fighterX;

                // Lunge toward opponent with kick motion
                fighter.style.transition = 'transform 0.15s ease-out';
                fighter.style.transformOrigin = 'center bottom';
                if (kickingRight) {
                    fighter.style.transform = 'rotate(-15deg) translateX(15px)';
                } else {
                    fighter.style.transform = 'rotate(15deg) translateX(-15px) scaleX(-1)';
                }

                // Return to normal after kick
                setTimeout(() => {
                    fighter.style.transform = '';
                    fighter.style.transformOrigin = '';
                }, 200);

                if (inRange) setTimeout(() => dealDamage(10, 'KICKED!'), 100);

            } else if (char === 'pancho') {
                // Pancho: Flying Kick - superhero flying kick with cape
                const cape = document.createElement('div');
                cape.style.cssText = `
                    position: absolute; left: ${fighterX}px; bottom: 80px;
                    width: 25px; height: 50px;
                    background: linear-gradient(90deg, #dc2626, #ef4444, transparent);
                    clip-path: polygon(0 0, 100% 20%, 100% 80%, 0 100%);
                    z-index: 149;
                `;
                arena.appendChild(cape);

                const boot = document.createElement('div');
                boot.style.cssText = `
                    position: absolute; left: ${fighterX + 40}px; bottom: 90px;
                    width: 35px; height: 18px;
                    background: linear-gradient(180deg, #dc2626, #991b1b);
                    border-radius: 5px 15px 15px 5px;
                    border: 2px solid #7f1d1d; z-index: 150;
                    box-shadow: 0 0 15px #ff4444;
                `;
                arena.appendChild(boot);

                fighter.style.transform = 'rotate(-10deg) translateY(-15px)';

                let frame = 0;
                let bootX = 0;
                const fly = setInterval(() => {
                    frame++;
                    bootX += 10;

                    boot.style.left = (fighterX + 40 + bootX) + 'px';
                    boot.style.boxShadow = `${-bootX/3}px 0 ${20 + frame * 2}px #ff4444`;

                    cape.style.width = (25 + frame * 8) + 'px';
                    cape.style.left = (fighterX - frame * 5) + 'px';

                    // Energy trail
                    if (frame % 2 === 0) {
                        const trail = document.createElement('div');
                        trail.style.cssText = `
                            position: absolute; left: ${fighterX + 40 + bootX - 15}px; bottom: ${88 + Math.random() * 10}px;
                            width: 20px; height: 4px;
                            background: linear-gradient(90deg, transparent, #ffcc00, #ff6600);
                            border-radius: 2px; z-index: 148;
                        `;
                        arena.appendChild(trail);
                        setTimeout(() => trail.remove(), 80);
                    }

                    if (bootX >= 60) {
                        clearInterval(fly);
                        // Impact burst
                        const burst = document.createElement('div');
                        burst.style.cssText = `
                            position: absolute; left: ${fighterX + 95}px; bottom: 85px;
                            width: 50px; height: 50px;
                            background: radial-gradient(circle, #ffcc00 0%, #ff6600 40%, transparent 70%);
                            border-radius: 50%; z-index: 152;
                        `;
                        arena.appendChild(burst);
                        setTimeout(() => burst.remove(), 150);

                        fighter.style.transform = '';
                        cape.style.transition = 'opacity 0.2s';
                        cape.style.opacity = '0';
                        boot.style.transition = 'opacity 0.15s';
                        boot.style.opacity = '0';
                        setTimeout(() => { cape.remove(); boot.remove(); }, 200);
                    }
                }, 22);

                if (inRange) setTimeout(() => dealDamage(10, 'FLIGHT!'), 160);

            } else if (char === 'madonna') {
                // Madonna: Vogue Slap - strikes a pose then slaps
                fighter.style.transition = 'transform 0.15s';
                fighter.style.transform = 'rotate(5deg)';

                // Frame hands
                const leftHand = document.createElement('div');
                leftHand.style.cssText = `
                    position: absolute; left: ${fighterX + 20}px; bottom: 130px;
                    width: 18px; height: 18px;
                    background: #ffd699; border-radius: 50%;
                    border: 2px solid #e6b84d; z-index: 150;
                `;
                const rightHand = document.createElement('div');
                rightHand.style.cssText = `
                    position: absolute; left: ${fighterX + 60}px; bottom: 130px;
                    width: 18px; height: 18px;
                    background: #ffd699; border-radius: 50%;
                    border: 2px solid #e6b84d; z-index: 150;
                `;
                arena.appendChild(leftHand);
                arena.appendChild(rightHand);

                // Vogue frame pose
                let phase = 0;
                const vogue = setInterval(() => {
                    phase++;

                    if (phase <= 4) {
                        // Hands come together framing face
                        leftHand.style.left = (fighterX + 20 + phase * 5) + 'px';
                        leftHand.style.bottom = (130 + phase * 3) + 'px';
                        rightHand.style.left = (fighterX + 60 - phase * 5) + 'px';
                        rightHand.style.bottom = (130 + phase * 3) + 'px';

                        // Sparkles around pose
                        const sparkle = document.createElement('div');
                        sparkle.style.cssText = `
                            position: absolute; left: ${fighterX + 40 + (Math.random() - 0.5) * 40}px;
                            bottom: ${135 + Math.random() * 20}px;
                            width: 4px; height: 4px;
                            background: #e91e8c;
                            border-radius: 50%; z-index: 151;
                            box-shadow: 0 0 5px #e91e8c;
                        `;
                        arena.appendChild(sparkle);
                        setTimeout(() => sparkle.remove(), 200);
                    } else if (phase <= 8) {
                        // Slap forward
                        rightHand.style.left = (fighterX + 40 + (phase - 4) * 12) + 'px';
                        rightHand.style.bottom = (142 - (phase - 4) * 8) + 'px';
                        rightHand.style.transform = `scale(${1 + (phase - 4) * 0.1})`;
                    } else {
                        clearInterval(vogue);
                        // Slap impact
                        const slap = document.createElement('div');
                        slap.textContent = 'SLAP!';
                        slap.style.cssText = `
                            position: absolute; left: ${fighterX + 90}px; bottom: 110px;
                            font-family: 'Bangers', cursive; font-size: 20px;
                            color: #e91e8c; z-index: 152;
                            text-shadow: 2px 2px 0 #fff;
                            transform: rotate(-10deg);
                        `;
                        arena.appendChild(slap);
                        setTimeout(() => { slap.style.transition = 'opacity 0.2s'; slap.style.opacity = '0'; setTimeout(() => slap.remove(), 200); }, 150);

                        fighter.style.transform = '';
                        leftHand.style.transition = 'opacity 0.2s';
                        rightHand.style.transition = 'opacity 0.2s';
                        leftHand.style.opacity = '0';
                        rightHand.style.opacity = '0';
                        setTimeout(() => { leftHand.remove(); rightHand.remove(); }, 200);
                    }
                }, 35);

                if (inRange) setTimeout(() => dealDamage(10, 'VOGUE!'), 260);

            } else if (char === 'frank') {
                // Frank: High Kick - animate his ACTUAL right leg and foot
                const legs = fighter.querySelector('.legs');
                const feet = fighter.querySelector('.feet');
                const rightLeg = legs ? legs.children[1] : null; // Second leg
                const rightFoot = feet ? feet.children[1] : null; // Second foot

                const featherColors = ['#ff69b4', '#ff1493', '#ffffff', '#ffd700'];

                // Store original styles
                const origLegTransform = rightLeg ? rightLeg.style.transform : '';
                const origFootTransform = rightFoot ? rightFoot.style.transform : '';

                // Set up leg for animation
                if (rightLeg) {
                    rightLeg.style.transition = 'transform 0.03s linear';
                    rightLeg.style.transformOrigin = 'top center';
                    rightLeg.style.position = 'relative';
                    rightLeg.style.zIndex = '10';
                }
                if (rightFoot) {
                    rightFoot.style.transition = 'transform 0.03s linear';
                    rightFoot.style.transformOrigin = 'top center';
                    rightFoot.style.position = 'relative';
                    rightFoot.style.zIndex = '10';
                }

                // Slight body lean back for balance
                fighter.style.transition = 'transform 0.1s';
                fighter.style.transform = 'rotate(5deg)';

                let frame = 0;
                const kick = setInterval(() => {
                    frame++;

                    // Animate leg kicking up and out (0 to -70 degrees = kick forward/up)
                    const legAngle = -frame * 7;
                    if (rightLeg) {
                        rightLeg.style.transform = `rotate(${legAngle}deg) translateX(${frame * 1.5}px)`;
                    }
                    // Foot follows leg, stays at end
                    if (rightFoot) {
                        rightFoot.style.transform = `rotate(${legAngle * 0.8}deg) translateX(${frame * 2}px) translateY(${-frame * 2}px)`;
                    }

                    // Feathers burst from the kick
                    if (frame % 2 === 0) {
                        const feather = document.createElement('div');
                        feather.style.cssText = `
                            position: absolute; left: ${fighterX + 40 + frame * 3}px;
                            bottom: ${70 + frame * 3}px;
                            width: 6px; height: 3px;
                            background: ${featherColors[frame % 4]};
                            border-radius: 50%; z-index: 151;
                        `;
                        arena.appendChild(feather);
                        let fy = 0;
                        const fall = setInterval(() => {
                            fy += 2;
                            feather.style.bottom = (parseFloat(feather.style.bottom) - fy) + 'px';
                            feather.style.opacity = 1 - fy / 30;
                            if (fy > 25) { clearInterval(fall); feather.remove(); }
                        }, 30);
                    }

                    if (frame >= 10) {
                        clearInterval(kick);

                        // Hold the kick pose briefly
                        setTimeout(() => {
                            // Return leg and foot to normal
                            if (rightLeg) {
                                rightLeg.style.transition = 'transform 0.15s ease-out';
                                rightLeg.style.transform = origLegTransform || '';
                            }
                            if (rightFoot) {
                                rightFoot.style.transition = 'transform 0.15s ease-out';
                                rightFoot.style.transform = origFootTransform || '';
                            }
                            fighter.style.transform = '';
                        }, 80);
                    }
                }, 25);

                if (inRange) setTimeout(() => dealDamage(10, 'SHOWTIME!'), 220);

            } else if (char === 'charly') {
                // Charly: Motorbike Rev - revs forward on motorcycle
                const bike = document.createElement('div');
                bike.innerHTML = `
                    <div style="width: 80px; height: 45px; position: relative;">
                        <div style="position: absolute; bottom: 0; left: 10px; width: 20px; height: 20px; background: #333; border-radius: 50%; border: 3px solid #666;"></div>
                        <div style="position: absolute; bottom: 0; right: 5px; width: 20px; height: 20px; background: #333; border-radius: 50%; border: 3px solid #666;"></div>
                        <div style="position: absolute; bottom: 8px; left: 15px; width: 50px; height: 20px; background: linear-gradient(180deg, #1a1a1a, #333); border-radius: 5px 15px 5px 5px;"></div>
                        <div style="position: absolute; bottom: 20px; left: 35px; width: 20px; height: 15px; background: #8b0000; border-radius: 3px;"></div>
                        <div style="position: absolute; bottom: 15px; right: 8px; width: 12px; height: 8px; background: #666; border-radius: 2px;"></div>
                        <div style="position: absolute; bottom: 28px; left: 15px; width: 8px; height: 12px; background: #c0c0c0; border-radius: 2px; transform: rotate(-30deg);"></div>
                    </div>
                `;
                bike.style.cssText = `position: absolute; left: ${fighterX - 20}px; bottom: 60px; z-index: 150;`;
                arena.appendChild(bike);

                // Revving animation
                let frame = 0;
                let bikeX = 0;
                let revPhase = 0;

                const rev = setInterval(() => {
                    frame++;
                    revPhase++;

                    if (frame <= 6) {
                        // Revving in place with shake
                        bike.style.transform = `translateY(${Math.sin(revPhase * 2) * 2}px) rotate(${Math.sin(revPhase * 3) * 2}deg)`;

                        // Exhaust smoke
                        const smoke = document.createElement('div');
                        smoke.style.cssText = `
                            position: absolute; left: ${fighterX - 25}px; bottom: ${65 + Math.random() * 10}px;
                            width: ${6 + Math.random() * 4}px; height: ${6 + Math.random() * 4}px;
                            background: rgba(100, 100, 100, 0.6);
                            border-radius: 50%; z-index: 148;
                        `;
                        arena.appendChild(smoke);
                        let smokeX = 0;
                        const puff = setInterval(() => {
                            smokeX -= 4;
                            smoke.style.left = (fighterX - 25 + smokeX) + 'px';
                            smoke.style.opacity = 0.6 - Math.abs(smokeX) / 40;
                            smoke.style.transform = `scale(${1 + Math.abs(smokeX) / 30})`;
                            if (smokeX < -35) { clearInterval(puff); smoke.remove(); }
                        }, 25);
                    } else {
                        // Charge forward
                        bikeX += 15;
                        bike.style.left = (fighterX - 20 + bikeX) + 'px';
                        bike.style.transform = `translateY(${Math.sin(bikeX * 0.5) * 3}px)`;

                        // Speed lines
                        const line = document.createElement('div');
                        line.style.cssText = `
                            position: absolute; left: ${fighterX - 20 + bikeX - 30}px; bottom: ${70 + Math.random() * 20}px;
                            width: 25px; height: 2px;
                            background: linear-gradient(90deg, transparent, #888);
                            z-index: 147;
                        `;
                        arena.appendChild(line);
                        setTimeout(() => line.remove(), 60);

                        if (bikeX >= 80) {
                            clearInterval(rev);
                            // Impact
                            const impact = document.createElement('div');
                            impact.textContent = 'VROOM!';
                            impact.style.cssText = `
                                position: absolute; left: ${fighterX + 70}px; bottom: 90px;
                                font-family: 'Bangers', cursive; font-size: 22px;
                                color: #ff6600; z-index: 152;
                                text-shadow: 2px 2px 0 #000;
                            `;
                            arena.appendChild(impact);
                            setTimeout(() => { impact.style.transition = 'opacity 0.2s'; impact.style.opacity = '0'; setTimeout(() => impact.remove(), 200); }, 150);

                            bike.style.transition = 'opacity 0.2s';
                            bike.style.opacity = '0';
                            setTimeout(() => bike.remove(), 200);
                        }
                    }
                }, 30);

                if (inRange) setTimeout(() => dealDamage(10, 'BURNOUT!'), 280);

            } else if (char === 'audrey') {
                // Audrey: Bite - chomping jaws attack
                const topJaw = document.createElement('div');
                topJaw.style.cssText = `
                    position: absolute; left: ${fighterX + 50}px; bottom: 125px;
                    width: 45px; height: 22px; background: linear-gradient(180deg, #32cd32, #228b22);
                    clip-path: polygon(0 100%, 8% 0, 20% 100%, 32% 0, 44% 100%, 56% 0, 68% 100%, 80% 0, 92% 100%, 100% 0, 100% 100%);
                    z-index: 150; transform-origin: bottom center;
                    box-shadow: inset 0 -5px 10px rgba(0,0,0,0.3);
                `;
                const bottomJaw = document.createElement('div');
                bottomJaw.style.cssText = `
                    position: absolute; left: ${fighterX + 50}px; bottom: 82px;
                    width: 45px; height: 22px; background: linear-gradient(180deg, #1a5c1a, #228b22);
                    clip-path: polygon(0 0, 8% 100%, 20% 0, 32% 100%, 44% 0, 56% 100%, 68% 0, 80% 100%, 92% 0, 100% 100%, 100% 0);
                    z-index: 150; transform-origin: top center;
                    box-shadow: inset 0 5px 10px rgba(0,0,0,0.3);
                `;
                arena.appendChild(topJaw);
                arena.appendChild(bottomJaw);

                // Inner mouth
                const mouth = document.createElement('div');
                mouth.style.cssText = `
                    position: absolute; left: ${fighterX + 55}px; bottom: 95px;
                    width: 35px; height: 35px;
                    background: radial-gradient(circle, #ff0000 0%, #8b0000 70%, #4a0000 100%);
                    border-radius: 50%; z-index: 149;
                `;
                arena.appendChild(mouth);

                let jawX = 0;
                let bitePhase = 0;
                let chomps = 0;
                const chomp = setInterval(() => {
                    jawX += 5;
                    bitePhase++;

                    topJaw.style.left = (fighterX + 50 + jawX) + 'px';
                    bottomJaw.style.left = (fighterX + 50 + jawX) + 'px';
                    mouth.style.left = (fighterX + 55 + jawX) + 'px';

                    // Chomping motion
                    if (bitePhase % 5 < 2) {
                        topJaw.style.transform = 'rotate(-20deg)';
                        bottomJaw.style.transform = 'rotate(20deg)';
                        chomps++;

                        // Drool/slime effect on chomp
                        if (chomps % 2 === 0) {
                            const slime = document.createElement('div');
                            slime.style.cssText = `
                                position: absolute; left: ${fighterX + 60 + jawX}px; bottom: 95px;
                                width: 4px; height: 8px;
                                background: #90ee90;
                                border-radius: 0 0 4px 4px; z-index: 148;
                            `;
                            arena.appendChild(slime);
                            let slimeY = 0;
                            const drip = setInterval(() => {
                                slimeY += 3;
                                slime.style.bottom = (95 - slimeY) + 'px';
                                slime.style.height = (8 + slimeY/2) + 'px';
                                slime.style.opacity = 1 - slimeY / 30;
                                if (slimeY > 25) { clearInterval(drip); slime.remove(); }
                            }, 30);
                        }
                    } else {
                        topJaw.style.transform = 'rotate(0deg)';
                        bottomJaw.style.transform = 'rotate(0deg)';
                    }

                    if (jawX >= 65) {
                        clearInterval(chomp);
                        // Final big chomp
                        topJaw.style.transition = 'transform 0.08s';
                        bottomJaw.style.transition = 'transform 0.08s';
                        topJaw.style.transform = 'rotate(-30deg)';
                        bottomJaw.style.transform = 'rotate(30deg)';
                        setTimeout(() => {
                            topJaw.style.transform = 'rotate(5deg)';
                            bottomJaw.style.transform = 'rotate(-5deg)';
                            setTimeout(() => {
                                topJaw.style.transition = 'opacity 0.15s';
                                bottomJaw.style.transition = 'opacity 0.15s';
                                mouth.style.transition = 'opacity 0.15s';
                                topJaw.style.opacity = '0';
                                bottomJaw.style.opacity = '0';
                                mouth.style.opacity = '0';
                                setTimeout(() => { topJaw.remove(); bottomJaw.remove(); mouth.remove(); }, 150);
                            }, 80);
                        }, 80);
                    }
                }, 25);

                if (inRange) setTimeout(() => dealDamage(10, 'CHOMP!'), 300);

            } else {
                // Default kick
                if (inRange) dealDamage(10, 'WHAM!');
            }

            if (inRange) incrementBassDamage();

            setTimeout(() => {
                fighter.classList.remove('kicking');
                fighter.classList.add('idle');
                game.isAttacking = false;
            }, 450);
        }

        function executeJump() {
            const fighter = document.getElementById('player-fighter');
            game.isJumping = true;

            fighter.classList.remove('idle');
            fighter.classList.add('jumping');

            setTimeout(() => {
                fighter.classList.remove('jumping');
                fighter.classList.add('idle');
                game.isJumping = false;
            }, 500);
        }

        function isInRange(range = 120) {
            // Check opponent fighter (tournament mode) or NPC dummy (practice mode)
            const opponent = document.getElementById('opponent-fighter') || document.getElementById('npc-dummy');
            if (!opponent) return false;

            const opponentRect = opponent.getBoundingClientRect();
            const opponentX = opponentRect.left;

            const arena = document.getElementById('arena');
            const arenaRect = arena.getBoundingClientRect();
            const playerScreenX = arenaRect.left + game.playerX;

            return Math.abs(opponentX - playerScreenX) < range;
        }

        function dealDamage(amount, text = 'HIT!') {
            game.dummyHealth = Math.max(0, game.dummyHealth - amount);
            game.playerEnergy = Math.min(100, game.playerEnergy + amount);

            // Support both tournament opponent and practice dummy
            const opponent = document.getElementById('opponent-fighter') || document.getElementById('npc-dummy');
            if (opponent) {
                opponent.classList.add('hit');
                setTimeout(() => opponent.classList.remove('hit'), 300);
            }

            // Show impact effect
            showImpact(text, amount);

            updateUI();

            if (game.dummyHealth <= 0) {
                showResult('YOU WIN!');
            }
        }
        window.dealDamage = dealDamage;

        function showImpact(text, damage) {
            // Support both tournament opponent and practice dummy
            const opponent = document.getElementById('opponent-fighter') || document.getElementById('npc-dummy');
            if (!opponent) return;
            const rect = opponent.getBoundingClientRect();
            const arena = document.getElementById('arena');
            const arenaRect = arena.getBoundingClientRect();

            // Impact star
            const star = document.createElement('div');
            star.className = 'impact-effect';
            star.innerHTML = '<div class="impact-star"></div>';
            star.style.left = (rect.left - arenaRect.left + 20) + 'px';
            star.style.top = (rect.top - arenaRect.top + 40) + 'px';
            arena.appendChild(star);
            setTimeout(() => star.remove(), 300);

            // Hit text
            const hitText = document.createElement('div');
            hitText.className = 'impact-effect hit-text';
            hitText.textContent = text;
            hitText.style.left = (rect.left - arenaRect.left) + 'px';
            hitText.style.top = (rect.top - arenaRect.top + 10) + 'px';
            arena.appendChild(hitText);
            setTimeout(() => hitText.remove(), 400);

            // Damage number
            const dmgNum = document.createElement('div');
            dmgNum.className = 'impact-effect damage-number';
            dmgNum.textContent = '-' + damage;
            dmgNum.style.left = (rect.left - arenaRect.left + 30) + 'px';
            dmgNum.style.top = (rect.top - arenaRect.top + 30) + 'px';
            arena.appendChild(dmgNum);
            setTimeout(() => dmgNum.remove(), 600);
        }

        function executeSpecial(special) {
            const fighter = document.getElementById('player-fighter');
            game.isAttacking = true;

            fighter.classList.remove('idle');

            // Deduct energy for ultimates
            if (special.ultimate) {
                game.playerEnergy = 0;
                updateUI();
            }

            updateComboDisplay(special.name + '!');

            // Execute based on character and move
            const char = game.selectedCharacter;

            if (char === 'pato') {
                executePatoSpecial(special, fighter);
            } else if (char === 'billy') {
                executeBillySpecial(special, fighter);
            } else if (char === 'jonas') {
                executeJonasSpecial(special, fighter);
            } else if (char === 'lucas') {
                executeLucasSpecial(special, fighter);
            } else if (char === 'jonasl') {
                executeJonasLSpecial(special, fighter);
            } else if (char === 'vicky') {
                executeVickySpecial(special, fighter);
            } else if (char === 'fede') {
                executeFedeSpecial(special, fighter);
            } else if (char === 'timo') {
                executeTimoSpecial(special, fighter);
            } else if (char === 'pancho') {
                executePanchoSpecial(special, fighter);
            } else if (char === 'madonna') {
                executeMadonnaSpecial(special, fighter);
            } else if (char === 'frank') {
                executeFrankSpecial(special, fighter);
            } else if (char === 'charly') {
                executeCharlySpecial(special, fighter);
            } else if (char === 'audrey') {
                executeAudreySpecial(special, fighter);
            }
        }

        function executePatoSpecial(special, fighter) {
            const arena = document.getElementById('arena');

            if (special.name === 'Bitcoin Throw') {
                fighter.classList.add('special-bitcoin');

                const dummy = document.getElementById('npc-dummy');
                const dummyRect = dummy.getBoundingClientRect();
                const arenaRect = arena.getBoundingClientRect();
                const dummyX = dummyRect.left - arenaRect.left;

                // Throw 2 coins in quick succession
                const coinOffsets = [0, 120]; // timing offsets
                const coinHeights = [130, 115]; // different heights

                coinOffsets.forEach((delay, i) => {
                    setTimeout(() => {
                        // Create bitcoin coin
                        const coin = document.createElement('div');
                        coin.style.cssText = `
                            position: absolute;
                            width: 28px;
                            height: 28px;
                            background: linear-gradient(135deg, #f7931a 0%, #ffb347 50%, #f7931a 100%);
                            border: 3px solid #c77800;
                            border-radius: 50%;
                            z-index: 155;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-family: 'Arial', sans-serif;
                            font-weight: bold;
                            font-size: 16px;
                            color: #fff;
                            text-shadow: 1px 1px 0 #c77800;
                            box-shadow: 0 0 8px rgba(247,147,26,0.5);
                        `;
                        coin.textContent = '';
                        coin.style.left = (game.playerX + 50) + 'px';
                        coin.style.bottom = coinHeights[i] + 'px';
                        arena.appendChild(coin);

                        // Animate coin flying
                        const startX = game.playerX + 50;
                        let progress = 0;

                        const coinFly = setInterval(() => {
                            progress += 0.06;
                            const currentX = startX + (dummyX - startX) * progress;
                            const arc = Math.sin(progress * Math.PI) * (25 + i * 10);

                            coin.style.left = currentX + 'px';
                            coin.style.bottom = (coinHeights[i] + arc) + 'px';
                            coin.style.transform = `rotate(${progress * 720}deg)`;

                            // Sparkle trail (subtle)
                            if (progress > 0.1 && progress < 0.9 && Math.random() > 0.7) {
                                const sparkle = document.createElement('div');
                                sparkle.textContent = '';
                                sparkle.style.cssText = `
                                    position: absolute;
                                    font-size: 0.8rem;
                                    color: #f7931a;
                                    opacity: 0.8;
                                    z-index: 150;
                                    pointer-events: none;
                                `;
                                sparkle.style.left = (currentX + Math.random() * 10) + 'px';
                                sparkle.style.bottom = (coinHeights[i] + arc - 5) + 'px';
                                arena.appendChild(sparkle);
                                setTimeout(() => sparkle.remove(), 150);
                            }

                            if (progress >= 1) {
                                clearInterval(coinFly);
                                // Only deal damage on first coin hit
                                if (i === 0) {
                                    dealDamage(special.damage, '');
                                } else {
                                    // Second coin shows small price up
                                    const priceUp = document.createElement('div');
                                    priceUp.textContent = '+%';
                                    priceUp.style.cssText = `
                                        position: absolute;
                                        font-family: 'Patrick Hand', cursive;
                                        font-size: 1rem;
                                        color: #27ae60;
                                        z-index: 160;
                                    `;
                                    priceUp.style.left = dummyX + 'px';
                                    priceUp.style.bottom = '160px';
                                    arena.appendChild(priceUp);

                                    let upProgress = 0;
                                    const floatUp = setInterval(() => {
                                        upProgress += 0.1;
                                        priceUp.style.bottom = (160 + upProgress * 20) + 'px';
                                        priceUp.style.opacity = 1 - upProgress;
                                        if (upProgress >= 1) {
                                            clearInterval(floatUp);
                                            priceUp.remove();
                                        }
                                    }, 30);
                                }
                                coin.remove();
                            }
                        }, 25);
                    }, delay);
                });

                setTimeout(() => {
                    fighter.classList.remove('special-bitcoin');
                    fighter.classList.add('idle');
                    game.isAttacking = false;
                }, 600);

            } else if (special.name === "Director's Cut") {
                // Pato RUSHES forward with film strip trailing behind
                const startX = game.playerX;
                let hitDealt = false;

                // Create film strip trail that follows Pato
                const film = document.createElement('div');
                film.className = 'projectile film-strip';
                film.style.left = (game.playerX - 60) + 'px';
                film.style.bottom = '115px';
                film.style.zIndex = '90';
                arena.appendChild(film);

                // Rush forward
                let progress = 0;
                const rushDistance = 250;

                const rushInterval = setInterval(() => {
                    progress += 0.06;
                    const currentX = startX + rushDistance * progress;
                    game.playerX = currentX;
                    fighter.style.left = currentX + 'px';

                    // Film strip trails behind
                    film.style.left = (currentX - 60) + 'px';
                    film.style.width = (80 + progress * 40) + 'px';

                    // Check collision during rush
                    if (!hitDealt && isInRange(60)) {
                        dealDamage(special.damage, 'CUT!');
                        hitDealt = true;

                        // Show "CUT!" callout
                        const cutText = document.createElement('div');
                        cutText.className = 'impact-effect';
                        cutText.textContent = 'CUT!';
                        cutText.style.fontFamily = "'Permanent Marker', cursive";
                        cutText.style.fontSize = '2rem';
                        cutText.style.color = 'var(--orange)';
                        cutText.style.left = (currentX + 40) + 'px';
                        cutText.style.top = '70px';
                        arena.appendChild(cutText);
                        setTimeout(() => cutText.remove(), 400);
                    }

                    if (progress >= 1) {
                        clearInterval(rushInterval);
                        film.remove();
                        fighter.classList.add('idle');
                        game.isAttacking = false;

                        if (!hitDealt) {
                            updateComboDisplay('Missed!');
                        }
                    }
                }, 25);

            } else if (special.name === 'Stack Overflow') {
                fighter.classList.add('special-stack');

                // Get dummy position - brackets rain ON the dummy
                const dummy = document.getElementById('npc-dummy');
                const dummyRect = dummy.getBoundingClientRect();
                const arenaRect = arena.getBoundingClientRect();
                const dummyX = dummyRect.left - arenaRect.left;
                // Calculate where the dummy's head is (top of dummy relative to arena)
                const dummyTopY = dummyRect.top - arenaRect.top;

                // Rain of code brackets targeting the dummy
                const brackets = ['{', '}', '[', ']', '</>'];
                let hitsLanded = 0;

                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        const bracket = document.createElement('div');
                        bracket.className = 'projectile code-bracket';
                        bracket.textContent = brackets[i];
                        bracket.style.zIndex = '150';
                        // Spread around dummy position
                        bracket.style.left = (dummyX - 40 + i * 20) + 'px';
                        bracket.style.top = '-40px';
                        arena.appendChild(bracket);

                        // Animate falling ALL THE WAY DOWN to hit the dummy
                        let y = -40;
                        const targetY = dummyTopY + 30; // Hit the dummy's body area

                        const fall = setInterval(() => {
                            y += 15; // Faster fall
                            bracket.style.top = y + 'px';
                            bracket.style.transform = `scale(${1 + y/150}) rotate(${y * 2}deg)`;

                            if (y >= targetY) {
                                clearInterval(fall);
                                hitsLanded++;
                                // Each bracket deals damage when it HITS
                                if (hitsLanded <= 3) {
                                    dealDamage(Math.floor(special.damage / 3), brackets[i]);
                                }
                                // Flash red and explode effect
                                bracket.style.color = 'var(--red)';
                                bracket.style.transform += ' scale(1.5)';
                                setTimeout(() => bracket.remove(), 150);
                            }
                        }, 20);
                    }, i * 100);
                }

                // Show ERROR 500 at the end
                setTimeout(() => {
                    const errorText = document.createElement('div');
                    errorText.className = 'impact-effect hit-text';
                    errorText.textContent = 'ERROR 500!';
                    errorText.style.fontSize = '2.5rem';
                    errorText.style.color = 'var(--orange)';
                    errorText.style.left = dummyX + 'px';
                    errorText.style.top = (dummyTopY - 30) + 'px';
                    arena.appendChild(errorText);
                    setTimeout(() => errorText.remove(), 500);
                }, 600);

                setTimeout(() => {
                    fighter.classList.remove('special-stack');
                    fighter.classList.add('idle');
                    game.isAttacking = false;
                }, 1000);

            } else if (special.name === 'TO THE MOON!') {
                fighter.classList.add('special-moon');

                // Rocket travels horizontally first, then launches up at target
                const rocketStartX = game.playerX + 30;
                let rocketX = rocketStartX;
                let rocketY = 80;
                let phase = 'horizontal'; // horizontal -> vertical -> explode

                const rocket = document.createElement('div');
                rocket.className = 'projectile rocket';
                rocket.innerHTML = `
                    <div class="rocket-body" style="transform: rotate(90deg);">
                        <span>B</span>
                        <div class="rocket-fin left"></div>
                        <div class="rocket-fin right"></div>
                    </div>
                    <div class="rocket-flame" style="transform: rotate(90deg);"></div>
                `;
                rocket.style.left = rocketX + 'px';
                rocket.style.bottom = rocketY + 'px';
                rocket.style.zIndex = '150';
                arena.appendChild(rocket);

                // Trail effect
                const createTrail = () => {
                    const trail = document.createElement('div');
                    trail.style.cssText = `
                        position: absolute;
                        left: ${rocketX}px;
                        bottom: ${rocketY}px;
                        width: 15px;
                        height: 15px;
                        background: radial-gradient(circle, #ff6600, transparent);
                        border-radius: 50%;
                        z-index: 100;
                        pointer-events: none;
                    `;
                    arena.appendChild(trail);
                    setTimeout(() => trail.remove(), 300);
                };

                const flyRocket = setInterval(() => {
                    createTrail();

                    if (phase === 'horizontal') {
                        // Travel toward enemy
                        rocketX += 12;
                        rocket.style.left = rocketX + 'px';

                        // Check if reached enemy's current X position
                        if (Math.abs(rocketX - game.dummyX) < 30) {
                            phase = 'vertical';
                            // Rotate rocket upward
                            rocket.querySelector('.rocket-body').style.transform = 'rotate(0deg)';
                            rocket.querySelector('.rocket-flame').style.transform = 'rotate(0deg)';
                        } else if (rocketX > 850) {
                            // Missed - went off screen
                            clearInterval(flyRocket);
                            rocket.remove();
                            showImpact('MISSED!', '#888');
                            fighter.classList.remove('special-moon');
                            fighter.classList.add('idle');
                            game.isAttacking = false;
                        }
                    } else if (phase === 'vertical') {
                        // Launch upward
                        rocketY += 20;
                        rocket.style.bottom = rocketY + 'px';

                        // Check if enemy is still at this X position during launch
                        if (rocketY < 200 && Math.abs(rocketX - game.dummyX) < 50) {
                            // Hit! Enemy was caught in the launch
                            clearInterval(flyRocket);
                            rocket.remove();

                            // Explosion effect
                            const explosion = document.createElement('div');
                            explosion.style.cssText = `
                                position: absolute;
                                left: ${rocketX - 40}px;
                                bottom: ${rocketY}px;
                                width: 80px;
                                height: 80px;
                                background: radial-gradient(circle, #ff6600, #ff0000, transparent);
                                border-radius: 50%;
                                z-index: 160;
                                animation: explosionPulse 0.5s ease-out forwards;
                            `;
                            arena.appendChild(explosion);

                            const wagmi = document.createElement('div');
                            wagmi.className = 'impact-effect hit-text';
                            wagmi.textContent = 'WAGMI!';
                            wagmi.style.cssText = `
                                left: 50%; top: 40%;
                                transform: translateX(-50%);
                                font-size: 3rem;
                                color: var(--orange);
                            `;
                            arena.appendChild(wagmi);

                            dealDamage(special.damage, 'TO THE MOON!');

                            setTimeout(() => {
                                explosion.remove();
                                wagmi.remove();
                            }, 800);

                            fighter.classList.remove('special-moon');
                            fighter.classList.add('idle');
                            game.isAttacking = false;
                        } else if (rocketY > 400) {
                            // Rocket flew past - enemy dodged
                            clearInterval(flyRocket);
                            rocket.remove();
                            showImpact('DODGED!', '#888');
                            fighter.classList.remove('special-moon');
                            fighter.classList.add('idle');
                            game.isAttacking = false;
                        }
                    }
                }, 30);
            }
        }

        function executeBillySpecial(special, fighter) {
            const arena = document.getElementById('arena');

            if (special.name === 'Pythagorean Punch') {
                // Billy traverses the COMPLETE triangle path: A  B  C  A
                const startX = game.playerX;
                const startBottom = 68;

                // Triangle vertices:
                // A (start) -> B (up) -> C (right, down) -> back to A
                const pathA = { x: startX, y: startBottom };
                const pathB = { x: startX, y: startBottom + 80 }; // go UP (side a)
                const pathC = { x: startX + 180, y: startBottom }; // diagonal DOWN-RIGHT (hypotenuse c)
                // Then back to A (side b)

                // Draw the complete triangle trail
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.style.position = 'absolute';
                svg.style.left = startX + 'px';
                svg.style.bottom = '60px';
                svg.style.width = '200px';
                svg.style.height = '100px';
                svg.style.overflow = 'visible';
                svg.style.zIndex = '50';
                svg.innerHTML = `
                    <path d="M 0 80 L 0 0 L 180 80 Z"
                          fill="none"
                          stroke="var(--blue)"
                          stroke-width="4"
                          stroke-dasharray="500"
                          stroke-dashoffset="500">
                        <animate attributeName="stroke-dashoffset" from="500" to="0" dur="1.2s" fill="freeze"/>
                    </path>
                `;
                arena.appendChild(svg);

                // Three phases: UP, DIAGONAL (hypotenuse), LEFT (back to start)
                let phase = 0;
                let progress = 0;
                let hitDealt = false;

                const moveInterval = setInterval(() => {
                    progress += 0.06;

                    if (phase === 0) {
                        // Phase 0: Moving UP (side a)
                        const currentY = pathA.y + (pathB.y - pathA.y) * progress;
                        fighter.style.bottom = currentY + 'px';

                        if (progress >= 1) {
                            progress = 0;
                            phase = 1;
                        }
                    } else if (phase === 1) {
                        // Phase 1: Moving diagonal DOWN-RIGHT (hypotenuse c - the punch!)
                        const currentX = pathB.x + (pathC.x - pathB.x) * progress;
                        const currentY = pathB.y + (pathC.y - pathB.y) * progress;
                        fighter.style.left = currentX + 'px';
                        fighter.style.bottom = currentY + 'px';
                        game.playerX = currentX;

                        // Check collision during hypotenuse traversal
                        if (!hitDealt && isInRange(80)) {
                            dealDamage(special.damage, 'Q.E.D.!');
                            hitDealt = true;

                            // Show equation on hit
                            const eq = document.createElement('div');
                            eq.className = 'impact-effect';
                            eq.textContent = 'a + b = c';
                            eq.style.fontFamily = "'Patrick Hand', cursive";
                            eq.style.fontSize = '1.8rem';
                            eq.style.color = 'var(--blue)';
                            eq.style.left = (game.playerX + 30) + 'px';
                            eq.style.top = '50px';
                            arena.appendChild(eq);
                            setTimeout(() => eq.remove(), 500);
                        }

                        if (progress >= 1) {
                            progress = 0;
                            phase = 2;
                        }
                    } else if (phase === 2) {
                        // Phase 2: Moving LEFT back to start (side b)
                        const currentX = pathC.x + (pathA.x - pathC.x) * progress;
                        fighter.style.left = currentX + 'px';
                        game.playerX = currentX;

                        if (progress >= 1) {
                            clearInterval(moveInterval);
                            fighter.style.bottom = '68px';
                            fighter.style.left = startX + 'px';
                            game.playerX = startX;
                            svg.remove();
                            fighter.classList.add('idle');
                            game.isAttacking = false;

                            if (!hitDealt) {
                                updateComboDisplay('Missed!');
                            }
                        }
                    }
                }, 25);

            } else if (special.name === 'Whiteboard Slam') {
                fighter.classList.add('special-whiteboard');

                // Billy throws the whiteboard from his position
                setTimeout(() => {
                    const board = document.createElement('div');
                    board.className = 'projectile whiteboard';
                    board.innerHTML = 'P(n) for all n<br>P(1)  P(k)P(k+1)<br> P(n) ';
                    board.style.left = (game.playerX + 40) + 'px';
                    board.style.bottom = '140px';
                    board.style.transform = 'rotate(15deg)';
                    arena.appendChild(board);

                    // Animate throwing the board across to the dummy
                    const dummy = document.getElementById('npc-dummy');
                    const dummyRect = dummy.getBoundingClientRect();
                    const arenaRect = arena.getBoundingClientRect();
                    const targetX = dummyRect.left - arenaRect.left - 60;
                    const startX = game.playerX + 40;

                    let progress = 0;
                    const throwAnim = setInterval(() => {
                        progress += 0.08;
                        const currentX = startX + (targetX - startX) * progress;
                        const arc = Math.sin(progress * Math.PI) * 50;
                        board.style.left = currentX + 'px';
                        board.style.bottom = (140 + arc) + 'px';
                        board.style.transform = `rotate(${15 - progress * 30}deg)`;

                        if (progress >= 1) {
                            clearInterval(throwAnim);
                            dealDamage(special.damage, 'SLAM!');
                            board.remove();
                        }
                    }, 30);
                }, 200);

                setTimeout(() => {
                    fighter.classList.remove('special-whiteboard');
                    fighter.classList.add('idle');
                    game.isAttacking = false;
                }, 700);

            } else if (special.name === 'Infinite Loop') {
                // Trap opponent in spinning infinity symbol - with dodge window
                const dummy = document.getElementById('npc-dummy');
                const dummyRect = dummy.getBoundingClientRect();
                const arenaRect = arena.getBoundingClientRect();
                const dummyX = dummyRect.left - arenaRect.left;
                const distance = Math.abs(dummyX - game.playerX);

                // Must be close to trap in loop
                if (distance > 200) {
                    updateComboDisplay('Too far to trap!');
                    setTimeout(() => {
                        fighter.classList.add('idle');
                        game.isAttacking = false;
                    }, 400);
                    return;
                }

                // Phase 1: Warning - infinity symbol appears on GROUND, growing
                // Enemy can JUMP to avoid being trapped
                const trapZone = document.createElement('div');
                trapZone.style.cssText = `
                    position: absolute;
                    width: 80px;
                    height: 40px;
                    border: 4px dashed var(--blue);
                    border-radius: 50%;
                    z-index: 140;
                    opacity: 0.7;
                `;
                trapZone.style.left = (dummyX - 20) + 'px';
                trapZone.style.bottom = '60px';
                arena.appendChild(trapZone);

                // Warning text
                const warning = document.createElement('div');
                warning.textContent = 'JUMP!';
                warning.style.cssText = `
                    position: absolute;
                    font-family: 'Permanent Marker', cursive;
                    font-size: 1.2rem;
                    color: var(--blue);
                    z-index: 145;
                    animation: blink 0.2s ease-in-out infinite alternate;
                `;
                warning.style.left = (dummyX) + 'px';
                warning.style.bottom = '40px';
                arena.appendChild(warning);

                // Add blink animation
                const blinkStyle = document.createElement('style');
                blinkStyle.textContent = `
                    @keyframes blink { from { opacity: 1; } to { opacity: 0.3; } }
                    @keyframes spin-infinity { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
                `;
                document.head.appendChild(blinkStyle);

                // Growing trap animation during dodge window
                let warningProgress = 0;
                const warningAnim = setInterval(() => {
                    warningProgress += 0.05;
                    const scale = 0.5 + warningProgress * 0.5;
                    trapZone.style.transform = `scale(${scale})`;
                    trapZone.style.borderWidth = (4 - warningProgress * 2) + 'px';

                    if (warningProgress >= 1) {
                        clearInterval(warningAnim);
                        trapZone.remove();
                        warning.remove();

                        // Phase 2: Check if enemy is on ground (didn't jump)
                        // In a real game, we'd check dummy.isJumping
                        // For now, simulate: 30% chance they "jumped" to dodge
                        const dodged = Math.random() < 0.3;

                        if (dodged) {
                            // Enemy jumped - missed!
                            const missText = document.createElement('div');
                            missText.className = 'impact-effect';
                            missText.textContent = 'DODGED!';
                            missText.style.cssText = `
                                font-size: 1.5rem;
                                color: var(--green);
                                left: ${dummyX}px;
                                top: 60px;
                            `;
                            arena.appendChild(missText);
                            setTimeout(() => missText.remove(), 500);

                            blinkStyle.remove();
                            fighter.classList.add('idle');
                            game.isAttacking = false;
                        } else {
                            // Enemy caught! Create infinity trap
                            const infinity = document.createElement('div');
                            infinity.style.cssText = `
                                position: absolute;
                                font-size: 5rem;
                                color: var(--blue);
                                font-family: serif;
                                z-index: 150;
                                animation: spin-infinity 0.3s linear infinite;
                            `;
                            infinity.style.left = (dummyX - 30) + 'px';
                            infinity.style.bottom = '80px';
                            infinity.textContent = '';
                            arena.appendChild(infinity);

                            // Numbers spiral around trapped enemy
                            const numbers = ['1', '2', '3', ''];
                            numbers.forEach((num, i) => {
                                setTimeout(() => {
                                    const n = document.createElement('div');
                                    n.textContent = num;
                                    n.style.cssText = `
                                        position: absolute;
                                        font-family: 'Patrick Hand', cursive;
                                        font-size: 1.5rem;
                                        color: var(--blue);
                                        z-index: 155;
                                    `;
                                    n.style.left = (dummyX - 10 + Math.cos(i * 1.5) * 40) + 'px';
                                    n.style.bottom = (100 + Math.sin(i * 1.5) * 30) + 'px';
                                    arena.appendChild(n);
                                    setTimeout(() => n.remove(), 300);
                                }, i * 100);
                            });

                            // Damage over time
                            let ticks = 0;
                            const dotInterval = setInterval(() => {
                                ticks++;
                                dealDamage(Math.floor(special.damage / 3), '');
                                if (ticks >= 3) {
                                    clearInterval(dotInterval);
                                    infinity.remove();
                                    blinkStyle.remove();
                                    fighter.classList.add('idle');
                                    game.isAttacking = false;
                                }
                            }, 350);
                        }
                    }
                }, 30); // ~600ms dodge window

            } else if (special.name === 'Division Split') {
                // Billy creates a clone that rushes from the other side
                const dummy = document.getElementById('npc-dummy');
                const dummyRect = dummy.getBoundingClientRect();
                const arenaRect = arena.getBoundingClientRect();
                const dummyX = dummyRect.left - arenaRect.left;

                // Show division symbol
                const divSymbol = document.createElement('div');
                divSymbol.className = 'impact-effect';
                divSymbol.textContent = '';
                divSymbol.style.fontSize = '4rem';
                divSymbol.style.color = 'var(--blue)';
                divSymbol.style.left = (game.playerX + 20) + 'px';
                divSymbol.style.top = '80px';
                arena.appendChild(divSymbol);
                setTimeout(() => divSymbol.remove(), 600);

                // Create clone further away from the dummy (200px instead of 100px)
                const clone = fighter.cloneNode(true);
                clone.id = 'clone-fighter';
                clone.style.left = (dummyX + 200) + 'px';
                clone.style.opacity = '0.7';
                clone.classList.add('facing-left');
                arena.appendChild(clone);

                // Both Billy and clone rush toward dummy - SLOWER
                let progress = 0;
                const billyStartX = game.playerX;
                const cloneStartX = dummyX + 200;
                let hitDealt = false;

                const rushInterval = setInterval(() => {
                    progress += 0.04; // Slower (was 0.08)

                    // Billy rushes right
                    const billyX = billyStartX + (dummyX - 30 - billyStartX) * progress;
                    fighter.style.left = billyX + 'px';
                    game.playerX = billyX;

                    // Clone rushes left
                    const cloneX = cloneStartX - (cloneStartX - dummyX - 30) * progress;
                    clone.style.left = cloneX + 'px';

                    // Check collision (pincer attack!) - only when they converge
                    if (!hitDealt && progress > 0.85) {
                        dealDamage(special.damage, ' SPLIT!');
                        hitDealt = true;
                    }

                    if (progress >= 1) {
                        clearInterval(rushInterval);
                        clone.remove();
                        fighter.classList.add('idle');
                        game.isAttacking = false;
                    }
                }, 25);

            } else if (special.name === 'WHITEBOARD SLAM') {
                // Green chalkboard slam
                fighter.classList.add('special-whiteboard');

                const dummy = document.getElementById('npc-dummy');
                const dummyRect = dummy.getBoundingClientRect();
                const arenaRect = arena.getBoundingClientRect();
                const dummyX = dummyRect.left - arenaRect.left;
                const distance = Math.abs(dummyX - game.playerX);

                // Range check for throw
                if (distance > 500) {
                    updateComboDisplay('Too far!');
                    setTimeout(() => {
                        fighter.classList.remove('special-whiteboard');
                        fighter.classList.add('idle');
                        game.isAttacking = false;
                    }, 500);
                    return;
                }

                setTimeout(() => {
                    // Create green chalkboard
                    const board = document.createElement('div');
                    board.style.cssText = `
                        position: absolute;
                        width: 100px;
                        height: 70px;
                        background: #2d5a27;
                        border: 6px solid #8b4513;
                        border-radius: 3px;
                        z-index: 160;
                        box-shadow: inset 0 0 15px rgba(0,0,0,0.3), 2px 2px 5px rgba(0,0,0,0.3);
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                        padding: 5px;
                    `;

                    // Chalk text on board
                    const text1 = document.createElement('div');
                    text1.textContent = 'a + b = c';
                    text1.style.cssText = `
                        font-family: 'Patrick Hand', cursive;
                        font-size: 0.9rem;
                        color: #f5f5dc;
                        text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
                    `;

                    const text2 = document.createElement('div');
                    text2.textContent = 'Q.E.D. ';
                    text2.style.cssText = `
                        font-family: 'Patrick Hand', cursive;
                        font-size: 0.8rem;
                        color: #f5f5dc;
                        margin-top: 5px;
                    `;

                    // Chalk dust marks
                    const dust = document.createElement('div');
                    dust.style.cssText = `
                        position: absolute;
                        bottom: 2px;
                        left: 10px;
                        width: 30px;
                        height: 3px;
                        background: rgba(255,255,255,0.3);
                        border-radius: 2px;
                    `;

                    board.appendChild(text1);
                    board.appendChild(text2);
                    board.appendChild(dust);
                    board.style.left = (game.playerX + 40) + 'px';
                    board.style.bottom = '120px';
                    arena.appendChild(board);

                    // Throw chalkboard - travels toward enemy and checks position on impact
                    const startX = game.playerX + 40;
                    let boardX = startX;
                    let hit = false;

                    const throwAnim = setInterval(() => {
                        boardX += 15;
                        const distanceTraveled = boardX - startX;
                        const arc = Math.sin(distanceTraveled / 300 * Math.PI) * 40;
                        board.style.left = boardX + 'px';
                        board.style.bottom = (120 + arc) + 'px';
                        board.style.transform = `rotate(${-distanceTraveled * 2}deg)`;

                        // Chalk dust trail
                        if (Math.random() > 0.6) {
                            const chalkDust = document.createElement('div');
                            chalkDust.style.cssText = `
                                position: absolute;
                                width: 4px;
                                height: 4px;
                                background: rgba(245,245,220,0.6);
                                border-radius: 50%;
                                z-index: 155;
                            `;
                            chalkDust.style.left = boardX + 'px';
                            chalkDust.style.bottom = (120 + arc) + 'px';
                            arena.appendChild(chalkDust);
                            setTimeout(() => chalkDust.remove(), 200);
                        }

                        // Check if board reached enemy's CURRENT position
                        if (!hit && Math.abs(boardX - game.dummyX) < 60) {
                            hit = true;
                            clearInterval(throwAnim);
                            dealDamage(special.damage, 'Q.E.D.!');

                            // Show Q.E.D. in chalk style
                            const qed = document.createElement('div');
                            qed.className = 'impact-effect hit-text';
                            qed.textContent = 'Q.E.D.';
                            qed.style.cssText = `
                                font-size: 3rem;
                                font-family: 'Patrick Hand', cursive;
                                color: #f5f5dc;
                                text-shadow: 2px 2px 0 #2d5a27, 3px 3px 5px rgba(0,0,0,0.5);
                                left: 50%;
                                top: 30%;
                                transform: translateX(-50%);
                            `;
                            arena.appendChild(qed);
                            setTimeout(() => qed.remove(), 600);

                            board.remove();
                        } else if (boardX > 850) {
                            // Missed - went off screen
                            clearInterval(throwAnim);
                            showImpact('MISSED!', '#888');
                            board.remove();
                        }
                    }, 30);
                }, 300);

                setTimeout(() => {
                    fighter.classList.remove('special-whiteboard');
                    fighter.classList.add('idle');
                    game.isAttacking = false;
                }, 1200);
            }
        }

        function executeJonasSpecial(special, fighter) {
            const arena = document.getElementById('arena');

            if (special.name === 'Post-its') {
                fighter.classList.add('special-action');

                // Throw sticky notes - each checks for hit on enemy's current position
                const symbols = ['!', '', '*', '', ''];
                let hitsLanded = 0;

                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        const note = document.createElement('div');
                        note.className = 'projectile sticky-note';
                        note.textContent = symbols[i];
                        let noteX = game.playerX + 50;
                        const noteY = 100 + i * 12;
                        note.style.left = noteX + 'px';
                        note.style.bottom = noteY + 'px';
                        arena.appendChild(note);

                        const flyNote = setInterval(() => {
                            noteX += 15;
                            note.style.left = noteX + 'px';
                            note.style.transform = `rotate(${(noteX - game.playerX) * 3}deg)`;

                            // Check if note reached enemy's CURRENT position
                            if (Math.abs(noteX - game.dummyX) < 40) {
                                clearInterval(flyNote);
                                hitsLanded++;
                                if (hitsLanded === 1) {
                                    // Only deal full damage on first hit
                                    dealDamage(special.damage, 'POST-IT!');
                                }
                                note.remove();
                            } else if (noteX > 850) {
                                clearInterval(flyNote);
                                note.remove();
                            }
                        }, 25);
                    }, i * 50);
                }

                setTimeout(() => {
                    fighter.classList.remove('special-action');
                    fighter.classList.add('idle');
                    game.isAttacking = false;
                }, 500);

            } else if (special.name === 'Paradigm Shift') {
                fighter.classList.add('special-paradigm');

                // Create shield bubble
                const shield = document.createElement('div');
                shield.className = 'projectile shield-bubble';
                shield.style.left = (game.playerX - 30) + 'px';
                shield.style.bottom = '60px';

                // Add orbiting buzzwords
                const words = ['SYNERGY', 'LEVERAGE', 'PIVOT'];
                words.forEach((word, i) => {
                    const bw = document.createElement('div');
                    bw.className = 'buzzword';
                    bw.textContent = word;
                    bw.style.animation = `orbit 1s linear infinite ${i * 0.33}s`;
                    shield.appendChild(bw);
                });

                arena.appendChild(shield);

                // Add keyframe for orbit
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes orbit {
                        from { transform: rotate(0deg) translateX(50px) rotate(0deg); }
                        to { transform: rotate(360deg) translateX(50px) rotate(-360deg); }
                    }
                `;
                document.head.appendChild(style);

                updateComboDisplay('PARADIGM SHIFT - Blocking!');

                setTimeout(() => {
                    shield.remove();
                    style.remove();
                    fighter.classList.remove('special-paradigm');
                    fighter.classList.add('idle');
                    game.isAttacking = false;
                    updateComboDisplay('');
                }, 2000);

            } else if (special.name === 'Circle Back') {
                // Teleport behind with circular arrow trail
                const oldX = game.playerX;
                const dummy = document.getElementById('npc-dummy');
                const dummyRect = dummy.getBoundingClientRect();
                const arenaRect = arena.getBoundingClientRect();
                const dummyX = dummyRect.left - arenaRect.left;
                const targetX = dummyX + 80;

                // Create circular arrow path using SVG
                const arrowSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                arrowSvg.style.cssText = `
                    position: absolute;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    pointer-events: none;
                    z-index: 160;
                `;

                // Calculate arc path - semicircle from Jonas to behind enemy
                const centerX = (oldX + targetX) / 2;
                const centerY = 120; // vertical center of arc
                const radiusX = Math.abs(targetX - oldX) / 2;
                const radiusY = 80; // how high the arc goes

                const arcPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                arcPath.setAttribute('stroke', 'var(--green)');
                arcPath.setAttribute('stroke-width', '4');
                arcPath.setAttribute('stroke-dasharray', '10,5');
                arcPath.setAttribute('fill', 'none');
                arcPath.setAttribute('stroke-linecap', 'round');

                // Arrow head at the end
                const arrowHead = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                arrowHead.setAttribute('fill', 'var(--green)');

                arrowSvg.appendChild(arcPath);
                arrowSvg.appendChild(arrowHead);
                arena.appendChild(arrowSvg);

                // Animate Jonas along the arc path
                let progress = 0;
                const arcAnim = setInterval(() => {
                    progress += 0.08;

                    // Calculate position on arc
                    const angle = Math.PI * progress; // 0 to PI (semicircle)
                    const currentX = oldX + (targetX - oldX) * progress;
                    const arcHeight = Math.sin(angle) * radiusY;
                    const currentY = centerY - arcHeight;

                    // Move fighter along arc
                    game.playerX = currentX;
                    fighter.style.left = currentX + 'px';
                    fighter.style.bottom = (68 + arcHeight * 0.8) + 'px';
                    fighter.style.opacity = 0.7; // Semi-transparent during movement

                    // Draw the trail up to current position
                    const arenaHeight = arena.offsetHeight;
                    const pathY = arenaHeight - 120; // base Y in SVG coords
                    let pathD = `M${oldX + 30},${pathY}`;
                    for (let t = 0; t <= progress; t += 0.05) {
                        const px = oldX + 30 + (targetX - oldX) * t;
                        const py = pathY - Math.sin(Math.PI * t) * radiusY;
                        pathD += ` L${px},${py}`;
                    }
                    arcPath.setAttribute('d', pathD);

                    // Position arrow head at current point
                    const headX = currentX + 30;
                    const headY = arenaHeight - (120 + arcHeight);
                    const arrowAngle = progress < 0.5 ? -30 : 30; // Point direction
                    arrowHead.setAttribute('points', `
                        ${headX},${headY}
                        ${headX - 8},${headY + 12}
                        ${headX + 8},${headY + 12}
                    `);
                    arrowHead.style.transform = `rotate(${arrowAngle}deg)`;
                    arrowHead.style.transformOrigin = `${headX}px ${headY}px`;

                    // Leave trail dots
                    if (progress > 0.2 && Math.random() > 0.6) {
                        const dot = document.createElement('div');
                        dot.style.cssText = `
                            position: absolute;
                            width: 8px;
                            height: 8px;
                            background: var(--green);
                            border-radius: 50%;
                            opacity: 0.6;
                            z-index: 155;
                        `;
                        dot.style.left = currentX + 'px';
                        dot.style.bottom = (68 + arcHeight * 0.8) + 'px';
                        arena.appendChild(dot);
                        setTimeout(() => dot.remove(), 300);
                    }

                    if (progress >= 1) {
                        clearInterval(arcAnim);

                        // Arrived behind enemy
                        fighter.style.opacity = 1;
                        fighter.style.bottom = '68px';
                        fighter.classList.add('facing-left');

                        const circleText = document.createElement('div');
                        circleText.className = 'impact-effect';
                        circleText.textContent = "Let's circle back!";
                        circleText.style.cssText = `
                            font-family: 'Patrick Hand', cursive;
                            font-size: 1.3rem;
                            color: var(--green);
                            left: ${game.playerX - 50}px;
                            top: 70px;
                        `;
                        arena.appendChild(circleText);

                        // Attack from behind
                        setTimeout(() => {
                            circleText.remove();
                            arrowSvg.remove();
                            if (isInRange(100)) {
                                dealDamage(special.damage, 'CIRCLE BACK!');
                            } else {
                                updateComboDisplay('Missed!');
                            }
                        }, 300);

                        // Return to original position
                        setTimeout(() => {
                            game.playerX = oldX;
                            fighter.style.left = game.playerX + 'px';
                            fighter.classList.remove('facing-left');
                            fighter.classList.add('idle');
                            game.isAttacking = false;
                        }, 600);
                    }
                }, 25);

            } else if (special.name === 'PERFORMANCE REVIEW') {
                fighter.classList.add('special-review');

                const dummy = document.getElementById('npc-dummy');
                const dummyRect = dummy.getBoundingClientRect();
                const arenaRect = arena.getBoundingClientRect();
                const dummyX = dummyRect.left - arenaRect.left;
                const distance = Math.abs(dummyX - game.playerX);

                // Range check - Jonas needs to be close enough to deliver the review
                if (distance > 400) {
                    updateComboDisplay('Too far!');
                    setTimeout(() => {
                        fighter.classList.remove('special-review');
                        fighter.classList.add('idle');
                        game.isAttacking = false;
                    }, 500);
                    return;
                }

                // Show flipchart with slides
                setTimeout(() => {
                    const flipchart = document.createElement('div');
                    flipchart.className = 'projectile flipchart';

                    flipchart.style.left = (dummyX - 50) + 'px';
                    flipchart.style.bottom = '130px';
                    flipchart.innerHTML = `
                        <div class="flipchart-board">
                            <div class="slide-title">SYNERGY</div>
                            <div class="slide-content">Core competencies</div>
                        </div>
                        <div class="flipchart-stand"></div>
                    `;
                    arena.appendChild(flipchart);

                    // Slide changes
                    const slides = [
                        { title: 'PARADIGM', content: 'Outside the box' },
                        { title: 'ACTION', content: 'Circle back' },
                        { title: 'FIRED', content: 'Per my last email' }
                    ];

                    slides.forEach((slide, i) => {
                        setTimeout(() => {
                            const board = flipchart.querySelector('.flipchart-board');
                            board.innerHTML = `
                                <div class="slide-title">${slide.title}</div>
                                <div class="slide-content">${slide.content}</div>
                            `;
                            dealDamage(Math.floor(special.damage / 4), slide.title + '!');
                        }, (i + 1) * 300);
                    });

                    setTimeout(() => {
                        flipchart.remove();

                        const offline = document.createElement('div');
                        offline.className = 'impact-effect hit-text';
                        offline.textContent = "Let's take this OFFLINE!";
                        offline.style.fontSize = '2rem';
                        offline.style.color = 'var(--green)';
                        offline.style.left = '50%';
                        offline.style.top = '35%';
                        offline.style.transform = 'translateX(-50%)';
                        offline.style.whiteSpace = 'nowrap';
                        arena.appendChild(offline);
                        setTimeout(() => offline.remove(), 600);
                    }, 1200);
                }, 300);

                setTimeout(() => {
                    fighter.classList.remove('special-review');
                    fighter.classList.add('idle');
                    game.isAttacking = false;
                }, 1600);
            }
        }

        function executeLucasSpecial(special, fighter) {
            const arena = document.getElementById('arena');

            if (special.name === 'Bicycle Kick') {
                fighter.classList.add('special-bicycle');

                // Check if in range first - bicycle kick is mid-range, not full screen
                const dummy = document.getElementById('npc-dummy');
                const dummyRect = dummy.getBoundingClientRect();
                const arenaRect = arena.getBoundingClientRect();
                const dummyX = dummyRect.left - arenaRect.left;
                const distance = Math.abs(dummyX - game.playerX);

                if (distance > 350) {
                    // Too far - whiff the kick
                    updateComboDisplay('Too far!');
                    setTimeout(() => {
                        fighter.classList.remove('special-bicycle');
                        fighter.classList.add('idle');
                        game.isAttacking = false;
                    }, 500);
                    return;
                }

                setTimeout(() => {
                    const ball = document.createElement('div');
                    ball.className = 'projectile soccer-ball';
                    ball.style.left = (game.playerX + 30) + 'px';
                    ball.style.bottom = '180px';
                    arena.appendChild(ball);

                    const targetX = dummyX;
                    const startX = game.playerX + 30;

                    let progress = 0;
                    const kickAnim = setInterval(() => {
                        progress += 0.06;
                        const currentX = startX + (targetX - startX) * progress;
                        const arc = Math.sin(progress * Math.PI) * 80;
                        ball.style.left = currentX + 'px';
                        ball.style.bottom = (100 + arc) + 'px';
                        ball.style.transform = `rotate(${progress * 720}deg)`;

                        if (progress >= 1) {
                            clearInterval(kickAnim);
                            dealDamage(special.damage, 'GOLAZO!');
                            ball.remove();
                        }
                    }, 25);
                }, 300);

                setTimeout(() => {
                    fighter.classList.remove('special-bicycle');
                    fighter.classList.add('idle');
                    game.isAttacking = false;
                }, 700);

            } else if (special.name === 'Cat Throw') {
                fighter.classList.add('special-cats');

                // Lucas THROWS two cats in quick succession
                const catData = [
                    { color: '#f39c12', text: 'MEOW!' },  // Orange cat
                    { color: '#7f8c8d', text: 'HISS!' }   // Gray cat
                ];

                // Get dummy position
                const dummy = document.getElementById('npc-dummy');
                const dummyRect = dummy.getBoundingClientRect();
                const arenaRect = arena.getBoundingClientRect();
                const targetX = dummyRect.left - arenaRect.left;

                catData.forEach((catInfo, i) => {
                    setTimeout(() => {
                        // Create a simple, VERY visible cat using basic divs
                        const cat = document.createElement('div');
                        cat.style.cssText = `
                            position: absolute;
                            width: 45px;
                            height: 35px;
                            z-index: 200;
                            pointer-events: none;
                        `;

                        // Cat body (main oval)
                        const body = document.createElement('div');
                        body.style.cssText = `
                            position: absolute;
                            bottom: 0;
                            left: 0;
                            width: 35px;
                            height: 22px;
                            background: ${catInfo.color};
                            border: 3px solid #333;
                            border-radius: 50%;
                        `;

                        // Cat head
                        const head = document.createElement('div');
                        head.style.cssText = `
                            position: absolute;
                            bottom: 10px;
                            right: 0;
                            width: 22px;
                            height: 20px;
                            background: ${catInfo.color};
                            border: 3px solid #333;
                            border-radius: 50%;
                        `;

                        // Cat ears
                        const ear1 = document.createElement('div');
                        ear1.style.cssText = `
                            position: absolute;
                            top: -8px;
                            left: 2px;
                            width: 0;
                            height: 0;
                            border-left: 5px solid transparent;
                            border-right: 5px solid transparent;
                            border-bottom: 10px solid ${catInfo.color};
                        `;

                        const ear2 = document.createElement('div');
                        ear2.style.cssText = `
                            position: absolute;
                            top: -8px;
                            right: 2px;
                            width: 0;
                            height: 0;
                            border-left: 5px solid transparent;
                            border-right: 5px solid transparent;
                            border-bottom: 10px solid ${catInfo.color};
                        `;

                        head.appendChild(ear1);
                        head.appendChild(ear2);
                        cat.appendChild(body);
                        cat.appendChild(head);

                        // Position at Lucas's hands
                        const startX = game.playerX + 40;
                        const startBottom = 130;
                        cat.style.left = startX + 'px';
                        cat.style.bottom = startBottom + 'px';
                        arena.appendChild(cat);

                        // Animate cat flying in an arc
                        let progress = 0;
                        const catFly = setInterval(() => {
                            progress += 0.03; // ~33 frames = 825ms per cat
                            const currentX = startX + (targetX - startX) * progress;
                            const arc = Math.sin(progress * Math.PI) * 70;
                            cat.style.left = currentX + 'px';
                            cat.style.bottom = (startBottom + arc) + 'px';
                            cat.style.transform = `rotate(${progress * 360}deg)`;

                            if (progress >= 1) {
                                clearInterval(catFly);
                                dealDamage(Math.floor(special.damage / 2), catInfo.text);
                                cat.remove();
                            }
                        }, 25);
                    }, i * 300); // 300ms apart
                });

                setTimeout(() => {
                    fighter.classList.remove('special-cats');
                    fighter.classList.add('idle');
                    game.isAttacking = false;
                }, 1400);

            } else if (special.name === 'Sliding Tackle') {
                fighter.classList.add('sliding');

                const startX = game.playerX;
                let slideProgress = 0;

                const slide = setInterval(() => {
                    slideProgress += 0.08;
                    game.playerX = startX + slideProgress * 150;
                    fighter.style.left = game.playerX + 'px';
                    fighter.style.transform = 'rotate(-15deg) translateY(10px)';

                    if (slideProgress >= 1) {
                        clearInterval(slide);
                        if (isInRange(100)) {
                            dealDamage(special.damage, 'TACKLE!');
                        }
                        fighter.style.transform = '';
                        fighter.classList.remove('sliding');
                        fighter.classList.add('idle');
                        game.isAttacking = false;
                    }
                }, 30);

            } else if (special.name === 'HAT TRICK!') {
                fighter.classList.add('special-hattrick');

                // Check range first
                const dummy = document.getElementById('npc-dummy');
                const dummyRect = dummy.getBoundingClientRect();
                const arenaRect = arena.getBoundingClientRect();
                const dummyX = dummyRect.left - arenaRect.left;
                const distance = Math.abs(dummyX - game.playerX);

                if (distance > 400) {
                    updateComboDisplay('Too far!');
                    setTimeout(() => {
                        fighter.classList.remove('special-hattrick');
                        fighter.classList.add('idle');
                        game.isAttacking = false;
                    }, 500);
                    return;
                }

                // Three soccer balls kicked in sequence - each one HITS the opponent
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => {
                        const ball = document.createElement('div');
                        ball.className = 'projectile soccer-ball';
                        ball.style.left = (game.playerX + 30 + i * 20) + 'px';
                        ball.style.bottom = '100px';
                        arena.appendChild(ball);

                        const targetX = dummyX;
                        const startX = game.playerX + 30 + i * 20;

                        // Different arc heights for variety
                        const arcHeight = 60 + i * 30;

                        let progress = 0;
                        const ballFly = setInterval(() => {
                            progress += 0.07;
                            const currentX = startX + (targetX - startX) * progress;
                            const arc = Math.sin(progress * Math.PI) * arcHeight;
                            ball.style.left = currentX + 'px';
                            ball.style.bottom = (100 + arc) + 'px';
                            ball.style.transform = `rotate(${progress * 540}deg)`;

                            if (progress >= 1) {
                                clearInterval(ballFly);
                                dealDamage(Math.floor(special.damage / 3), i === 2 ? 'HAT TRICK!' : 'GOAL!');
                                ball.remove();
                            }
                        }, 25);
                    }, i * 250); // Staggered kicks
                }

                // Show HAT TRICK text at the end
                setTimeout(() => {
                    const htText = document.createElement('div');
                    htText.className = 'impact-effect hit-text';
                    htText.textContent = 'HAT TRICK!';
                    htText.style.fontSize = '3rem';
                    htText.style.color = 'var(--purple)';
                    htText.style.left = '50%';
                    htText.style.top = '35%';
                    htText.style.transform = 'translateX(-50%)';
                    arena.appendChild(htText);
                    setTimeout(() => htText.remove(), 600);
                }, 800);

                setTimeout(() => {
                    fighter.classList.remove('special-hattrick');
                    fighter.classList.add('idle');
                    game.isAttacking = false;
                }, 1200);
            }
        }

        function executeJonasLSpecial(special, fighter) {
            const arena = document.getElementById('arena');
            const bass = document.getElementById('player-bass');

            // Helper to update bass damage visual
            function updateBassDamage() {
                if (bass && game.bassDamage < 4) {
                    game.bassDamage++;
                    bass.classList.remove('damage-0', 'damage-1', 'damage-2', 'damage-3', 'damage-4');
                    bass.classList.add('damage-' + game.bassDamage);
                }
            }

            if (special.name === 'Paddle Ball') {
                fighter.classList.add('special-paddle');

                const dummy = document.getElementById('npc-dummy');
                const dummyRect = dummy.getBoundingClientRect();
                const arenaRect = arena.getBoundingClientRect();
                const dummyX = dummyRect.left - arenaRect.left;
                const distance = Math.abs(dummyX - game.playerX);

                // Create paddle in hand
                const paddle = document.createElement('div');
                paddle.style.cssText = `
                    position: absolute;
                    width: 30px;
                    height: 45px;
                    z-index: 160;
                `;
                // Paddle handle
                const handle = document.createElement('div');
                handle.style.cssText = `
                    position: absolute;
                    bottom: 0;
                    left: 10px;
                    width: 10px;
                    height: 18px;
                    background: #8b4513;
                    border: 2px solid #333;
                    border-radius: 2px;
                `;
                // Paddle face
                const face = document.createElement('div');
                face.style.cssText = `
                    position: absolute;
                    bottom: 15px;
                    left: 0;
                    width: 30px;
                    height: 30px;
                    background: #c0392b;
                    border: 3px solid #333;
                    border-radius: 50%;
                `;
                paddle.appendChild(handle);
                paddle.appendChild(face);
                paddle.style.left = (game.playerX + 45) + 'px';
                paddle.style.bottom = '115px';
                arena.appendChild(paddle);

                // Create ball attached to paddle
                const ball = document.createElement('div');
                ball.style.cssText = `
                    position: absolute;
                    width: 18px;
                    height: 18px;
                    background: radial-gradient(circle at 30% 30%, #e74c3c, #c0392b);
                    border: 2px solid #333;
                    border-radius: 50%;
                    z-index: 155;
                `;

                // Elastic string (SVG line)
                const elastic = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                elastic.style.cssText = `
                    position: absolute;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    pointer-events: none;
                    z-index: 154;
                `;
                const elasticLine = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                elasticLine.setAttribute('stroke', '#333');
                elasticLine.setAttribute('stroke-width', '2');
                elasticLine.setAttribute('fill', 'none');
                elastic.appendChild(elasticLine);
                arena.appendChild(elastic);

                const paddleX = game.playerX + 60;
                const paddleY = 140;
                ball.style.left = paddleX + 'px';
                ball.style.bottom = paddleY + 'px';
                arena.appendChild(ball);

                // Phase 1: Wind up (pull back)
                let phase = 0;
                let progress = 0;
                const maxReach = Math.min(distance * 0.8, 250); // Don't stretch too far

                const paddleAnim = setInterval(() => {
                    if (phase === 0) {
                        // Wind up - paddle pulls back
                        progress += 0.2;
                        paddle.style.transform = `rotate(${-20 * progress}deg)`;

                        if (progress >= 1) {
                            phase = 1;
                            progress = 0;
                        }
                    } else if (phase === 1) {
                        // Launch - ball flies out, elastic stretches
                        progress += 0.05;
                        const currentX = paddleX + maxReach * progress;
                        const arc = Math.sin(progress * Math.PI) * 30;
                        const ballY = paddleY + arc;

                        ball.style.left = currentX + 'px';
                        ball.style.bottom = ballY + 'px';

                        // Paddle swings forward
                        paddle.style.transform = `rotate(${-20 + progress * 40}deg)`;

                        // Draw elastic string with curve
                        const arenaHeight = arena.offsetHeight;
                        const startPx = paddleX + 15;
                        const startPy = arenaHeight - paddleY - 10;
                        const endPx = currentX + 9;
                        const endPy = arenaHeight - ballY - 9;
                        const midX = (startPx + endPx) / 2;
                        const sag = progress * 20; // Elastic sags in middle
                        elasticLine.setAttribute('d', `M${startPx},${startPy} Q${midX},${startPy + sag} ${endPx},${endPy}`);

                        if (progress >= 1) {
                            // Check hit at max extension
                            if (distance <= maxReach + 50) {
                                dealDamage(special.damage, 'BONK!');
                            }
                            phase = 2;
                            progress = 0;
                        }
                    } else if (phase === 2) {
                        // Snap back - ball returns
                        progress += 0.08;
                        const currentX = paddleX + maxReach * (1 - progress);
                        const arc = Math.sin((1 - progress) * Math.PI) * 20;
                        const ballY = paddleY + arc;

                        ball.style.left = currentX + 'px';
                        ball.style.bottom = ballY + 'px';

                        // Elastic snaps back
                        const arenaHeight = arena.offsetHeight;
                        const startPx = paddleX + 15;
                        const startPy = arenaHeight - paddleY - 10;
                        const endPx = currentX + 9;
                        const endPy = arenaHeight - ballY - 9;
                        const midX = (startPx + endPx) / 2;
                        const sag = (1 - progress) * 15;
                        elasticLine.setAttribute('d', `M${startPx},${startPy} Q${midX},${startPy + sag} ${endPx},${endPy}`);

                        if (progress >= 1) {
                            clearInterval(paddleAnim);
                            paddle.remove();
                            ball.remove();
                            elastic.remove();

                            if (distance > maxReach + 50) {
                                updateComboDisplay('Too far!');
                            }

                            fighter.classList.remove('special-paddle');
                            fighter.classList.add('idle');
                            game.isAttacking = false;
                        }
                    }
                }, 25);

            } else if (special.name === 'Hot Coffee') {
                fighter.classList.add('special-coffee');

                const dummy = document.getElementById('npc-dummy');
                const dummyRect = dummy.getBoundingClientRect();
                const arenaRect = arena.getBoundingClientRect();
                const dummyX = dummyRect.left - arenaRect.left;
                const distance = Math.abs(dummyX - game.playerX);

                // Coffee colors - dark roast
                const coffeeColors = ['#1a0f0a', '#2d1810', '#3d261a', '#4a3228', '#3a2218'];

                // Create canvas for particle rendering
                const canvas = document.createElement('canvas');
                canvas.width = arena.offsetWidth;
                canvas.height = arena.offsetHeight;
                canvas.style.cssText = `
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: ${arena.offsetWidth}px;
                    height: ${arena.offsetHeight}px;
                    pointer-events: none;
                    z-index: 200;
                `;
                arena.appendChild(canvas);
                const ctx = canvas.getContext('2d');


                // Show mug with handle on left
                const mug = document.createElement('div');
                mug.style.cssText = `
                    position: absolute;
                    width: 20px;
                    height: 24px;
                    background: linear-gradient(to right, #fff, #e8e8e8, #fff);
                    border: 2px solid #666;
                    border-radius: 0 0 5px 5px;
                    z-index: 160;
                `;
                const handle = document.createElement('div');
                handle.style.cssText = `
                    position: absolute;
                    left: -8px;
                    top: 5px;
                    width: 7px;
                    height: 10px;
                    border: 2px solid #666;
                    border-right: none;
                    border-radius: 6px 0 0 6px;
                `;
                const coffeeInMug = document.createElement('div');
                coffeeInMug.style.cssText = `
                    position: absolute;
                    top: 2px;
                    left: 2px;
                    right: 2px;
                    height: 16px;
                    background: linear-gradient(180deg, #2d1810, #1a0f0a);
                    border-radius: 2px;
                    box-shadow: inset 0 2px 3px rgba(255,255,255,0.1);
                `;
                mug.appendChild(coffeeInMug);
                mug.appendChild(handle);
                mug.style.left = (game.playerX + 45) + 'px';
                mug.style.bottom = '130px';
                arena.appendChild(mug);

                // Particle system
                const particles = [];
                const steamParticles = [];
                const groundY = canvas.height - 50;
                const targetLeft = dummyX;
                const targetRight = dummyX + 60;
                const targetTop = canvas.height - 150;

                // Calculate damage per particle (total damage spread across all particles)
                const particleCount = 800;
                const damagePerParticle = special.damage / particleCount;
                let totalDamageDealt = 0;
                let shownHotMessage = false;

                class CoffeeParticle {
                    constructor(x, y, vx, vy, size, color) {
                        this.x = x;
                        this.y = y;
                        this.vx = vx;
                        this.vy = vy;
                        this.size = size;
                        this.color = color;
                        this.life = 1;
                        this.settled = false;
                        this.settleTime = 0;
                        this.hasHit = false; // Track if this particle already dealt damage
                    }
                    update(gravity) {
                        if (this.settled) {
                            this.settleTime++;
                            this.life = Math.max(0, 1 - this.settleTime / 60);
                            return;
                        }
                        this.vy += gravity;
                        this.x += this.vx;
                        this.y += this.vy;
                        this.vx *= 0.99;
                        this.vy *= 0.99;
                        // Ground
                        if (this.y >= groundY - this.size) {
                            this.y = groundY - this.size;
                            this.vy *= -0.3;
                            this.vx *= 0.8;
                            if (Math.abs(this.vy) < 0.5) this.settled = true;
                        }
                        // Target collision - each particle deals tiny damage
                        if (!this.hasHit && this.x >= targetLeft && this.x <= targetRight && this.y >= targetTop && this.y <= groundY) {
                            this.hasHit = true;
                            if (distance <= 350) {
                                // Show "HOT!" message on first hit
                                if (!shownHotMessage) {
                                    shownHotMessage = true;
                                    updateComboDisplay('HOT!');
                                }
                                totalDamageDealt += damagePerParticle;
                                // Apply damage in small chunks to avoid too many updates
                                if (totalDamageDealt >= 1) {
                                    const dmg = Math.floor(totalDamageDealt);
                                    dealDamage(dmg, '');
                                    totalDamageDealt -= dmg;
                                }
                            }
                        }
                    }
                    draw() {
                        if (this.life <= 0) return;
                        ctx.globalAlpha = this.life;
                        ctx.fillStyle = this.color;
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.globalAlpha = 1;
                    }
                }

                class SteamParticle {
                    constructor(x, y, isVerticalLine = false) {
                        this.x = x;
                        this.y = y;
                        this.isVerticalLine = isVerticalLine;
                        if (isVerticalLine) {
                            // Vertical steam lines - rise straight up
                            this.vx = 0;
                            this.vy = -3 - Math.random() * 3;
                            this.size = 2 + Math.random() * 2; // Thicker
                            this.life = 1;
                            this.lineHeight = 15 + Math.random() * 20; // Taller
                        } else {
                            this.vx = (Math.random() - 0.5) * 1;
                            this.vy = -0.5 - Math.random() * 1.5;
                            this.size = 1.5 + Math.random() * 2.5;
                            this.life = 1;
                            this.lineHeight = 0;
                        }
                    }
                    update() {
                        this.x += this.vx + (Math.random() - 0.5) * 0.5;
                        this.y += this.vy;
                        if (!this.isVerticalLine) {
                            this.size += 0.08;
                        }
                        this.life -= this.isVerticalLine ? 0.04 : 0.025;
                    }
                    draw() {
                        if (this.life <= 0) return;

                        if (this.isVerticalLine) {
                            // Draw as a visible gray vertical wisp
                            ctx.globalAlpha = this.life * 0.7;
                            ctx.strokeStyle = '#a0a0a0';
                            ctx.lineWidth = this.size;
                            ctx.lineCap = 'round';
                            ctx.beginPath();
                            ctx.moveTo(this.x, this.y);
                            ctx.bezierCurveTo(
                                this.x + Math.sin(this.y * 0.1) * 5, this.y - this.lineHeight * 0.3,
                                this.x - Math.sin(this.y * 0.15) * 5, this.y - this.lineHeight * 0.7,
                                this.x + Math.sin(this.y * 0.2) * 3, this.y - this.lineHeight
                            );
                            ctx.stroke();
                        } else {
                            ctx.globalAlpha = this.life * 0.5;
                            ctx.fillStyle = 'rgba(160,160,160,0.6)';
                            ctx.beginPath();
                            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                            ctx.fill();
                        }
                        ctx.globalAlpha = 1;
                    }
                }

                // Track the furthest X the coffee has reached (for steam positioning)
                let maxCoffeeX = game.playerX + 45;

                // Wind-up then throw
                let windUp = 0;
                const windUpAnim = setInterval(() => {
                    windUp += 0.15;
                    mug.style.left = (game.playerX + 45 - windUp * 20) + 'px';
                    mug.style.transform = `rotate(${-windUp * 35}deg)`;

                    if (windUp >= 1) {
                        clearInterval(windUpAnim);
                        coffeeInMug.style.height = '3px';

                        // Spawn particles from coffee surface
                        // Mug is at left: game.playerX + 45, bottom: 130px, width: 20px, height: 24px
                        // In canvas coords: y increases downward from top
                        const mugLeftX = game.playerX + 45;
                        const mugWidth = 20;
                        const mugBottomY = canvas.height - 130;
                        const coffeeSurfaceY = mugBottomY - 24 + 5; // Near top of mug where coffee is

                        // Start animation loop
                        animating = true;
                        requestAnimationFrame(animateParticles);

                        // Mark that spawning has started (for cleanup logic)
                        setTimeout(() => { particlesSpawned = true; }, particleCount * 0.3 + 100);

                        for (let i = 0; i < particleCount; i++) {
                            const spawnX = mugLeftX + 2 + Math.random() * (mugWidth - 4);
                            const spawnY = coffeeSurfaceY + Math.random() * 3;
                            const angle = (Math.random() - 0.5) * (30 * Math.PI / 180);
                            const speed = 0.6 + Math.random() * 0.5;
                            const baseVX = 10;
                            const baseVY = -6;
                            const vx = (baseVX + (Math.random() - 0.5) * 3) * speed;
                            const vy = (baseVY + (Math.random() - 0.5) * 4) * speed;
                            const size = 0.8 + Math.random() * 1.5;
                            const color = coffeeColors[Math.floor(Math.random() * coffeeColors.length)];
                            const delay = i * 0.3;

                            setTimeout(() => {
                                particles.push(new CoffeeParticle(
                                    spawnX, spawnY,
                                    vx * Math.cos(angle) - vy * Math.sin(angle),
                                    vx * Math.sin(angle) + vy * Math.cos(angle),
                                    size, color
                                ));
                            }, delay);
                        }

                        // Mug drops
                        setTimeout(() => {
                            let mugFall = 0;
                            const mugDrop = setInterval(() => {
                                mugFall += 0.15;
                                mug.style.bottom = (130 - mugFall * 70) + 'px';
                                mug.style.transform = `rotate(${-35 + mugFall * 120}deg)`;
                                mug.style.opacity = 1 - mugFall;
                                if (mugFall >= 1) {
                                    clearInterval(mugDrop);
                                    mug.remove();
                                }
                            }, 30);
                        }, 100);
                    }
                }, 40);

                // Animation loop - starts after wind-up completes
                let animating = false;
                let particlesSpawned = false;

                function animateParticles() {
                    if (!animating) return;

                    ctx.clearRect(0, 0, canvas.width, canvas.height);

                    // Update and draw coffee particles
                    for (let i = particles.length - 1; i >= 0; i--) {
                        const p = particles[i];
                        p.update(0.3);

                        // Track max X position of flying coffee
                        if (!p.settled && p.x > maxCoffeeX) {
                            maxCoffeeX = p.x;
                        }

                        // Small steam puffs from individual particles
                        if (!p.settled && Math.random() > 0.98) {
                            steamParticles.push(new SteamParticle(p.x, p.y - 3, false));
                        }
                        p.draw();
                        if (p.life <= 0) particles.splice(i, 1);
                    }

                    // Generate vertical steam lines along the coffee trail
                    // Only spawn where coffee has already passed
                    const startX = game.playerX + 60;
                    if (particles.length > 0 && maxCoffeeX > startX) {
                        // Spawn multiple steam wisps per frame
                        const steamCount = Math.random() > 0.5 ? 2 : 1;
                        for (let s = 0; s < steamCount; s++) {
                            const steamX = startX + Math.random() * (maxCoffeeX - startX);
                            // Find approximate Y for this X position (arc trajectory)
                            const progress = Math.min(1, (steamX - startX) / (dummyX - startX));
                            const arcY = canvas.height - 130 - Math.sin(progress * Math.PI) * 60 + progress * progress * 30;
                            steamParticles.push(new SteamParticle(steamX, arcY - 10, true));
                        }
                    }

                    // Update and draw steam
                    for (let i = steamParticles.length - 1; i >= 0; i--) {
                        const s = steamParticles[i];
                        s.update();
                        s.draw();
                        if (s.life <= 0) steamParticles.splice(i, 1);
                    }

                    // Keep animating until all particles are gone (but only check after spawning started)
                    if (!particlesSpawned || particles.length > 0 || steamParticles.length > 0) {
                        requestAnimationFrame(animateParticles);
                    } else {
                        canvas.remove();
                        animating = false;
                    }
                }

                // Check for miss
                setTimeout(() => {
                    if (!shownHotMessage && distance > 350) {
                        updateComboDisplay('Too far!');
                    }
                }, 800);

                setTimeout(() => {
                    fighter.classList.remove('special-coffee');
                    fighter.classList.add('idle');
                    game.isAttacking = false;
                }, 1200);

            } else if (special.name === 'Bass Swing') {
                fighter.classList.add('special-bass-swing');

                // Jonas takes bass off back and swings it like a weapon
                const bass = document.getElementById('player-bass');
                const startX = game.playerX;
                let hitDealt = false;

                // Create a swinging bass visual (separate from the one on back)
                const swingBass = document.createElement('div');
                swingBass.style.cssText = `
                    position: absolute;
                    z-index: 170;
                    transform-origin: 10px 80px;
                `;
                // Bass body
                const bassBody = document.createElement('div');
                bassBody.style.cssText = `
                    position: absolute;
                    bottom: 0;
                    left: 0;
                    width: 35px;
                    height: 50px;
                    background: #8b4513;
                    border: 3px solid #333;
                    border-radius: 5px 5px 15px 15px;
                `;
                // Bass neck
                const bassNeck = document.createElement('div');
                bassNeck.style.cssText = `
                    position: absolute;
                    bottom: 45px;
                    left: 12px;
                    width: 12px;
                    height: 60px;
                    background: #5c4033;
                    border: 2px solid #333;
                `;
                // Headstock
                const headstock = document.createElement('div');
                headstock.style.cssText = `
                    position: absolute;
                    top: -15px;
                    left: -3px;
                    width: 18px;
                    height: 18px;
                    background: #5c4033;
                    border: 2px solid #333;
                    border-radius: 3px;
                `;
                bassNeck.appendChild(headstock);
                swingBass.appendChild(bassNeck);
                swingBass.appendChild(bassBody);

                swingBass.style.left = (game.playerX + 20) + 'px';
                swingBass.style.bottom = '90px';
                arena.appendChild(swingBass);

                // Hide the bass on back during swing
                if (bass) bass.style.opacity = '0';

                // Phase 1: Wind up (bass goes back)
                let phase = 0; // 0 = windup, 1 = swing
                let progress = 0;

                const swingAnim = setInterval(() => {
                    if (phase === 0) {
                        // Wind up
                        progress += 0.15;
                        swingBass.style.transform = `rotate(${-60 * progress}deg)`;
                        swingBass.style.left = (game.playerX + 20 - progress * 15) + 'px';

                        if (progress >= 1) {
                            phase = 1;
                            progress = 0;
                        }
                    } else {
                        // Swing forward - big arc
                        progress += 0.12;

                        // Move Jonas forward during swing
                        game.playerX = startX + progress * 60;
                        fighter.style.left = game.playerX + 'px';

                        // Bass swings in wide arc
                        const swingAngle = -60 + progress * 180; // From -60 to +120
                        swingBass.style.transform = `rotate(${swingAngle}deg)`;
                        swingBass.style.left = (game.playerX + 20 + progress * 30) + 'px';

                        // Motion blur lines
                        if (progress > 0.2 && progress < 0.7) {
                            const blur = document.createElement('div');
                            blur.style.cssText = `
                                position: absolute;
                                width: 40px;
                                height: 4px;
                                background: rgba(139, 69, 19, 0.4);
                                z-index: 165;
                                border-radius: 2px;
                            `;
                            blur.style.left = (game.playerX + 40) + 'px';
                            blur.style.bottom = (100 + progress * 30) + 'px';
                            blur.style.transform = `rotate(${swingAngle - 90}deg)`;
                            arena.appendChild(blur);
                            setTimeout(() => blur.remove(), 100);
                        }

                        // Check collision at the peak of swing
                        if (!hitDealt && progress > 0.4 && progress < 0.8 && isInRange(100)) {
                            dealDamage(special.damage, 'THWACK!');
                            hitDealt = true;
                            updateBassDamage();

                            // Impact effect
                            const impact = document.createElement('div');
                            impact.className = 'impact-effect';
                            impact.textContent = 'THWACK!';
                            impact.style.cssText = `
                                font-family: 'Permanent Marker', cursive;
                                font-size: 2.5rem;
                                color: #8b4513;
                                left: ${game.playerX + 80}px;
                                top: 70px;
                                text-shadow: 2px 2px 0 #333;
                            `;
                            arena.appendChild(impact);

                            // Musical notes fly out on impact
                            ['D', 'A'].forEach((note, i) => {
                                const n = document.createElement('div');
                                n.textContent = note;
                                n.style.cssText = `
                                    position: absolute;
                                    font-family: 'Finger Paint', cursive;
                                    font-size: 1.5rem;
                                    color: #8b4513;
                                    z-index: 180;
                                `;
                                n.style.left = (game.playerX + 70 + i * 20) + 'px';
                                n.style.bottom = (130 + i * 15) + 'px';
                                arena.appendChild(n);

                                let noteUp = 0;
                                const noteFloat = setInterval(() => {
                                    noteUp += 0.1;
                                    n.style.bottom = (130 + i * 15 + noteUp * 30) + 'px';
                                    n.style.opacity = 1 - noteUp;
                                    if (noteUp >= 1) {
                                        clearInterval(noteFloat);
                                        n.remove();
                                    }
                                }, 30);
                            });

                            setTimeout(() => impact.remove(), 400);
                        }

                        if (progress >= 1) {
                            clearInterval(swingAnim);
                            swingBass.remove();

                            // Restore bass on back
                            if (bass) bass.style.opacity = '1';

                            if (!hitDealt) {
                                updateComboDisplay('Missed!');
                            }

                            fighter.classList.remove('special-bass-swing');
                            fighter.classList.add('idle');
                            game.isAttacking = false;
                        }
                    }
                }, 30);

            } else if (special.name === 'BASS SOLO!') {
                fighter.classList.add('special-bass-solo');

                const dummy = document.getElementById('npc-dummy');
                const dummyRect = dummy.getBoundingClientRect();
                const arenaRect = arena.getBoundingClientRect();
                const dummyX = dummyRect.left - arenaRect.left;
                const distance = Math.abs(dummyX - game.playerX);
                const bass = document.getElementById('player-bass');

                if (distance > 300) {
                    updateComboDisplay('Too far!');
                    setTimeout(() => {
                        fighter.classList.remove('special-bass-solo');
                        fighter.classList.add('idle');
                        game.isAttacking = false;
                    }, 500);
                    return;
                }

                // Hide bass on back - Jonas is now holding it
                if (bass) bass.style.opacity = '0';

                // Create the bass Jonas is playing (in front, playing position)
                const playingBass = document.createElement('div');
                playingBass.style.cssText = `
                    position: absolute;
                    z-index: 175;
                    transform-origin: center bottom;
                `;

                // Bass body
                const bassBody = document.createElement('div');
                bassBody.style.cssText = `
                    position: absolute;
                    bottom: 0;
                    left: 0;
                    width: 40px;
                    height: 55px;
                    background: linear-gradient(135deg, #a0522d 0%, #8b4513 50%, #6b3510 100%);
                    border: 3px solid #333;
                    border-radius: 8px 8px 20px 20px;
                    box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
                `;

                // Bass neck
                const bassNeck = document.createElement('div');
                bassNeck.style.cssText = `
                    position: absolute;
                    bottom: 50px;
                    left: 14px;
                    width: 14px;
                    height: 70px;
                    background: linear-gradient(to right, #5c4033, #6b4c3a, #5c4033);
                    border: 2px solid #333;
                `;

                // Frets
                for (let f = 0; f < 5; f++) {
                    const fret = document.createElement('div');
                    fret.style.cssText = `
                        position: absolute;
                        left: 0;
                        width: 100%;
                        height: 2px;
                        background: #c0c0c0;
                        top: ${10 + f * 12}px;
                    `;
                    bassNeck.appendChild(fret);
                }

                // Headstock
                const headstock = document.createElement('div');
                headstock.style.cssText = `
                    position: absolute;
                    top: -20px;
                    left: -4px;
                    width: 22px;
                    height: 22px;
                    background: #5c4033;
                    border: 2px solid #333;
                    border-radius: 5px 5px 0 0;
                `;

                // Tuning pegs
                for (let p = 0; p < 4; p++) {
                    const peg = document.createElement('div');
                    peg.style.cssText = `
                        position: absolute;
                        width: 6px;
                        height: 6px;
                        background: #c0c0c0;
                        border-radius: 50%;
                        left: ${p < 2 ? -4 : 20}px;
                        top: ${3 + (p % 2) * 10}px;
                    `;
                    headstock.appendChild(peg);
                }

                // Strings
                const strings = document.createElement('div');
                strings.style.cssText = `
                    position: absolute;
                    bottom: 10px;
                    left: 16px;
                    width: 10px;
                    height: 110px;
                `;
                for (let s = 0; s < 4; s++) {
                    const string = document.createElement('div');
                    string.style.cssText = `
                        position: absolute;
                        left: ${s * 3}px;
                        width: 1px;
                        height: 100%;
                        background: #c0c0c0;
                    `;
                    string.className = 'bass-string-' + s;
                    strings.appendChild(string);
                }

                bassNeck.appendChild(headstock);
                playingBass.appendChild(bassNeck);
                playingBass.appendChild(bassBody);
                playingBass.appendChild(strings);

                playingBass.style.left = (game.playerX + 25) + 'px';
                playingBass.style.bottom = '75px';
                playingBass.style.transform = 'rotate(-15deg)';
                arena.appendChild(playingBass);

                // Epic bass solo - Jonas rocks out!
                const notes = ['D', 'A', 'E', 'G'];
                const stringColors = ['#e74c3c', '#f39c12', '#27ae60', '#3498db'];

                for (let i = 0; i < 4; i++) {
                    setTimeout(() => {
                        // Jonas head bangs / rocks
                        fighter.style.transform = i % 2 === 0 ? 'scaleX(1.05)' : 'scaleX(0.95)';

                        // String vibrates when plucked
                        const stringEl = strings.querySelector('.bass-string-' + i);
                        if (stringEl) {
                            stringEl.style.background = stringColors[i];
                            stringEl.style.width = '3px';
                            stringEl.style.boxShadow = `0 0 8px ${stringColors[i]}`;
                            setTimeout(() => {
                                stringEl.style.background = '#c0c0c0';
                                stringEl.style.width = '1px';
                                stringEl.style.boxShadow = 'none';
                            }, 150);
                        }

                        // Bass rocks with playing
                        playingBass.style.transform = `rotate(${-15 + (i % 2 === 0 ? -8 : 8)}deg)`;

                        // Create sound wave from bass
                        const wave = document.createElement('div');
                        wave.style.cssText = `
                            position: absolute;
                            width: 25px;
                            height: 25px;
                            border: 4px solid ${stringColors[i]};
                            border-radius: 50%;
                            z-index: 150;
                            opacity: 1;
                        `;
                        wave.style.left = (game.playerX + 50) + 'px';
                        wave.style.bottom = '110px';
                        arena.appendChild(wave);

                        // Musical note flies out
                        const note = document.createElement('div');
                        note.innerHTML = '';
                        note.style.cssText = `
                            position: absolute;
                            font-size: 2rem;
                            color: ${stringColors[i]};
                            z-index: 165;
                            text-shadow: 1px 1px 0 #333;
                        `;
                        note.style.left = (game.playerX + 60) + 'px';
                        note.style.bottom = '130px';
                        arena.appendChild(note);

                        // Note name
                        const noteName = document.createElement('div');
                        noteName.textContent = notes[i];
                        noteName.style.cssText = `
                            position: absolute;
                            font-family: 'Finger Paint', cursive;
                            font-size: 1.2rem;
                            font-weight: bold;
                            color: ${stringColors[i]};
                            z-index: 160;
                        `;
                        noteName.style.left = (game.playerX + 75) + 'px';
                        noteName.style.bottom = '145px';
                        arena.appendChild(noteName);

                        // Animate wave and note toward enemy
                        let waveProgress = 0;
                        const waveExpand = setInterval(() => {
                            waveProgress += 0.07;
                            const size = 25 + waveProgress * 120;
                            const currentX = game.playerX + 50 + (dummyX - game.playerX - 50) * waveProgress;
                            wave.style.width = size + 'px';
                            wave.style.height = size + 'px';
                            wave.style.left = (currentX - size/2) + 'px';
                            wave.style.bottom = (110 - size/4) + 'px';
                            wave.style.opacity = 1 - waveProgress * 0.7;

                            // Note flies and wobbles
                            note.style.left = (game.playerX + 60 + (dummyX - game.playerX - 60) * waveProgress * 0.8) + 'px';
                            note.style.bottom = (130 + Math.sin(waveProgress * Math.PI * 3) * 15) + 'px';
                            note.style.transform = `rotate(${waveProgress * 30}deg)`;
                            note.style.opacity = 1 - waveProgress * 0.5;

                            // Note name floats up and fades
                            noteName.style.bottom = (145 + waveProgress * 40) + 'px';
                            noteName.style.opacity = 1 - waveProgress;

                            if (waveProgress >= 1) {
                                clearInterval(waveExpand);
                                dealDamage(Math.floor(special.damage / 4), notes[i] + '!');
                                wave.remove();
                                note.remove();
                                noteName.remove();

                                // Bass gets damaged from intense solo on final note
                                if (i === 3) {
                                    updateBassDamage();
                                }
                            }
                        }, 25);
                    }, i * 220);
                }

                // Final "BASS SOLO!" text with dramatic effect
                setTimeout(() => {
                    fighter.style.transform = 'scale(1.1)';

                    const soloText = document.createElement('div');
                    soloText.className = 'impact-effect hit-text';
                    soloText.textContent = 'BASS SOLO!';
                    soloText.style.cssText = `
                        font-size: 3.5rem;
                        color: #8b4513;
                        left: 50%;
                        top: 25%;
                        transform: translateX(-50%);
                        text-shadow: 3px 3px 0 #333, 0 0 20px rgba(139,69,19,0.5);
                    `;
                    arena.appendChild(soloText);

                    // Burst of notes around the text
                    ['', '', '', ''].forEach((sym, idx) => {
                        const burst = document.createElement('div');
                        burst.textContent = sym;
                        burst.style.cssText = `
                            position: absolute;
                            font-size: 1.5rem;
                            color: ${stringColors[idx]};
                            z-index: 180;
                        `;
                        const angle = (idx / 4) * Math.PI * 2;
                        burst.style.left = `calc(50% + ${Math.cos(angle) * 80}px)`;
                        burst.style.top = `calc(25% + ${Math.sin(angle) * 40}px)`;
                        arena.appendChild(burst);
                        setTimeout(() => burst.remove(), 500);
                    });

                    setTimeout(() => soloText.remove(), 700);
                }, 950);

                // Clean up
                setTimeout(() => {
                    playingBass.remove();
                    if (bass) bass.style.opacity = '1';
                    fighter.style.transform = '';
                    fighter.classList.remove('special-bass-solo');
                    fighter.classList.add('idle');
                    game.isAttacking = false;
                }, 1400);
            }
        }

        function animateProjectile(element, duration, onHit) {
            const dummy = document.getElementById('npc-dummy');
            const dummyRect = dummy.getBoundingClientRect();
            const arena = document.getElementById('arena');
            const arenaRect = arena.getBoundingClientRect();
            const targetX = dummyRect.left - arenaRect.left;
            const startX = parseFloat(element.style.left);

            let progress = 0;
            const speed = 1000 / duration;

            const anim = setInterval(() => {
                progress += 0.05 * speed / 20;
                element.style.left = (startX + (targetX - startX) * progress) + 'px';
                element.style.transform = `rotate(${progress * 360}deg)`;

                if (progress >= 1) {
                    clearInterval(anim);
                    onHit();
                }
            }, 20);
        }

        // Country shapes for Fede - actual geographic silhouettes with flag fills
        const countries = [
            {
                name: 'Italy',
                // Boot shape - the iconic Italian peninsula
                path: 'M22,2 L26,3 L28,6 L30,4 L32,6 L30,10 L28,12 L30,14 L28,18 L26,20 L24,24 L22,28 L20,32 L18,36 L20,38 L18,42 L14,44 L12,42 L14,38 L12,34 L10,36 L8,34 L10,30 L14,28 L16,24 L14,20 L12,16 L14,12 L16,10 L14,6 L18,4 L20,2 Z M6,38 L10,36 L12,40 L8,44 L4,42 L6,38 Z M30,40 L34,38 L36,42 L32,46 L28,44 L30,40 Z',
                colors: ['#008c45', '#fff', '#cd212a'],
                flagType: 'vertical'
            },
            {
                name: 'Spain',
                // Iberian shape
                path: 'M8,8 L16,4 L28,4 L36,6 L40,10 L42,18 L40,26 L36,32 L28,36 L20,38 L12,36 L6,30 L4,22 L4,14 L8,8 Z M32,14 L36,12 L38,16 L34,18 L32,14 Z',
                colors: ['#c60b1e', '#ffc400', '#c60b1e'],
                flagType: 'spain'
            },
            {
                name: 'Argentina',
                // Long narrow South American shape
                path: 'M16,2 L22,4 L24,8 L22,14 L24,20 L22,26 L20,32 L18,38 L16,44 L14,48 L10,52 L8,50 L12,44 L14,38 L12,32 L14,26 L12,20 L14,14 L12,8 L14,4 L16,2 Z',
                colors: ['#74acdf', '#fff', '#74acdf'],
                flagType: 'argentina'
            },
            {
                name: 'Germany',
                // Roughly hexagonal central European shape
                path: 'M20,4 L28,6 L34,10 L38,18 L36,26 L32,32 L24,36 L16,34 L10,28 L6,20 L8,12 L14,6 L20,4 Z',
                colors: ['#000', '#dd0000', '#ffcc00'],
                flagType: 'horizontal'
            },
            {
                name: 'USA',
                // Continental US shape
                path: 'M2,16 L8,12 L16,10 L24,8 L32,10 L40,12 L46,16 L48,22 L46,28 L40,30 L32,28 L28,32 L24,30 L20,32 L16,30 L12,32 L8,28 L4,24 L2,16 Z M36,8 L40,6 L42,10 L38,12 L36,8 Z',
                colors: ['#3c3b6e', '#b22234', '#fff'],
                flagType: 'usa'
            },
            {
                name: 'Japan',
                // Main islands archipelago
                path: 'M12,8 L16,6 L20,8 L24,12 L28,18 L30,24 L28,30 L24,34 L20,32 L18,28 L20,24 L18,20 L14,18 L12,14 L10,10 L12,8 Z M32,12 L36,10 L38,14 L36,18 L32,16 L32,12 Z M6,20 L10,18 L12,22 L10,26 L6,24 L6,20 Z',
                colors: ['#fff', '#bc002d'],
                flagType: 'japan'
            },
            {
                name: 'Norway',
                // Long narrow Scandinavian shape
                path: 'M8,2 L12,4 L14,8 L12,14 L14,20 L12,26 L10,32 L12,38 L10,44 L8,48 L4,46 L6,40 L4,34 L6,28 L4,22 L6,16 L4,10 L6,4 L8,2 Z M14,6 L18,4 L20,8 L16,10 L14,6 Z',
                colors: ['#ba0c2f', '#fff', '#00205b'],
                flagType: 'nordic'
            },
            {
                name: 'Iceland',
                // Island blob shape
                path: 'M10,14 L18,10 L28,12 L36,16 L38,24 L34,32 L26,36 L16,34 L8,28 L6,20 L10,14 Z',
                colors: ['#003897', '#fff', '#d72828'],
                flagType: 'nordic'
            },
            {
                name: 'UK',
                // Great Britain distinctive shape
                path: 'M18,4 L22,6 L24,10 L22,14 L26,18 L28,24 L26,30 L22,36 L18,40 L14,38 L16,34 L14,30 L12,26 L14,22 L12,18 L10,14 L12,10 L14,6 L18,4 Z M8,8 L12,6 L14,10 L10,14 L6,12 L8,8 Z M24,4 L28,2 L30,6 L26,10 L22,8 L24,4 Z',
                colors: ['#012169', '#fff', '#c8102e'],
                flagType: 'uk'
            },
            {
                name: 'France',
                // L'Hexagone shape
                path: 'M20,4 L30,6 L38,14 L40,24 L36,34 L28,40 L18,42 L10,38 L4,30 L4,20 L8,12 L14,6 L20,4 Z',
                colors: ['#002395', '#fff', '#ed2939'],
                flagType: 'vertical'
            },
            {
                name: 'Greece',
                // With Peloponnese peninsula
                path: 'M12,8 L20,6 L30,8 L36,14 L38,22 L34,30 L28,34 L24,32 L26,28 L22,26 L18,30 L14,28 L10,24 L8,18 L10,12 L12,8 Z M20,34 L24,36 L22,42 L16,44 L14,40 L18,36 L20,34 Z',
                colors: ['#0d5eaf', '#fff'],
                flagType: 'greece'
            },
            {
                name: 'Switzerland',
                // Compact mountain nation
                path: 'M12,14 L20,10 L30,12 L38,18 L36,28 L28,34 L18,32 L10,26 L8,20 L12,14 Z',
                colors: ['#ff0000', '#fff'],
                flagType: 'swiss'
            }
        ];

        function createCountrySVG(country, size = 40) {
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('viewBox', '0 0 50 55');
            svg.setAttribute('width', size * 1.1);
            svg.setAttribute('height', size * 1.2);
            svg.style.filter = 'drop-shadow(2px 2px 4px rgba(0,0,0,0.5))';

            // Create clip path from country shape
            const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
            const clipPath = document.createElementNS('http://www.w3.org/2000/svg', 'clipPath');
            clipPath.setAttribute('id', 'clip-' + country.name);
            const clipShape = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            clipShape.setAttribute('d', country.path);
            clipPath.appendChild(clipShape);
            defs.appendChild(clipPath);
            svg.appendChild(defs);

            // Create group with clip
            const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            g.setAttribute('clip-path', `url(#clip-${country.name})`);

            // Draw flag pattern inside the shape
            if (country.flagType === 'vertical') {
                // Vertical stripes (Italy, France)
                for (let i = 0; i < 3; i++) {
                    const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                    rect.setAttribute('x', i * 17);
                    rect.setAttribute('y', 0);
                    rect.setAttribute('width', 18);
                    rect.setAttribute('height', 60);
                    rect.setAttribute('fill', country.colors[i]);
                    g.appendChild(rect);
                }
            } else if (country.flagType === 'horizontal') {
                // Horizontal stripes (Germany)
                for (let i = 0; i < 3; i++) {
                    const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                    rect.setAttribute('x', 0);
                    rect.setAttribute('y', i * 18);
                    rect.setAttribute('width', 60);
                    rect.setAttribute('height', 20);
                    rect.setAttribute('fill', country.colors[i]);
                    g.appendChild(rect);
                }
            } else if (country.flagType === 'spain') {
                // Spain flag pattern
                const r1 = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                r1.setAttribute('x', 0); r1.setAttribute('y', 0);
                r1.setAttribute('width', 60); r1.setAttribute('height', 14);
                r1.setAttribute('fill', '#c60b1e');
                g.appendChild(r1);
                const r2 = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                r2.setAttribute('x', 0); r2.setAttribute('y', 14);
                r2.setAttribute('width', 60); r2.setAttribute('height', 28);
                r2.setAttribute('fill', '#ffc400');
                g.appendChild(r2);
                const r3 = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                r3.setAttribute('x', 0); r3.setAttribute('y', 42);
                r3.setAttribute('width', 60); r3.setAttribute('height', 14);
                r3.setAttribute('fill', '#c60b1e');
                g.appendChild(r3);
            } else if (country.flagType === 'argentina') {
                // Argentina with sun
                const r1 = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                r1.setAttribute('x', 0); r1.setAttribute('y', 0);
                r1.setAttribute('width', 60); r1.setAttribute('height', 18);
                r1.setAttribute('fill', '#74acdf');
                g.appendChild(r1);
                const r2 = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                r2.setAttribute('x', 0); r2.setAttribute('y', 18);
                r2.setAttribute('width', 60); r2.setAttribute('height', 20);
                r2.setAttribute('fill', '#fff');
                g.appendChild(r2);
                const r3 = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                r3.setAttribute('x', 0); r3.setAttribute('y', 38);
                r3.setAttribute('width', 60); r3.setAttribute('height', 18);
                r3.setAttribute('fill', '#74acdf');
                g.appendChild(r3);
                // Sun
                const sun = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                sun.setAttribute('cx', 18);
                sun.setAttribute('cy', 28);
                sun.setAttribute('r', 6);
                sun.setAttribute('fill', '#f6b40e');
                g.appendChild(sun);
            } else if (country.flagType === 'japan') {
                // Japan white with red circle
                const bg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                bg.setAttribute('x', 0); bg.setAttribute('y', 0);
                bg.setAttribute('width', 60); bg.setAttribute('height', 60);
                bg.setAttribute('fill', '#fff');
                g.appendChild(bg);
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', 22);
                circle.setAttribute('cy', 22);
                circle.setAttribute('r', 10);
                circle.setAttribute('fill', '#bc002d');
                g.appendChild(circle);
            } else if (country.flagType === 'nordic') {
                // Nordic cross
                const bg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                bg.setAttribute('x', 0); bg.setAttribute('y', 0);
                bg.setAttribute('width', 60); bg.setAttribute('height', 60);
                bg.setAttribute('fill', country.colors[0]);
                g.appendChild(bg);
                // White cross
                const h1 = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                h1.setAttribute('x', 0); h1.setAttribute('y', 22);
                h1.setAttribute('width', 60); h1.setAttribute('height', 12);
                h1.setAttribute('fill', country.colors[1]);
                g.appendChild(h1);
                const v1 = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                v1.setAttribute('x', 14); v1.setAttribute('y', 0);
                v1.setAttribute('width', 12); v1.setAttribute('height', 60);
                v1.setAttribute('fill', country.colors[1]);
                g.appendChild(v1);
                // Inner cross
                const h2 = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                h2.setAttribute('x', 0); h2.setAttribute('y', 25);
                h2.setAttribute('width', 60); h2.setAttribute('height', 6);
                h2.setAttribute('fill', country.colors[2]);
                g.appendChild(h2);
                const v2 = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                v2.setAttribute('x', 17); v2.setAttribute('y', 0);
                v2.setAttribute('width', 6); v2.setAttribute('height', 60);
                v2.setAttribute('fill', country.colors[2]);
                g.appendChild(v2);
            } else if (country.flagType === 'uk') {
                // Union Jack
                const bg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                bg.setAttribute('x', 0); bg.setAttribute('y', 0);
                bg.setAttribute('width', 60); bg.setAttribute('height', 60);
                bg.setAttribute('fill', '#012169');
                g.appendChild(bg);
                // White diagonals
                const d1 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                d1.setAttribute('x1', 0); d1.setAttribute('y1', 0);
                d1.setAttribute('x2', 50); d1.setAttribute('y2', 55);
                d1.setAttribute('stroke', '#fff'); d1.setAttribute('stroke-width', 8);
                g.appendChild(d1);
                const d2 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                d2.setAttribute('x1', 50); d2.setAttribute('y1', 0);
                d2.setAttribute('x2', 0); d2.setAttribute('y2', 55);
                d2.setAttribute('stroke', '#fff'); d2.setAttribute('stroke-width', 8);
                g.appendChild(d2);
                // Red diagonals
                const d3 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                d3.setAttribute('x1', 0); d3.setAttribute('y1', 0);
                d3.setAttribute('x2', 50); d3.setAttribute('y2', 55);
                d3.setAttribute('stroke', '#c8102e'); d3.setAttribute('stroke-width', 3);
                g.appendChild(d3);
                const d4 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                d4.setAttribute('x1', 50); d4.setAttribute('y1', 0);
                d4.setAttribute('x2', 0); d4.setAttribute('y2', 55);
                d4.setAttribute('stroke', '#c8102e'); d4.setAttribute('stroke-width', 3);
                g.appendChild(d4);
                // White cross
                const wh = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                wh.setAttribute('x', 0); wh.setAttribute('y', 20);
                wh.setAttribute('width', 60); wh.setAttribute('height', 16);
                wh.setAttribute('fill', '#fff');
                g.appendChild(wh);
                const wv = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                wv.setAttribute('x', 18); wv.setAttribute('y', 0);
                wv.setAttribute('width', 14); wv.setAttribute('height', 60);
                wv.setAttribute('fill', '#fff');
                g.appendChild(wv);
                // Red cross
                const rh = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rh.setAttribute('x', 0); rh.setAttribute('y', 23);
                rh.setAttribute('width', 60); rh.setAttribute('height', 10);
                rh.setAttribute('fill', '#c8102e');
                g.appendChild(rh);
                const rv = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rv.setAttribute('x', 21); rv.setAttribute('y', 0);
                rv.setAttribute('width', 8); rv.setAttribute('height', 60);
                rv.setAttribute('fill', '#c8102e');
                g.appendChild(rv);
            } else if (country.flagType === 'usa') {
                // Stars and stripes
                for (let i = 0; i < 13; i++) {
                    const stripe = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                    stripe.setAttribute('x', 0);
                    stripe.setAttribute('y', i * 4.2);
                    stripe.setAttribute('width', 60);
                    stripe.setAttribute('height', 4.5);
                    stripe.setAttribute('fill', i % 2 === 0 ? '#b22234' : '#fff');
                    g.appendChild(stripe);
                }
                const canton = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                canton.setAttribute('x', 0); canton.setAttribute('y', 0);
                canton.setAttribute('width', 22); canton.setAttribute('height', 30);
                canton.setAttribute('fill', '#3c3b6e');
                g.appendChild(canton);
            } else if (country.flagType === 'greece') {
                // Greek stripes and cross
                for (let i = 0; i < 9; i++) {
                    const stripe = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                    stripe.setAttribute('x', 0);
                    stripe.setAttribute('y', i * 6);
                    stripe.setAttribute('width', 60);
                    stripe.setAttribute('height', 7);
                    stripe.setAttribute('fill', i % 2 === 0 ? '#0d5eaf' : '#fff');
                    g.appendChild(stripe);
                }
                const canton = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                canton.setAttribute('x', 0); canton.setAttribute('y', 0);
                canton.setAttribute('width', 20); canton.setAttribute('height', 30);
                canton.setAttribute('fill', '#0d5eaf');
                g.appendChild(canton);
                const ch = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                ch.setAttribute('x', 0); ch.setAttribute('y', 12);
                ch.setAttribute('width', 20); ch.setAttribute('height', 6);
                ch.setAttribute('fill', '#fff');
                g.appendChild(ch);
                const cv = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                cv.setAttribute('x', 7); cv.setAttribute('y', 0);
                cv.setAttribute('width', 6); cv.setAttribute('height', 30);
                cv.setAttribute('fill', '#fff');
                g.appendChild(cv);
            } else if (country.flagType === 'swiss') {
                // Swiss cross
                const bg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                bg.setAttribute('x', 0); bg.setAttribute('y', 0);
                bg.setAttribute('width', 60); bg.setAttribute('height', 60);
                bg.setAttribute('fill', '#ff0000');
                g.appendChild(bg);
                const cv = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                cv.setAttribute('x', 18); cv.setAttribute('y', 8);
                cv.setAttribute('width', 10); cv.setAttribute('height', 30);
                cv.setAttribute('fill', '#fff');
                g.appendChild(cv);
                const ch = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                ch.setAttribute('x', 8); ch.setAttribute('y', 18);
                ch.setAttribute('width', 30); ch.setAttribute('height', 10);
                ch.setAttribute('fill', '#fff');
                g.appendChild(ch);
            }

            svg.appendChild(g);

            // Draw country outline
            const outline = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            outline.setAttribute('d', country.path);
            outline.setAttribute('fill', 'none');
            outline.setAttribute('stroke', '#1a1a1a');
            outline.setAttribute('stroke-width', '2.5');
            outline.setAttribute('stroke-linejoin', 'round');
            svg.appendChild(outline);

            return svg;
        }

        function executeVickySpecial(special, fighter) {
            const arena = document.getElementById('arena');
            const dummy = document.getElementById('npc-dummy');
            const dummyRect = dummy.getBoundingClientRect();
            const arenaRect = arena.getBoundingClientRect();
            const targetX = dummyRect.left - arenaRect.left;
            const fighterX = parseFloat(fighter.style.left) || game.playerX;

            if (special.name === 'Silk Wrap') {
                // Scorpion-style "GET OVER HERE!" silk throw
                fighter.classList.add('special-silk');

                // Create silk projectile - a looped end that flies toward enemy
                const silkHead = document.createElement('div');
                silkHead.style.cssText = `
                    position: absolute;
                    left: ${fighterX + 50}px;
                    bottom: 115px;
                    width: 20px;
                    height: 20px;
                    background: radial-gradient(circle, #e91e8c, #9b59b6);
                    border: 3px solid #9b59b6;
                    border-radius: 50%;
                    box-shadow: 0 0 10px #e91e8c, 0 0 20px rgba(233, 30, 140, 0.5);
                    z-index: 101;
                `;
                arena.appendChild(silkHead);

                // Create the trailing silk ribbon
                const silkTrail = document.createElement('div');
                silkTrail.style.cssText = `
                    position: absolute;
                    left: ${fighterX + 50}px;
                    bottom: 120px;
                    width: 0px;
                    height: 8px;
                    background: linear-gradient(90deg, #9b59b6, #e91e8c, #c41e3a);
                    border-radius: 4px;
                    transform-origin: left center;
                    z-index: 100;
                    box-shadow: 0 2px 8px rgba(233, 30, 140, 0.4);
                `;
                arena.appendChild(silkTrail);

                const startX = fighterX + 50;
                let silkX = startX;
                const silkSpeed = 18;
                let caught = false;

                // Phase 1: Throw silk toward enemy
                const throwSilk = setInterval(() => {
                    silkX += silkSpeed;
                    silkHead.style.left = silkX + 'px';
                    silkTrail.style.width = (silkX - startX) + 'px';

                    // Check if silk reaches enemy's CURRENT position
                    if (!caught && Math.abs(silkX - game.dummyX) < 40) {
                        caught = true;
                        clearInterval(throwSilk);

                        // "GET OVER HERE!" moment
                        showImpact('GET OVER HERE!', '#e91e8c');

                        // Create wrap effect around dummy
                        const wrapEffect = document.createElement('div');
                        wrapEffect.style.cssText = `
                            position: absolute;
                            left: ${targetX}px;
                            bottom: 80px;
                            width: 60px;
                            height: 80px;
                            border: 4px solid #e91e8c;
                            border-radius: 50%;
                            box-shadow: 0 0 15px #e91e8c, inset 0 0 15px rgba(233, 30, 140, 0.3);
                            z-index: 102;
                            animation: pulse 0.2s ease-in-out infinite;
                        `;
                        arena.appendChild(wrapEffect);

                        // Phase 2: Pull dummy toward Vicky
                        setTimeout(() => {
                            const dummy = document.getElementById('npc-dummy');
                            const dummyStartX = parseFloat(dummy.style.left) || targetX;
                            const pullTargetX = fighterX + 100; // Pull them close to Vicky
                            let currentDummyX = dummyStartX;
                            const pullSpeed = 20;

                            const pullDummy = setInterval(() => {
                                currentDummyX -= pullSpeed;

                                // Actually move the dummy!
                                dummy.style.left = currentDummyX + 'px';
                                dummy.style.transition = 'none';

                                // Update silk trail to shrink as dummy comes closer
                                silkTrail.style.width = (currentDummyX - startX) + 'px';
                                silkHead.style.left = currentDummyX + 'px';
                                wrapEffect.style.left = (currentDummyX - 30) + 'px';

                                if (currentDummyX <= pullTargetX) {
                                    clearInterval(pullDummy);

                                    // Impact! Deal damage
                                    dealDamage(special.damage, 'CAUGHT!');
                                    showImpact('CAUGHT!', special.damage);

                                    // Screen flash
                                    arena.style.boxShadow = 'inset 0 0 50px rgba(233, 30, 140, 0.6)';
                                    setTimeout(() => arena.style.boxShadow = '', 150);

                                    // STUN the opponent!
                                    dummy.classList.add('stunned');

                                    // Add stun visual - stars circling head
                                    const stunEffect = document.createElement('div');
                                    stunEffect.className = 'stun-stars';
                                    stunEffect.innerHTML = '';
                                    stunEffect.style.cssText = `
                                        position: absolute;
                                        left: ${pullTargetX + 10}px;
                                        bottom: 180px;
                                        font-size: 16px;
                                        animation: spinStun 0.5s linear infinite;
                                        z-index: 150;
                                    `;
                                    arena.appendChild(stunEffect);

                                    // Create impact burst
                                    for (let i = 0; i < 8; i++) {
                                        const spark = document.createElement('div');
                                        spark.style.cssText = `
                                            position: absolute;
                                            left: ${pullTargetX + 30}px;
                                            bottom: 120px;
                                            width: 6px;
                                            height: 6px;
                                            background: #e91e8c;
                                            border-radius: 50%;
                                            z-index: 103;
                                        `;
                                        arena.appendChild(spark);

                                        const angle = (i / 8) * Math.PI * 2;
                                        let sx = 0, sy = 0, so = 1;
                                        const sparkFly = setInterval(() => {
                                            sx += Math.cos(angle) * 8;
                                            sy += Math.sin(angle) * 8;
                                            so -= 0.08;
                                            spark.style.transform = `translate(${sx}px, ${sy}px)`;
                                            spark.style.opacity = so;
                                            if (so <= 0) { clearInterval(sparkFly); spark.remove(); }
                                        }, 25);
                                    }

                                    // Cleanup and return dummy after stun
                                    setTimeout(() => {
                                        silkHead.remove();
                                        silkTrail.remove();
                                        wrapEffect.remove();
                                        fighter.classList.remove('special-silk');
                                        fighter.classList.add('idle');
                                        game.isAttacking = false;
                                    }, 300);

                                    // Stun duration - dummy can't act and then returns to position
                                    setTimeout(() => {
                                        stunEffect.remove();
                                        dummy.classList.remove('stunned');
                                        // Dummy slides back to original position
                                        dummy.style.transition = 'left 0.5s ease-out';
                                        dummy.style.left = dummyStartX + 'px';
                                    }, 1500);
                                }
                            }, 20);
                        }, 200);
                    }

                    // Silk went off screen without catching
                    if (silkX > 850 && !caught) {
                        clearInterval(throwSilk);
                        showImpact('MISSED!', '#888');
                        silkHead.remove();
                        silkTrail.remove();
                        fighter.classList.remove('special-silk');
                        game.isAttacking = false;
                    }
                }, 20);

            } else if (special.name === 'Naughty List') {
                // Rain coal from above - each coal checks if it hits enemy
                let totalHits = 0;
                let coalsFinished = 0;

                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        const coal = document.createElement('div');
                        // Coal falls at random positions around where enemy is NOW
                        const coalX = game.dummyX - 30 + i * 15 + (Math.random() - 0.5) * 40;
                        coal.style.cssText = `
                            position: absolute;
                            left: ${coalX}px;
                            top: 60px;
                            width: 16px;
                            height: 16px;
                            background: #333;
                            border: 2px solid #111;
                            border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
                            box-shadow: 0 0 8px rgba(255,100,0,0.6);
                            z-index: 100;
                        `;
                        arena.appendChild(coal);

                        let y = 60;
                        let hit = false;
                        const fall = setInterval(() => {
                            y += 12;
                            coal.style.top = y + 'px';
                            coal.style.transform = `rotate(${y * 3}deg)`;

                            if (y >= arenaRect.height - 120) {
                                clearInterval(fall);
                                coalsFinished++;

                                // Check if coal landed on enemy's CURRENT position
                                if (!hit && Math.abs(coalX - game.dummyX) < 35) {
                                    hit = true;
                                    totalHits++;
                                    dealDamage(special.damage / 3, totalHits === 1 ? 'COAL!' : '');
                                }

                                // Ember explosion
                                for (let j = 0; j < 4; j++) {
                                    const ember = document.createElement('div');
                                    ember.style.cssText = `
                                        position: absolute;
                                        width: 4px; height: 4px;
                                        background: #ff6600;
                                        border-radius: 50%;
                                        left: ${coalX + 8}px;
                                        top: ${y}px;
                                        z-index: 100;
                                    `;
                                    arena.appendChild(ember);
                                    const angle = (j / 4) * Math.PI * 2;
                                    let ex = 0, ey = 0, eo = 1;
                                    const emberFly = setInterval(() => {
                                        ex += Math.cos(angle) * 3;
                                        ey += Math.sin(angle) * 3 - 1;
                                        eo -= 0.1;
                                        ember.style.transform = `translate(${ex}px, ${ey}px)`;
                                        ember.style.opacity = eo;
                                        if (eo <= 0) { clearInterval(emberFly); ember.remove(); }
                                    }, 30);
                                }
                                coal.remove();

                                // Show missed after all coals
                                if (coalsFinished === 5 && totalHits === 0) {
                                    showImpact('MISSED!', '#888');
                                }
                            }
                        }, 25);
                    }, i * 80);
                }

                setTimeout(() => {
                    fighter.classList.add('idle');
                    game.isAttacking = false;
                }, 800);

            } else if (special.name === 'Nice List') {
                // Rain presents from above
                const giftColors = ['#c41e3a', '#228b22', '#ffd700', '#4169e1'];

                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        const gift = document.createElement('div');
                        gift.style.cssText = `
                            position: absolute;
                            left: ${targetX - 35 + i * 18}px;
                            top: 60px;
                            width: 20px;
                            height: 20px;
                            background: ${giftColors[i % giftColors.length]};
                            border: 2px solid #333;
                            z-index: 100;
                        `;
                        // Add ribbon
                        const ribbon = document.createElement('div');
                        ribbon.style.cssText = `
                            position: absolute;
                            top: 0; left: 50%;
                            transform: translateX(-50%);
                            width: 4px; height: 100%;
                            background: #ffd700;
                        `;
                        gift.appendChild(ribbon);
                        arena.appendChild(gift);

                        let y = 60;
                        const fall = setInterval(() => {
                            y += 10;
                            gift.style.top = y + 'px';
                            gift.style.transform = `rotate(${y * 2}deg)`;

                            if (y >= arenaRect.height - 120) {
                                clearInterval(fall);
                                if (i === 2) {
                                    dealDamage(special.damage, 'SURPRISE!');
                                    showImpact('SURPRISE!', special.damage);
                                }

                                // Confetti explosion
                                const colors = ['#ff0000', '#00ff00', '#ffff00', '#ff00ff', '#00ffff', '#ffd700'];
                                for (let j = 0; j < 8; j++) {
                                    const confetti = document.createElement('div');
                                    confetti.style.cssText = `
                                        position: absolute;
                                        width: 6px; height: 6px;
                                        border-radius: 50%;
                                        background: ${colors[j % colors.length]};
                                        left: ${gift.offsetLeft + 10}px;
                                        top: ${y}px;
                                        z-index: 100;
                                    `;
                                    arena.appendChild(confetti);
                                    const angle = (j / 8) * Math.PI * 2;
                                    const speed = 3 + Math.random() * 2;
                                    let cx = 0, cy = 0, co = 1;
                                    const confettiFly = setInterval(() => {
                                        cx += Math.cos(angle) * speed;
                                        cy += Math.sin(angle) * speed;
                                        co -= 0.06;
                                        confetti.style.transform = `translate(${cx}px, ${cy}px) rotate(${cx * 10}deg)`;
                                        confetti.style.opacity = co;
                                        if (co <= 0) { clearInterval(confettiFly); confetti.remove(); }
                                    }, 25);
                                }
                                gift.remove();
                            }
                        }, 25);
                    }, i * 100);
                }

                setTimeout(() => {
                    fighter.classList.add('idle');
                    game.isAttacking = false;
                }, 900);

            } else if (special.name === 'Christmas Spirit') {
                // Golden glow radiates from Vicky - expands outward and checks if it reaches enemy
                const glow = document.createElement('div');
                glow.style.cssText = `
                    position: absolute;
                    left: ${fighterX - 30}px;
                    bottom: 60px;
                    width: 120px;
                    height: 120px;
                    border-radius: 50%;
                    background: radial-gradient(circle, rgba(255,215,0,0.6) 0%, rgba(255,215,0,0) 70%);
                    transform: scale(0);
                    z-index: 50;
                    pointer-events: none;
                `;
                arena.appendChild(glow);

                // Heal Vicky
                game.playerHealth = Math.min(100, game.playerHealth + 15);
                updateUI();

                // Show heal text
                const healText = document.createElement('div');
                healText.textContent = '+15 HP';
                healText.style.cssText = `
                    position: absolute;
                    left: ${fighterX + 10}px;
                    bottom: 180px;
                    font-family: 'Permanent Marker', cursive;
                    font-size: 1.2rem;
                    color: #228b22;
                    z-index: 200;
                `;
                arena.appendChild(healText);
                setTimeout(() => healText.remove(), 1000);

                let scale = 0;
                let hit = false;
                const expand = setInterval(() => {
                    scale += 0.08;
                    glow.style.transform = `scale(${scale})`;
                    glow.style.opacity = 1 - scale * 0.3;

                    // Calculate current radius of the glow
                    const glowRadius = 60 * scale; // Half of 120px width
                    const glowCenterX = fighterX + 30;
                    const distanceToEnemy = Math.abs(game.dummyX - glowCenterX);

                    // Check if glow has expanded to reach the enemy
                    if (!hit && distanceToEnemy < glowRadius) {
                        hit = true;
                        dealDamage(special.damage, 'SPIRIT!');
                        showImpact('SPIRIT!', special.damage);
                    }

                    if (scale >= 2.5) {
                        clearInterval(expand);
                        glow.remove();
                        fighter.classList.add('idle');
                        game.isAttacking = false;
                    }
                }, 30);

            } else if (special.name === 'SILK DROP MIRACLE!') {
                // Ultimate: Climb up, drop down with lights trail, create tree
                const startLeft = fighterX;
                const startBottom = 68;

                fighter.style.transition = 'none';
                let height = 0;

                const climb = setInterval(() => {
                    height += 8;
                    fighter.style.bottom = (startBottom + height) + 'px';

                    if (height >= 150) {
                        clearInterval(climb);

                        setTimeout(() => {
                            let dropProgress = 0;
                            let hit = false;
                            const drop = setInterval(() => {
                                dropProgress += 0.08;
                                // Track toward enemy's CURRENT position
                                const currentTargetX = game.dummyX;
                                const currentX = startLeft + (currentTargetX - 40 - startLeft) * dropProgress;
                                const currentHeight = 150 * (1 - dropProgress * dropProgress);

                                fighter.style.left = currentX + 'px';
                                fighter.style.bottom = (startBottom + currentHeight) + 'px';
                                game.playerX = currentX;

                                // Trail of lights
                                if (Math.random() > 0.5) {
                                    const light = document.createElement('div');
                                    light.style.cssText = `
                                        position: absolute;
                                        left: ${currentX + 20}px;
                                        bottom: ${startBottom + currentHeight + 40}px;
                                        width: 8px; height: 8px;
                                        border-radius: 50%;
                                        background: ${['#ff0000', '#00ff00', '#ffff00', '#0000ff'][Math.floor(Math.random() * 4)]};
                                        z-index: 100;
                                        animation: twinkle 0.3s infinite alternate;
                                    `;
                                    arena.appendChild(light);
                                    setTimeout(() => light.remove(), 500);
                                }

                                // Check hit during descent - must be close to enemy when low enough
                                if (!hit && currentHeight < 50 && Math.abs(currentX - game.dummyX) < 60) {
                                    hit = true;
                                    dealDamage(special.damage, 'MIRACLE!');
                                    showImpact('MIRACLE!', special.damage);
                                }

                                if (dropProgress >= 1) {
                                    clearInterval(drop);
                                    if (!hit) {
                                        showImpact('MISSED!', '#888');
                                    }

                                    // Christmas tree explosion
                                    const tree = document.createElement('div');
                                    tree.style.cssText = `
                                        position: absolute;
                                        left: ${targetX - 40}px;
                                        bottom: 68px;
                                        width: 0; height: 0;
                                        border-left: 40px solid transparent;
                                        border-right: 40px solid transparent;
                                        border-bottom: 80px solid #228b22;
                                        transform: scale(0);
                                        z-index: 100;
                                    `;
                                    arena.appendChild(tree);

                                    let treeScale = 0;
                                    const treeGrow = setInterval(() => {
                                        treeScale += 0.15;
                                        tree.style.transform = `scale(${treeScale})`;

                                        if (treeScale >= 1.2) {
                                            clearInterval(treeGrow);

                                            // Add tree lights
                                            for (let i = 0; i < 6; i++) {
                                                const treeLight = document.createElement('div');
                                                treeLight.style.cssText = `
                                                    position: absolute;
                                                    left: ${targetX - 50 + Math.random() * 60}px;
                                                    bottom: ${90 + Math.random() * 60}px;
                                                    width: 8px; height: 8px;
                                                    border-radius: 50%;
                                                    background: ${['#ff0000', '#ffff00', '#00ff00', '#0000ff'][i % 4]};
                                                    z-index: 101;
                                                    animation: twinkle 0.3s infinite alternate;
                                                `;
                                                arena.appendChild(treeLight);
                                                setTimeout(() => treeLight.remove(), 800);
                                            }

                                            setTimeout(() => {
                                                tree.style.opacity = '0';
                                                tree.style.transition = 'opacity 0.3s';
                                                setTimeout(() => tree.remove(), 300);
                                            }, 600);
                                        }
                                    }, 30);

                                    // Return Vicky to start
                                    setTimeout(() => {
                                        fighter.style.transition = 'all 0.3s';
                                        fighter.style.left = startLeft + 'px';
                                        fighter.style.bottom = startBottom + 'px';
                                        setTimeout(() => {
                                            fighter.style.transition = 'none';
                                            fighter.classList.add('idle');
                                            game.isAttacking = false;
                                        }, 300);
                                    }, 800);
                                }
                            }, 25);
                        }, 200);
                    }
                }, 25);
            }
        }

        function executeFedeSpecial(special, fighter) {
            const arena = document.getElementById('arena');
            // Support both tournament opponent and practice dummy
            const opponent = document.getElementById('opponent-fighter') || document.getElementById('npc-dummy');
            const opponentRect = opponent ? opponent.getBoundingClientRect() : { left: 650 };
            const arenaRect = arena.getBoundingClientRect();
            const targetX = opponentRect.left - arenaRect.left;
            const fighterX = parseFloat(fighter.style.left) || game.playerX;
            const opponentX = game.dummyX;
            const facingRight = opponentX > fighterX;

            if (special.name === 'The Split') {
                // Hide original legs and feet during split
                const originalLegs = fighter.querySelector('.legs');
                const originalFeet = fighter.querySelector('.feet');
                if (originalLegs) originalLegs.style.visibility = 'hidden';
                if (originalFeet) originalFeet.style.visibility = 'hidden';

                // Drop body down - slower and less distance
                fighter.style.transition = 'transform 0.5s ease-out';
                fighter.style.transform = 'translateY(25px)';

                // Show text
                const splitText = document.createElement('div');
                splitText.textContent = 'THE SPLIT!';
                splitText.style.cssText = `
                    position: absolute;
                    left: ${fighterX}px;
                    bottom: 180px;
                    font-family: 'Finger Paint', cursive;
                    font-size: 28px;
                    color: #e74c3c;
                    text-shadow: 2px 2px 0 #000, 0 0 10px rgba(231,76,60,0.5);
                    z-index: 200;
                    animation: splitTextPop 0.5s ease-out;
                `;
                arena.appendChild(splitText);
                setTimeout(() => splitText.remove(), 800);

                // Create visual horizontal legs at ground level
                const legContainer = document.createElement('div');
                legContainer.className = 'split-legs-visual';
                legContainer.style.cssText = `
                    position: absolute;
                    left: ${fighterX + 25}px;
                    bottom: 68px;
                    display: flex;
                    align-items: center;
                    z-index: 100;
                    transform: translateX(-50%);
                `;

                // Left leg (extends left) - slower animation
                const leftLeg = document.createElement('div');
                leftLeg.style.cssText = `
                    width: 10px;
                    height: 14px;
                    background: #2c3e50;
                    border: 2px solid #333;
                    border-radius: 4px;
                    animation: splitLegExtendLeft 0.5s ease-out forwards;
                `;

                // Right leg (extends right) - slower animation
                const rightLeg = document.createElement('div');
                rightLeg.style.cssText = `
                    width: 10px;
                    height: 14px;
                    background: #2c3e50;
                    border: 2px solid #333;
                    border-radius: 4px;
                    animation: splitLegExtendRight 0.5s ease-out forwards;
                `;

                // Left shoe
                const leftShoe = document.createElement('div');
                leftShoe.style.cssText = `
                    width: 18px;
                    height: 12px;
                    background: #333;
                    border: 2px solid #222;
                    border-radius: 6px 3px 3px 6px;
                    margin-right: -2px;
                `;

                // Right shoe
                const rightShoe = document.createElement('div');
                rightShoe.style.cssText = `
                    width: 18px;
                    height: 12px;
                    background: #333;
                    border: 2px solid #222;
                    border-radius: 3px 6px 6px 3px;
                    margin-left: -2px;
                `;

                legContainer.appendChild(leftShoe);
                legContainer.appendChild(leftLeg);
                legContainer.appendChild(rightLeg);
                legContainer.appendChild(rightShoe);
                arena.appendChild(legContainer);

                // Add animation keyframes dynamically
                if (!document.getElementById('split-leg-keyframes')) {
                    const style = document.createElement('style');
                    style.id = 'split-leg-keyframes';
                    style.textContent = `
                        @keyframes splitLegExtendLeft {
                            0% { width: 10px; }
                            100% { width: 85px; }
                        }
                        @keyframes splitLegExtendRight {
                            0% { width: 10px; }
                            100% { width: 85px; }
                        }
                    `;
                    document.head.appendChild(style);
                }

                // Shockwave effect - delayed to match slower animation
                setTimeout(() => {
                    const wave = document.createElement('div');
                    wave.style.cssText = `
                        position: absolute;
                        left: ${fighterX - 80}px;
                        bottom: 60px;
                        width: 220px;
                        height: 25px;
                        background: radial-gradient(ellipse, rgba(231,76,60,0.6) 0%, rgba(231,76,60,0.2) 50%, transparent 70%);
                        z-index: 50;
                        animation: shockwaveExpand 0.4s ease-out forwards;
                    `;
                    arena.appendChild(wave);
                    setTimeout(() => wave.remove(), 400);

                    // Check hit in both directions (legs extend both ways)
                    const legReach = 110;
                    const leftLegEnd = fighterX - legReach;
                    const rightLegEnd = fighterX + 50 + legReach;

                    if ((opponentX >= fighterX && opponentX <= rightLegEnd) ||
                        (opponentX <= fighterX && opponentX >= leftLegEnd)) {
                        dealDamage(special.damage, 'SPLIT KICK!');
                        if (opponent) {
                            opponent.classList.add('hit');
                            setTimeout(() => opponent.classList.remove('hit'), 300);
                        }
                    }
                }, 450);

                // Cleanup - longer to match slower animation
                setTimeout(() => {
                    legContainer.remove();
                    fighter.style.transform = '';
                    fighter.style.transition = '';
                    if (originalLegs) originalLegs.style.visibility = '';
                    if (originalFeet) originalFeet.style.visibility = '';
                    game.isAttacking = false;
                }, 1000);

            } else if (special.name === 'Salmon Sashimi') {
                // Throw 5 salmon sashimi - direction based on opponent position
                const throwDirection = facingRight ? 1 : -1;
                const startX = facingRight ? fighterX + 40 : fighterX - 10;

                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        const sashimi = document.createElement('div');
                        sashimi.style.cssText = `
                            position: absolute;
                            left: ${startX}px;
                            bottom: ${100 + (i - 2) * 15}px;
                            width: 32px;
                            height: 14px;
                            background: linear-gradient(170deg, #ff8c7a 0%, #fa8072 20%, #ffb4a8 22%, #fa8072 24%, #ff8c7a 40%, #ffb4a8 42%, #fa8072 44%, #e76f5a 60%, #ffb4a8 62%, #fa8072 64%, #ff8c7a 80%, #ffb4a8 82%, #e76f5a 100%);
                            border: 2px solid #d85a4a;
                            border-radius: ${facingRight ? '4px 12px 12px 4px' : '12px 4px 4px 12px'};
                            z-index: 100;
                            transform: ${facingRight ? '' : 'scaleX(-1)'};
                        `;
                        arena.appendChild(sashimi);

                        let sashimiX = startX;
                        const speed = 12 * throwDirection;
                        let hasHit = false;

                        const fly = setInterval(() => {
                            sashimiX += speed;
                            const wobble = Math.sin((sashimiX - startX) * 0.05) * 5;
                            sashimi.style.left = sashimiX + 'px';
                            sashimi.style.bottom = (100 + (i - 2) * 15 + wobble) + 'px';
                            sashimi.style.transform = `rotate(${(sashimiX - startX) * 2 * throwDirection}deg)`;

                            // Hit detection - check if sashimi reached opponent
                            if (!hasHit && Math.abs(sashimiX - opponentX) < 50) {
                                hasHit = true;
                                dealDamage(4, 'OISHI!');
                                if (i === 2) {
                                    showImpact('OISHI!', special.damage);
                                }
                            }

                            // Remove when off screen
                            if (sashimiX > 900 || sashimiX < -50) {
                                clearInterval(fly);
                                sashimi.remove();
                            }
                        }, 20);
                    }, i * 80);
                }

                setTimeout(() => {
                    fighter.classList.add('idle');
                    game.isAttacking = false;
                }, 700);

            } else if (special.name === 'Country Throw') {
                // Throw a random country - direction based on opponent position
                const country = countries[Math.floor(Math.random() * countries.length)];
                const throwDirection = facingRight ? 1 : -1;
                const startX = facingRight ? fighterX + 40 : fighterX - 10;

                const countryEl = document.createElement('div');
                countryEl.style.cssText = `
                    position: absolute;
                    left: ${startX}px;
                    bottom: 120px;
                    z-index: 100;
                `;
                countryEl.appendChild(createCountrySVG(country, 45));
                arena.appendChild(countryEl);

                // Show country name
                const nameText = document.createElement('div');
                nameText.textContent = country.name + '!';
                nameText.style.cssText = `
                    position: absolute;
                    left: ${facingRight ? fighterX + 60 : fighterX - 60}px;
                    bottom: 170px;
                    font-family: 'Permanent Marker', cursive;
                    font-size: 1rem;
                    color: ${country.color};
                    z-index: 200;
                `;
                arena.appendChild(nameText);
                setTimeout(() => nameText.remove(), 800);

                let countryX = startX;
                const speed = 8 * throwDirection;
                let hasHit = false;
                let frame = 0;

                const fly = setInterval(() => {
                    frame++;
                    countryX += speed;
                    const arc = Math.sin(frame * 0.08) * 40;
                    countryEl.style.left = countryX + 'px';
                    countryEl.style.bottom = (120 + arc) + 'px';
                    countryEl.style.transform = `rotate(${frame * 8 * throwDirection}deg) scale(${1 + frame * 0.01})`;

                    // Hit detection - check if country reached opponent
                    if (!hasHit && Math.abs(countryX - opponentX) < 50) {
                        hasHit = true;
                        clearInterval(fly);
                        dealDamage(special.damage, 'BONK!');
                        showImpact('BONK!', special.damage);

                        countryEl.style.transform = 'scale(1.5)';
                        countryEl.style.opacity = '0';
                        countryEl.style.transition = 'all 0.2s';
                        setTimeout(() => countryEl.remove(), 200);

                        fighter.classList.add('idle');
                        game.isAttacking = false;
                    }

                    // Remove if off screen without hitting
                    if (countryX > 900 || countryX < -50) {
                        clearInterval(fly);
                        countryEl.remove();
                        fighter.classList.add('idle');
                        game.isAttacking = false;
                    }
                }, 25);

            } else if (special.name === 'WORLD TOUR!') {
                // Ultimate: Throw all countries!
                const nameText = document.createElement('div');
                nameText.textContent = 'WORLD TOUR!';
                nameText.style.cssText = `
                    position: absolute;
                    left: 50%;
                    top: 80px;
                    transform: translateX(-50%);
                    font-family: 'Permanent Marker', cursive;
                    font-size: 2rem;
                    color: #ffd700;
                    text-shadow: 2px 2px 0 #333;
                    z-index: 200;
                `;
                arena.appendChild(nameText);
                setTimeout(() => nameText.remove(), 1500);

                let totalHits = 0;
                countries.forEach((country, i) => {
                    setTimeout(() => {
                        const countryEl = document.createElement('div');
                        let countryX = fighterX + 40;
                        countryEl.style.cssText = `
                            position: absolute;
                            left: ${countryX}px;
                            bottom: ${80 + (i % 4) * 20}px;
                            z-index: 100;
                        `;
                        countryEl.appendChild(createCountrySVG(country, 30));
                        arena.appendChild(countryEl);

                        let hit = false;
                        const fly = setInterval(() => {
                            countryX += 12;
                            const arc = Math.sin((countryX - fighterX) / 200 * Math.PI) * (15 + (i % 3) * 12);
                            countryEl.style.left = countryX + 'px';
                            countryEl.style.bottom = (80 + (i % 4) * 20 + arc) + 'px';
                            countryEl.style.transform = `rotate(${(countryX - fighterX) * 3}deg)`;

                            // Check if country hit enemy's CURRENT position
                            if (!hit && Math.abs(countryX - game.dummyX) < 40) {
                                hit = true;
                                totalHits++;
                                dealDamage(5, '');
                            }

                            if (countryX > 850) {
                                clearInterval(fly);
                                countryEl.style.opacity = '0';
                                countryEl.style.transition = 'opacity 0.15s';
                                setTimeout(() => countryEl.remove(), 150);
                            }
                        }, 20);
                    }, i * 50);
                });

                // Final impact - only if countries hit
                setTimeout(() => {
                    if (totalHits > 0) {
                        dealDamage(special.damage - 20, 'GLOBETROTTER!');
                        showImpact('GLOBETROTTER!', special.damage);
                    } else {
                        showImpact('MISSED!', '#888');
                    }

                    // Burst of countries
                    for (let i = 0; i < 6; i++) {
                        const burst = document.createElement('div');
                        burst.style.cssText = `
                            position: absolute;
                            left: ${targetX + 10}px;
                            bottom: 120px;
                            z-index: 100;
                        `;
                        burst.appendChild(createCountrySVG(countries[i], 20));
                        arena.appendChild(burst);

                        const angle = (i / 6) * Math.PI * 2;
                        const speed = 4;
                        let bx = 0, by = 0, bo = 1;
                        const burstFly = setInterval(() => {
                            bx += Math.cos(angle) * speed;
                            by += Math.sin(angle) * speed;
                            bo -= 0.05;
                            burst.style.transform = `translate(${bx}px, ${-by}px) rotate(${bx * 5}deg)`;
                            burst.style.opacity = bo;
                            if (bo <= 0) { clearInterval(burstFly); burst.remove(); }
                        }, 25);
                    }

                    fighter.classList.add('idle');
                    game.isAttacking = false;
                }, countries.length * 50 + 300);
            }
        }

        // TIMO - The Perpetual Complainer (joke character - all attacks do 0 damage!)
        function executeTimoSpecial(special, fighter) {
            const arena = document.getElementById('arena');

            if (special.name === 'Excessive Drool') {
                // Create drool puddles that do absolutely nothing
                fighter.style.animation = 'attack 0.3s ease-out';

                // Intensify drool animation
                const droolDrop = fighter.querySelector('.drool-drop');
                if (droolDrop) {
                    droolDrop.style.animation = 'droolHeavy 0.2s ease-in-out infinite';
                }

                // Create multiple drool drops
                for (let i = 0; i < 8; i++) {
                    setTimeout(() => {
                        const drool = document.createElement('div');
                        drool.style.cssText = `
                            position: absolute;
                            left: ${fighter.offsetLeft + 20 + Math.random() * 20}px;
                            top: ${fighter.offsetTop + 60}px;
                            width: ${6 + Math.random() * 4}px;
                            height: ${8 + Math.random() * 6}px;
                            background: linear-gradient(to bottom, rgba(150, 200, 255, 0.8), rgba(100, 150, 200, 0.6));
                            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
                            z-index: 100;
                            pointer-events: none;
                        `;
                        arena.appendChild(drool);

                        // Animate drool falling
                        let y = fighter.offsetTop + 60;
                        let vy = 0;
                        const groundY = arena.offsetHeight - 60;

                        const animateDrool = () => {
                            vy += 0.5;
                            y += vy;
                            drool.style.top = y + 'px';

                            if (y >= groundY) {
                                // Create puddle
                                drool.style.top = groundY + 'px';
                                drool.style.width = (10 + Math.random() * 10) + 'px';
                                drool.style.height = '4px';
                                drool.style.borderRadius = '50%';
                                drool.style.opacity = '0.5';

                                setTimeout(() => drool.remove(), 2000);
                            } else {
                                requestAnimationFrame(animateDrool);
                            }
                        };
                        requestAnimationFrame(animateDrool);
                    }, i * 100);
                }

                // Show MISS text
                setTimeout(() => {
                    showImpact('MISS!', '#888');
                    if (droolDrop) {
                        droolDrop.style.animation = 'droolBob 1s ease-in-out infinite';
                    }
                }, 800);

                setTimeout(() => {
                    fighter.style.animation = '';
                    game.isAttacking = false;
                }, 1000);
            }
            else if (special.name === 'Loud Complaining') {
                // Create speech bubbles with complaints that do nothing
                fighter.style.animation = 'attack 0.3s ease-out';

                // Animate mouth
                const mouth = fighter.querySelector('.mouth');
                if (mouth) {
                    mouth.style.animation = 'yap 0.15s ease-in-out infinite';
                }

                const complaints = [
                    'WAAAH!', 'NOT FAIR!', 'I WANT!', 'NO!', 'MINE!',
                    'BORING!', 'STUPID!', 'HATE IT!', 'WHY?!', 'UGH!'
                ];

                for (let i = 0; i < 6; i++) {
                    setTimeout(() => {
                        const bubble = document.createElement('div');
                        const complaint = complaints[Math.floor(Math.random() * complaints.length)];
                        bubble.textContent = complaint;
                        bubble.style.cssText = `
                            position: absolute;
                            left: ${fighter.offsetLeft + 50 + i * 30}px;
                            top: ${fighter.offsetTop + 20 + Math.random() * 40}px;
                            background: white;
                            border: 3px solid #333;
                            border-radius: 20px;
                            padding: 8px 12px;
                            font-family: 'Permanent Marker', cursive;
                            font-size: ${14 + Math.random() * 8}px;
                            color: #333;
                            z-index: 100;
                            transform: rotate(${(Math.random() - 0.5) * 20}deg);
                            pointer-events: none;
                        `;
                        arena.appendChild(bubble);

                        // Float up and fade
                        let y = parseFloat(bubble.style.top);
                        let opacity = 1;
                        const animateBubble = () => {
                            y -= 2;
                            opacity -= 0.02;
                            bubble.style.top = y + 'px';
                            bubble.style.opacity = opacity;

                            if (opacity > 0) {
                                requestAnimationFrame(animateBubble);
                            } else {
                                bubble.remove();
                            }
                        };
                        setTimeout(() => requestAnimationFrame(animateBubble), 300);
                    }, i * 150);
                }

                // Show MISS
                setTimeout(() => {
                    showImpact('MISS!', '#888');
                    if (mouth) {
                        mouth.style.animation = '';
                    }
                }, 1000);

                setTimeout(() => {
                    fighter.style.animation = '';
                    game.isAttacking = false;
                }, 1200);
            }
            else if (special.name === 'Wave the Flag') {
                // Wave the flag dramatically - does nothing
                fighter.style.animation = 'attack 0.3s ease-out';

                // Intensify flag waving
                const flagPole = fighter.querySelector('.flag-pole');
                const flag = fighter.querySelector('.flag');

                if (flagPole) {
                    flagPole.style.animation = 'waveFlag 0.15s ease-in-out infinite';
                    flagPole.style.transformOrigin = 'bottom center';
                }
                if (flag) {
                    flag.style.width = '50px';
                    flag.style.height = '35px';
                    flag.style.fontSize = '14px';
                }

                // Create flag particles
                const flagColors = ['#0088ce', '#dc000c', '#ffcc00'];
                for (let i = 0; i < 20; i++) {
                    setTimeout(() => {
                        const particle = document.createElement('div');
                        const color = flagColors[Math.floor(Math.random() * flagColors.length)];
                        particle.style.cssText = `
                            position: absolute;
                            left: ${fighter.offsetLeft - 30}px;
                            top: ${fighter.offsetTop + 30 + Math.random() * 20}px;
                            width: ${4 + Math.random() * 6}px;
                            height: ${4 + Math.random() * 6}px;
                            background: ${color};
                            border-radius: 2px;
                            z-index: 100;
                            pointer-events: none;
                        `;
                        arena.appendChild(particle);

                        let x = fighter.offsetLeft - 30;
                        let y = parseFloat(particle.style.top);
                        let vx = -3 - Math.random() * 4;
                        let vy = (Math.random() - 0.5) * 4;
                        let opacity = 1;

                        const animateParticle = () => {
                            x += vx;
                            y += vy;
                            vy += 0.1;
                            opacity -= 0.02;

                            particle.style.left = x + 'px';
                            particle.style.top = y + 'px';
                            particle.style.opacity = opacity;

                            if (opacity > 0 && x > -50) {
                                requestAnimationFrame(animateParticle);
                            } else {
                                particle.remove();
                            }
                        };
                        requestAnimationFrame(animateParticle);
                    }, i * 50);
                }

                // Show MISS
                setTimeout(() => {
                    showImpact('MISS!', '#888');
                    if (flagPole) {
                        flagPole.style.animation = '';
                    }
                    if (flag) {
                        flag.style.width = '35px';
                        flag.style.height = '22px';
                        flag.style.fontSize = '9px';
                    }
                }, 1000);

                setTimeout(() => {
                    fighter.style.animation = '';
                    game.isAttacking = false;
                }, 1200);
            }
            else if (special.name === 'MEGA TANTRUM!') {
                // Ultimate - all three combined but still does NOTHING
                showImpact('MEGA TANTRUM!', '#888');
                fighter.style.animation = 'ultimate-charge 0.5s ease-out';

                // Screen shake
                arena.style.animation = 'shake 0.1s ease-in-out infinite';

                // Intensify all animations
                const droolDrop = fighter.querySelector('.drool-drop');
                const mouth = fighter.querySelector('.mouth');
                const flagPole = fighter.querySelector('.flag-pole');
                const flag = fighter.querySelector('.flag');

                if (droolDrop) droolDrop.style.animation = 'droolHeavy 0.1s ease-in-out infinite';
                if (mouth) mouth.style.animation = 'yap 0.1s ease-in-out infinite';
                if (flagPole) {
                    flagPole.style.animation = 'waveFlag 0.1s ease-in-out infinite';
                    flagPole.style.transformOrigin = 'bottom center';
                }
                if (flag) {
                    flag.style.width = '60px';
                    flag.style.height = '40px';
                    flag.style.fontSize = '16px';
                }

                // Massive drool flood
                for (let i = 0; i < 30; i++) {
                    setTimeout(() => {
                        const drool = document.createElement('div');
                        drool.style.cssText = `
                            position: absolute;
                            left: ${fighter.offsetLeft + Math.random() * 60}px;
                            top: ${fighter.offsetTop + 50}px;
                            width: ${8 + Math.random() * 8}px;
                            height: ${10 + Math.random() * 10}px;
                            background: linear-gradient(to bottom, rgba(150, 200, 255, 0.9), rgba(100, 150, 200, 0.7));
                            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
                            z-index: 100;
                        `;
                        arena.appendChild(drool);

                        let y = fighter.offsetTop + 50;
                        let vy = Math.random() * 2;
                        const groundY = arena.offsetHeight - 60;

                        const animateDrool = () => {
                            vy += 0.6;
                            y += vy;
                            drool.style.top = y + 'px';

                            if (y >= groundY) {
                                drool.style.top = groundY + 'px';
                                drool.style.width = (15 + Math.random() * 15) + 'px';
                                drool.style.height = '5px';
                                drool.style.borderRadius = '50%';
                                setTimeout(() => drool.remove(), 3000);
                            } else {
                                requestAnimationFrame(animateDrool);
                            }
                        };
                        requestAnimationFrame(animateDrool);
                    }, i * 30);
                }

                // Complaint storm
                const complaints = [
                    'WAAAAAAH!', 'THIS IS UNFAIR!', 'I HATE EVERYTHING!',
                    'NOBODY UNDERSTANDS!', 'WORST DAY EVER!', 'NOT MY FAULT!'
                ];
                for (let i = 0; i < 10; i++) {
                    setTimeout(() => {
                        const bubble = document.createElement('div');
                        bubble.textContent = complaints[Math.floor(Math.random() * complaints.length)];
                        bubble.style.cssText = `
                            position: absolute;
                            left: ${fighter.offsetLeft + Math.random() * 200}px;
                            top: ${fighter.offsetTop - 50 + Math.random() * 100}px;
                            background: white;
                            border: 4px solid #ff0000;
                            border-radius: 25px;
                            padding: 10px 15px;
                            font-family: 'Permanent Marker', cursive;
                            font-size: ${16 + Math.random() * 12}px;
                            color: #ff0000;
                            z-index: 150;
                            transform: rotate(${(Math.random() - 0.5) * 30}deg);
                        `;
                        arena.appendChild(bubble);

                        setTimeout(() => {
                            bubble.style.transition = 'all 0.5s ease-out';
                            bubble.style.opacity = '0';
                            bubble.style.transform = `translateY(-50px) rotate(${(Math.random() - 0.5) * 60}deg)`;
                            setTimeout(() => bubble.remove(), 500);
                        }, 800);
                    }, i * 100);
                }

                // Flag particle explosion
                const flagColors = ['#0088ce', '#dc000c', '#ffcc00'];
                for (let i = 0; i < 40; i++) {
                    setTimeout(() => {
                        const particle = document.createElement('div');
                        const color = flagColors[Math.floor(Math.random() * flagColors.length)];
                        particle.style.cssText = `
                            position: absolute;
                            left: ${fighter.offsetLeft}px;
                            top: ${fighter.offsetTop + 40}px;
                            width: ${6 + Math.random() * 8}px;
                            height: ${6 + Math.random() * 8}px;
                            background: ${color};
                            z-index: 100;
                        `;
                        arena.appendChild(particle);

                        const angle = Math.random() * Math.PI * 2;
                        const speed = 5 + Math.random() * 8;
                        let x = fighter.offsetLeft;
                        let y = fighter.offsetTop + 40;
                        let vx = Math.cos(angle) * speed;
                        let vy = Math.sin(angle) * speed;
                        let opacity = 1;

                        const animate = () => {
                            x += vx;
                            y += vy;
                            vy += 0.2;
                            opacity -= 0.015;

                            particle.style.left = x + 'px';
                            particle.style.top = y + 'px';
                            particle.style.opacity = opacity;

                            if (opacity > 0) {
                                requestAnimationFrame(animate);
                            } else {
                                particle.remove();
                            }
                        };
                        requestAnimationFrame(animate);
                    }, i * 25);
                }

                // Show multiple MISS texts
                setTimeout(() => showImpact('MISS!', '#888'), 500);
                setTimeout(() => showImpact('MISS!', '#888'), 800);
                setTimeout(() => showImpact('MISS!', '#888'), 1100);
                setTimeout(() => showImpact('TOTAL FAILURE!', '#ff0000'), 1500);

                // Reset everything
                setTimeout(() => {
                    arena.style.animation = '';
                    fighter.style.animation = '';
                    if (droolDrop) droolDrop.style.animation = 'droolBob 1s ease-in-out infinite';
                    if (mouth) mouth.style.animation = '';
                    if (flagPole) flagPole.style.animation = '';
                    if (flag) {
                        flag.style.width = '35px';
                        flag.style.height = '22px';
                        flag.style.fontSize = '9px';
                    }
                    game.isAttacking = false;
                }, 2500);
            }
        }

        // PANCHO - The Tech Superman
        function executePanchoSpecial(special, fighter) {
            const arena = document.getElementById('arena');
            const dummy = document.getElementById('npc-dummy');
            const dummyRect = dummy.getBoundingClientRect();
            const arenaRect = arena.getBoundingClientRect();
            const targetX = dummyRect.left - arenaRect.left;
            const fighterX = parseFloat(fighter.style.left) || game.playerX;

            if (special.name === 'Gadget Throw') {
                // Throw keyboard and mouse as projectiles
                fighter.style.animation = 'attack 0.3s ease-out';

                const gadgets = ['keyboard', 'mouse'];
                gadgets.forEach((gadgetType, index) => {
                    setTimeout(() => {
                        const gadget = document.createElement('div');

                        if (gadgetType === 'keyboard') {
                            // Nice keyboard design
                            gadget.innerHTML = `
                                <div style="
                                    width: 50px;
                                    height: 20px;
                                    background: linear-gradient(180deg, #444, #333);
                                    border: 2px solid #222;
                                    border-radius: 3px;
                                    display: grid;
                                    grid-template-columns: repeat(10, 1fr);
                                    grid-template-rows: repeat(3, 1fr);
                                    gap: 1px;
                                    padding: 2px;
                                    box-shadow: 0 2px 4px rgba(0,0,0,0.5);
                                ">
                                    ${Array(30).fill('<div style="background:#666;border-radius:1px;"></div>').join('')}
                                </div>
                            `;
                        } else {
                            // Nice mouse design
                            gadget.innerHTML = `
                                <div style="
                                    width: 18px;
                                    height: 28px;
                                    background: linear-gradient(180deg, #555, #333);
                                    border: 2px solid #222;
                                    border-radius: 10px 10px 12px 12px;
                                    position: relative;
                                    box-shadow: 0 2px 4px rgba(0,0,0,0.5);
                                ">
                                    <div style="
                                        position: absolute;
                                        top: 3px;
                                        left: 50%;
                                        transform: translateX(-50%);
                                        width: 4px;
                                        height: 8px;
                                        background: #888;
                                        border-radius: 2px;
                                    "></div>
                                    <div style="
                                        position: absolute;
                                        top: 12px;
                                        left: 50%;
                                        transform: translateX(-50%);
                                        width: 10px;
                                        height: 1px;
                                        background: #222;
                                    "></div>
                                </div>
                            `;
                        }

                        gadget.style.cssText = `
                            position: absolute;
                            left: ${fighterX + 50}px;
                            bottom: ${110 + index * 20}px;
                            z-index: 100;
                            pointer-events: none;
                        `;
                        arena.appendChild(gadget);

                        let x = fighterX + 50;
                        let y = 110 + index * 20;
                        const speed = 15;
                        let rotation = 0;

                        const flyGadget = setInterval(() => {
                            x += speed;
                            rotation += 15;
                            y += Math.sin(rotation * 0.1) * 2;

                            gadget.style.left = x + 'px';
                            gadget.style.bottom = y + 'px';
                            gadget.style.transform = `rotate(${rotation}deg)`;

                            // Get current dummy position (it might have moved)
                            const currentDummyX = game.dummyX;

                            // Check if hit target or went off screen
                            if (x >= currentDummyX - 30 || x > arena.offsetWidth) {
                                clearInterval(flyGadget);

                                if (x <= arena.offsetWidth) {
                                    // Hit the target
                                    if (index === 0) {
                                        dealDamage(special.damage, 'TECH ATTACK!');
                                        showImpact('TECH ATTACK!', '#2563eb');
                                    }

                                    // Explosion effect
                                    for (let i = 0; i < 6; i++) {
                                        const part = document.createElement('div');
                                        part.style.cssText = `
                                            position: absolute;
                                            left: ${x}px;
                                            bottom: ${y}px;
                                            width: 6px;
                                            height: 6px;
                                            background: ${gadgetType === 'keyboard' ? '#666' : '#555'};
                                            border-radius: 2px;
                                            z-index: 100;
                                        `;
                                        arena.appendChild(part);

                                        const angle = (i / 6) * Math.PI * 2;
                                        let px = 0, py = 0, po = 1;
                                        const partFly = setInterval(() => {
                                            px += Math.cos(angle) * 5;
                                            py += Math.sin(angle) * 5;
                                            po -= 0.08;
                                            part.style.transform = `translate(${px}px, ${-py}px)`;
                                            part.style.opacity = po;
                                            if (po <= 0) { clearInterval(partFly); part.remove(); }
                                        }, 25);
                                    }
                                }

                                gadget.remove();
                            }
                        }, 20);
                    }, index * 200);
                });

                setTimeout(() => {
                    fighter.style.animation = '';
                    game.isAttacking = false;
                }, 800);
            }
            else if (special.name === 'Superman Flight') {
                // Fly up and move freely for 5 seconds!
                showImpact('UP, UP AND AWAY!', '#2563eb');
                fighter.classList.add('flying');
                fighter.classList.remove('idle');

                // Allow movement while flying
                game.isAttacking = false;
                game.isFlying = true;

                // Store original bottom position
                const originalBottom = parseInt(fighter.style.bottom) || 68;
                game.flyHeight = originalBottom + 80;
                fighter.style.bottom = game.flyHeight + 'px';

                // Create wind effect while flying
                const windInterval = setInterval(() => {
                    if (!game.isFlying) {
                        clearInterval(windInterval);
                        return;
                    }
                    const currentX = parseFloat(fighter.style.left) || game.playerX;
                    for (let i = 0; i < 2; i++) {
                        const wind = document.createElement('div');
                        wind.style.cssText = `
                            position: absolute;
                            left: ${currentX + 10 + Math.random() * 30}px;
                            bottom: ${game.flyHeight - 30}px;
                            width: ${15 + Math.random() * 20}px;
                            height: 3px;
                            background: rgba(255,255,255,0.6);
                            border-radius: 2px;
                            z-index: 50;
                        `;
                        arena.appendChild(wind);

                        let wy = 0;
                        const windFall = setInterval(() => {
                            wy += 10;
                            wind.style.transform = `translateY(${wy}px)`;
                            wind.style.opacity = 1 - wy / 80;
                            if (wy > 80) { clearInterval(windFall); wind.remove(); }
                        }, 25);
                    }
                }, 150);

                // After 5 seconds, come back down
                setTimeout(() => {
                    clearInterval(windInterval);
                    game.isFlying = false;

                    showImpact('LANDING!', '#2563eb');

                    let currentBottom = game.flyHeight;
                    const flyDown = setInterval(() => {
                        currentBottom -= 8;
                        fighter.style.bottom = currentBottom + 'px';

                        if (currentBottom <= originalBottom) {
                            clearInterval(flyDown);
                            fighter.style.bottom = originalBottom + 'px';
                            fighter.classList.remove('flying');
                            fighter.classList.add('idle');
                        }
                    }, 30);
                }, 5000);
            }
            else if (special.name === 'Heat Vision') {
                // Laser eyes - must hit enemy to deal damage
                fighter.classList.add('laser-eyes');

                // Show "HEAT VISION!" text
                const heatText = document.createElement('div');
                heatText.textContent = 'HEAT VISION!';
                heatText.style.cssText = `
                    position: absolute;
                    left: ${fighterX + 50}px;
                    bottom: 200px;
                    font-family: 'Bangers', cursive;
                    font-size: 32px;
                    color: #ff0000;
                    text-shadow: 0 0 10px #ff0000, 0 0 20px #ff4444, 2px 2px 0 #000;
                    z-index: 200;
                    animation: heatTextPulse 0.3s ease-in-out infinite alternate;
                `;
                arena.appendChild(heatText);
                setTimeout(() => heatText.remove(), 2000);

                // Create laser beams from eyes
                let hit = false;

                for (let i = 0; i < 2; i++) {
                    const laser = document.createElement('div');
                    const laserStartX = fighterX + 25 + i * 10;
                    laser.style.cssText = `
                        position: absolute;
                        left: ${laserStartX}px;
                        bottom: 145px;
                        width: 0;
                        height: 4px;
                        background: linear-gradient(90deg, #ff0000, #ff4444, #ffff00);
                        box-shadow: 0 0 10px #ff0000, 0 0 20px #ff4444;
                        border-radius: 2px;
                        z-index: 100;
                        transform-origin: left center;
                    `;
                    arena.appendChild(laser);

                    let laserWidth = 0;
                    const maxWidth = 600;

                    const extendLaser = setInterval(() => {
                        laserWidth += 20;
                        laser.style.width = laserWidth + 'px';

                        // Check if laser tip reaches enemy's CURRENT position
                        const laserTipX = laserStartX + laserWidth;
                        if (!hit && Math.abs(laserTipX - game.dummyX) < 40) {
                            hit = true;
                            dealDamage(special.damage, 'BURN!');
                            dummy.classList.add('burning');

                            // Create fire particles - CSS flames
                            const burnInterval = setInterval(() => {
                                const currentDummyX = game.dummyX;
                                for (let f = 0; f < 2; f++) {
                                    const fire = document.createElement('div');
                                    const size = 12 + Math.random() * 8;
                                    fire.style.cssText = `
                                        position: absolute;
                                        left: ${currentDummyX + Math.random() * 50}px;
                                        bottom: ${80 + Math.random() * 60}px;
                                        width: ${size}px;
                                        height: ${size * 1.3}px;
                                        background: linear-gradient(0deg, #ff4500 0%, #ff6600 40%, #ffcc00 70%, transparent 100%);
                                        border-radius: 50% 50% 20% 20%;
                                        z-index: 100;
                                        pointer-events: none;
                                    `;
                                    arena.appendChild(fire);

                                    let fy = 0;
                                    const fireFly = setInterval(() => {
                                        fy += 4;
                                        fire.style.transform = `translateY(-${fy}px)`;
                                        fire.style.opacity = 1 - fy / 60;
                                        if (fy > 60) { clearInterval(fireFly); fire.remove(); }
                                    }, 25);
                                }
                            }, 80);

                            // Burn damage over time (3 seconds)
                            let burnTicks = 0;
                            const burnDamageInterval = setInterval(() => {
                                burnTicks++;
                                dealDamage(5, 'BURNING!');

                                if (burnTicks >= 6) {
                                    clearInterval(burnDamageInterval);
                                    clearInterval(burnInterval);
                                    dummy.classList.remove('burning');
                                }
                            }, 500);
                        }

                        // Laser reaches max length
                        if (laserWidth >= maxWidth) {
                            clearInterval(extendLaser);
                            laser.style.opacity = '0';
                            laser.style.transition = 'opacity 0.3s';
                            setTimeout(() => laser.remove(), 300);

                            // Show missed if no hit on first laser
                            if (i === 0 && !hit) {
                                showImpact('MISSED!', '#888');
                            }
                        }
                    }, 20);
                }

                setTimeout(() => {
                    fighter.classList.remove('laser-eyes');
                    fighter.style.animation = '';
                    game.isAttacking = false;
                }, 1500);
            }
            else if (special.name === 'FREEZE BREATH!') {
                // Ultimate - freeze breath must reach enemy to freeze them
                fighter.style.animation = 'ultimate-charge 0.5s ease-out';

                // Create freeze breath cone
                const breath = document.createElement('div');
                const breathStartX = fighterX + 45;
                breath.style.cssText = `
                    position: absolute;
                    left: ${breathStartX}px;
                    bottom: 130px;
                    width: 0;
                    height: 60px;
                    background: linear-gradient(90deg,
                        rgba(135, 206, 235, 0.8) 0%,
                        rgba(173, 216, 230, 0.6) 50%,
                        rgba(255, 255, 255, 0.4) 100%);
                    clip-path: polygon(0 50%, 100% 0, 100% 100%);
                    z-index: 100;
                    transform-origin: left center;
                `;
                arena.appendChild(breath);

                let breathWidth = 0;
                let hit = false;
                const maxWidth = 600;

                // Create ice particles - CSS crystals instead of emojis
                const iceInterval = setInterval(() => {
                    for (let i = 0; i < 5; i++) {
                        const ice = document.createElement('div');
                        const size = 6 + Math.random() * 8;
                        ice.style.cssText = `
                            position: absolute;
                            left: ${fighterX + 50 + Math.random() * breathWidth}px;
                            bottom: ${100 + Math.random() * 80}px;
                            width: ${size}px;
                            height: ${size}px;
                            background: #87ceeb;
                            clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
                            z-index: 101;
                            pointer-events: none;
                            box-shadow: 0 0 4px #fff;
                        `;
                        arena.appendChild(ice);

                        let ix = 0;
                        const iceFly = setInterval(() => {
                            ix += 10;
                            ice.style.transform = `translateX(${ix}px) rotate(${ix * 3}deg)`;
                            ice.style.opacity = 1 - ix / 200;
                            if (ix > 200) { clearInterval(iceFly); ice.remove(); }
                        }, 30);
                    }
                }, 100);

                const extendBreath = setInterval(() => {
                    breathWidth += 15;
                    breath.style.width = breathWidth + 'px';

                    // Check if breath tip reaches enemy's CURRENT position
                    const breathTipX = breathStartX + breathWidth;
                    if (!hit && Math.abs(breathTipX - game.dummyX) < 50) {
                        hit = true;
                        clearInterval(extendBreath);
                        clearInterval(iceInterval);

                        // Freeze the enemy!
                        dealDamage(special.damage, 'FROZEN!');
                        dummy.classList.add('frozen');

                        // Create ice block around dummy at CURRENT position
                        const currentDummyX = game.dummyX;
                        const iceBlock = document.createElement('div');
                        iceBlock.style.cssText = `
                            position: absolute;
                            left: ${currentDummyX - 15}px;
                            bottom: 55px;
                            width: 80px;
                            height: 120px;
                            background: rgba(135, 206, 235, 0.3);
                            border: 4px solid #87ceeb;
                            border-radius: 10px;
                            z-index: 99;
                            box-shadow: 0 0 20px rgba(135, 206, 235, 0.5), inset 0 0 30px rgba(255, 255, 255, 0.3);
                        `;
                        arena.appendChild(iceBlock);

                        // Add ice crystals - CSS diamonds
                        for (let i = 0; i < 8; i++) {
                            const crystal = document.createElement('div');
                            const size = 8 + Math.random() * 8;
                            crystal.style.cssText = `
                                position: absolute;
                                left: ${currentDummyX - 10 + Math.random() * 70}px;
                                bottom: ${60 + Math.random() * 100}px;
                                width: ${size}px;
                                height: ${size}px;
                                background: linear-gradient(135deg, #fff 0%, #87ceeb 50%, #add8e6 100%);
                                clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
                                z-index: 100;
                                box-shadow: 0 0 5px #fff;
                            `;
                            arena.appendChild(crystal);
                            setTimeout(() => crystal.remove(), 5000);
                        }

                        breath.style.opacity = '0';
                        breath.style.transition = 'opacity 0.3s';
                        setTimeout(() => breath.remove(), 300);

                        // Unfreeze after 5 seconds
                        setTimeout(() => {
                            dummy.classList.remove('frozen');
                            iceBlock.style.transition = 'opacity 0.5s';
                            iceBlock.style.opacity = '0';
                            setTimeout(() => iceBlock.remove(), 500);
                            showImpact('THAWED!', '#87ceeb');
                        }, 5000);
                    }

                    // Breath reaches max width without hitting
                    if (breathWidth >= maxWidth) {
                        clearInterval(extendBreath);
                        clearInterval(iceInterval);
                        breath.style.opacity = '0';
                        breath.style.transition = 'opacity 0.3s';
                        setTimeout(() => breath.remove(), 300);
                        if (!hit) {
                            showImpact('MISSED!', '#888');
                        }
                    }
                }, 20);

                setTimeout(() => {
                    fighter.style.animation = '';
                    game.isAttacking = false;
                }, 2000);
            }
        }

        // MADONNA - The Pop Queen
        function executeMadonnaSpecial(special, fighter) {
            const arena = document.getElementById('arena');
            const dummy = document.getElementById('npc-dummy');
            const dummyRect = dummy.getBoundingClientRect();
            const arenaRect = arena.getBoundingClientRect();
            const targetX = dummyRect.left - arenaRect.left;
            const fighterX = parseFloat(fighter.style.left) || game.playerX;

            if (special.name === 'Vogue Strike') {
                // Madonna struts forward striking iconic poses
                fighter.classList.add('vogueing');

                // Spotlight follows Madonna
                const spotlight = document.createElement('div');
                spotlight.style.cssText = `
                    position: absolute;
                    left: 0; top: 0; right: 0; bottom: 0;
                    background: radial-gradient(circle at ${fighterX + 30}px 120px,
                        rgba(255,255,255,0.3) 0%, transparent 150px);
                    z-index: 140;
                    pointer-events: none;
                `;
                arena.appendChild(spotlight);

                let x = fighterX;
                let poseIndex = 0;
                let hit = false;
                const poses = [
                    { clipPath: 'polygon(50% 0%, 100% 25%, 80% 100%, 20% 100%, 0% 25%)', arm: 'up' },
                    { clipPath: 'polygon(30% 0%, 70% 0%, 100% 50%, 70% 100%, 30% 100%, 0% 50%)', arm: 'side' },
                    { clipPath: 'polygon(50% 0%, 85% 15%, 100% 50%, 70% 100%, 30% 100%, 0% 50%, 15% 15%)', arm: 'frame' },
                    { clipPath: 'polygon(20% 0%, 80% 0%, 100% 30%, 80% 50%, 100% 100%, 0% 100%, 20% 50%, 0% 30%)', arm: 'cross' }
                ];

                // Strut forward with poses
                const strut = setInterval(() => {
                    x += 8;
                    fighter.style.left = x + 'px';

                    // Update spotlight to follow
                    spotlight.style.background = `radial-gradient(circle at ${x + 30}px 120px,
                        rgba(255,255,255,0.3) 0%, transparent 150px)`;

                    // Strike a pose every 60px
                    if (Math.floor((x - fighterX) / 60) > poseIndex && poseIndex < poses.length) {
                        // Create pose silhouette trail
                        const shadow = document.createElement('div');
                        shadow.style.cssText = `
                            position: absolute;
                            left: ${x}px;
                            bottom: 60px;
                            width: 50px;
                            height: 80px;
                            background: linear-gradient(180deg, #e91e8c, #ff69b4);
                            clip-path: ${poses[poseIndex].clipPath};
                            opacity: 0.7;
                            z-index: 139;
                            filter: blur(2px);
                        `;
                        arena.appendChild(shadow);
                        setTimeout(() => {
                            shadow.style.transition = 'opacity 0.5s';
                            shadow.style.opacity = '0';
                            setTimeout(() => shadow.remove(), 500);
                        }, 100);

                        // Sparkle effect
                        for (let s = 0; s < 5; s++) {
                            const sparkle = document.createElement('div');
                            sparkle.style.cssText = `
                                position: absolute;
                                left: ${x + 20 + Math.random() * 20}px;
                                bottom: ${80 + Math.random() * 60}px;
                                width: 4px; height: 4px;
                                background: #fff;
                                border-radius: 50%;
                                box-shadow: 0 0 6px #e91e8c;
                                z-index: 145;
                            `;
                            arena.appendChild(sparkle);
                            setTimeout(() => sparkle.remove(), 300);
                        }

                        poseIndex++;
                    }

                    // Check if Madonna reaches enemy
                    if (!hit && Math.abs(x - game.dummyX) < 50) {
                        hit = true;
                        clearInterval(strut);
                        dealDamage(special.damage, 'VOGUE!');

                        // Final dramatic pose
                        fighter.style.transform = 'scale(1.1)';
                        arena.style.boxShadow = 'inset 0 0 60px rgba(233, 30, 140, 0.5)';

                        setTimeout(() => {
                            fighter.style.transform = '';
                            arena.style.boxShadow = '';
                            spotlight.remove();
                            game.playerX = x;
                            fighter.classList.remove('vogueing');
                            game.isAttacking = false;
                        }, 400);
                    }

                    // Went too far without hitting
                    if (x > 750 && !hit) {
                        clearInterval(strut);
                        spotlight.remove();
                        showImpact('MISSED!', '#888');
                        game.playerX = x;
                        fighter.classList.remove('vogueing');
                        game.isAttacking = false;
                    }
                }, 40);

            } else if (special.name === 'Mic Drop') {
                // Drop microphone as projectile
                fighter.style.animation = 'attack 0.3s ease-out';

                const mic = document.createElement('div');
                mic.innerHTML = `
                    <div style="
                        width: 12px;
                        height: 30px;
                        background: linear-gradient(180deg, #333 0%, #666 50%, #333 100%);
                        border: 2px solid #000;
                        border-radius: 6px;
                        position: relative;
                    ">
                        <div style="
                            position: absolute;
                            top: -10px;
                            left: 50%;
                            transform: translateX(-50%);
                            width: 16px;
                            height: 16px;
                            background: radial-gradient(circle, #444, #222);
                            border: 2px solid #000;
                            border-radius: 50%;
                        "></div>
                    </div>
                `;
                mic.style.cssText = `
                    position: absolute;
                    left: ${fighterX + 40}px;
                    bottom: 140px;
                    z-index: 150;
                `;
                arena.appendChild(mic);

                let x = fighterX + 40;
                let y = 140;
                let vy = 5;
                const gravity = -0.8;

                const dropMic = setInterval(() => {
                    x += 8;
                    vy += gravity;
                    y += vy;

                    mic.style.left = x + 'px';
                    mic.style.bottom = y + 'px';
                    mic.style.transform = `rotate(${(x - fighterX) * 3}deg)`;

                    if (y <= 60) {
                        clearInterval(dropMic);
                        // Impact effect
                        showImpact('MIC DROP!', '#e91e8c');
                        if (Math.abs(x - targetX) < 80) {
                            dealDamage(special.damage);
                        }
                        mic.remove();
                        fighter.style.animation = '';
                        game.isAttacking = false;
                    }
                }, 30);

            } else if (special.name === 'Blond Ambition') {
                // Madonna's iconic cone bra from the 1990 tour - shoots pointed projectiles
                let totalHits = 0;
                let conesFinished = 0;

                // Charging pose - Madonna thrusts forward
                fighter.style.transform = 'scaleX(1.1)';

                // Energy buildup around chest area
                const chargeEffect = document.createElement('div');
                chargeEffect.style.cssText = `
                    position: absolute;
                    left: ${fighterX + 20}px;
                    bottom: 110px;
                    width: 40px;
                    height: 30px;
                    background: radial-gradient(ellipse, rgba(255,215,0,0.8), transparent);
                    z-index: 149;
                    animation: pulse 0.2s ease-in-out 2;
                `;
                arena.appendChild(chargeEffect);

                setTimeout(() => {
                    chargeEffect.remove();
                    fighter.style.transform = '';

                    // Fire the cone projectiles
                    const cones = [
                        { angle: -8, delay: 0 },
                        { angle: 8, delay: 150 }
                    ];

                    cones.forEach(cone => {
                        setTimeout(() => {
                            const proj = document.createElement('div');
                            // Cone shape - pointed like the iconic bra
                            proj.style.cssText = `
                                position: absolute;
                                width: 0;
                                height: 0;
                                border-left: 12px solid transparent;
                                border-right: 12px solid transparent;
                                border-bottom: 30px solid #ffd700;
                                left: ${fighterX + 45}px;
                                bottom: 115px;
                                z-index: 150;
                                filter: drop-shadow(0 0 8px #ffd700) drop-shadow(0 0 15px #ff69b4);
                                transform: rotate(90deg);
                            `;
                            arena.appendChild(proj);

                            // Trail effect
                            let px = fighterX + 45;
                            const py = 115;
                            const angleRad = cone.angle * Math.PI / 180;
                            let hit = false;

                            const flyProj = setInterval(() => {
                                px += 14;
                                proj.style.left = px + 'px';
                                proj.style.bottom = (py + Math.tan(angleRad) * (px - fighterX - 45)) + 'px';

                                // Sparkle trail
                                if (Math.random() > 0.5) {
                                    const spark = document.createElement('div');
                                    spark.style.cssText = `
                                        position: absolute;
                                        left: ${px - 5}px;
                                        bottom: ${py + Math.tan(angleRad) * (px - fighterX - 45)}px;
                                        width: 4px; height: 4px;
                                        background: #ff69b4;
                                        border-radius: 50%;
                                        z-index: 148;
                                    `;
                                    arena.appendChild(spark);
                                    setTimeout(() => spark.remove(), 200);
                                }

                                // Check against enemy's CURRENT position
                                if (!hit && Math.abs(px - game.dummyX) < 45) {
                                    hit = true;
                                    totalHits++;
                                    clearInterval(flyProj);
                                    dealDamage(special.damage / 2, totalHits === 1 ? 'AMBITION!' : '');
                                    proj.style.transform = 'rotate(90deg) scale(1.5)';
                                    proj.style.opacity = '0';
                                    proj.style.transition = 'all 0.2s';
                                    setTimeout(() => proj.remove(), 200);
                                    conesFinished++;
                                } else if (px > 850) {
                                    clearInterval(flyProj);
                                    proj.remove();
                                    conesFinished++;
                                    if (conesFinished === 2 && totalHits === 0) {
                                        showImpact('MISSED!', '#888');
                                    }
                                }
                            }, 25);
                        }, cone.delay);
                    });
                }, 400);

                setTimeout(() => {
                    game.isAttacking = false;
                }, 1000);

            } else if (special.name === 'MATERIAL WORLD!') {
                // Ultimate: Disco ball shoots light beams at enemy

                // Create disco ball
                const disco = document.createElement('div');
                disco.style.cssText = `
                    position: absolute;
                    left: 50%;
                    top: 100px;
                    transform: translateX(-50%);
                    width: 80px;
                    height: 80px;
                    background: radial-gradient(circle at 30% 30%, #fff, #888);
                    border-radius: 50%;
                    box-shadow: 0 0 30px #ffd700;
                    z-index: 200;
                    animation: discoSpin 0.5s linear infinite;
                `;
                arena.appendChild(disco);

                // Shoot light beams at enemy - each must travel and hit
                let totalHits = 0;
                const colors = ['#ff0080', '#00ffff', '#ffff00', '#ff00ff'];

                for (let i = 0; i < 8; i++) {
                    setTimeout(() => {
                        const beam = document.createElement('div');
                        const arenaCenter = arena.offsetWidth / 2;
                        let beamX = arenaCenter;
                        let beamY = 140;
                        const color = colors[i % 4];

                        beam.style.cssText = `
                            position: absolute;
                            left: ${beamX}px;
                            top: ${beamY}px;
                            width: 15px;
                            height: 15px;
                            background: ${color};
                            border-radius: 50%;
                            box-shadow: 0 0 10px ${color};
                            z-index: 199;
                        `;
                        arena.appendChild(beam);

                        let hit = false;
                        const moveBeam = setInterval(() => {
                            // Move toward enemy's current position
                            const enemyX = game.dummyX + 25;
                            const enemyY = arena.offsetHeight - 120;
                            const dx = enemyX - beamX;
                            const dy = enemyY - beamY;
                            const dist = Math.sqrt(dx * dx + dy * dy);

                            if (dist > 0) {
                                beamX += (dx / dist) * 15;
                                beamY += (dy / dist) * 15;
                            }

                            beam.style.left = beamX + 'px';
                            beam.style.top = beamY + 'px';

                            // Check if beam hit enemy
                            if (!hit && Math.abs(beamX - enemyX) < 40 && beamY > enemyY - 30) {
                                hit = true;
                                totalHits++;
                                dealDamage(special.damage / 8);
                                beam.style.transform = 'scale(2)';
                                beam.style.opacity = '0';
                                beam.style.transition = 'all 0.2s';
                                setTimeout(() => beam.remove(), 200);
                                clearInterval(moveBeam);
                            } else if (beamY > arena.offsetHeight || beamX < 0 || beamX > arena.offsetWidth) {
                                clearInterval(moveBeam);
                                beam.remove();
                            }
                        }, 25);
                    }, i * 200);
                }

                setTimeout(() => {
                    disco.remove();
                    if (totalHits === 0) {
                        showImpact('DODGED!', '#888');
                    }
                    game.isAttacking = false;
                }, 2000);
            }
        }

        // FRANK - Dr. Frank-N-Furter
        function executeFrankSpecial(special, fighter) {
            const arena = document.getElementById('arena');
            const dummy = document.getElementById('npc-dummy');
            const dummyRect = dummy.getBoundingClientRect();
            const arenaRect = arena.getBoundingClientRect();
            const targetX = dummyRect.left - arenaRect.left;
            const fighterX = parseFloat(fighter.style.left) || game.playerX;

            if (special.name === 'Sweet Transvestite') {
                // Charm attack - CSS hearts that travel toward enemy
                let totalHits = 0;
                let heartsFinished = 0;

                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        const heart = document.createElement('div');
                        heart.style.cssText = `
                            position: absolute;
                            width: 20px;
                            height: 18px;
                            left: ${fighterX + 50}px;
                            bottom: ${100 + (i - 2) * 20}px;
                            z-index: 150;
                            background: #cc0033;
                            transform: rotate(-45deg);
                            filter: drop-shadow(0 0 5px #cc0033);
                        `;
                        // Add heart shape with pseudo-elements via clip-path
                        heart.innerHTML = `<div style="
                            width: 20px; height: 18px;
                            background: #cc0033;
                            clip-path: path('M10 18 C10 18 0 10 0 5 A5 5 0 0 1 10 5 A5 5 0 0 1 20 5 C20 10 10 18 10 18');
                        "></div>`;
                        arena.appendChild(heart);

                        let hx = fighterX + 50;
                        let hit = false;

                        const flyHeart = setInterval(() => {
                            hx += 8;
                            heart.style.left = hx + 'px';

                            // Check against enemy's CURRENT position
                            if (!hit && Math.abs(hx - game.dummyX) < 40) {
                                hit = true;
                                totalHits++;
                                dealDamage(special.damage / 5, totalHits === 1 ? 'SWEET!' : '');
                                dummy.classList.add('charmed');
                                setTimeout(() => dummy.classList.remove('charmed'), 500);
                            }

                            if (hx > 850) {
                                clearInterval(flyHeart);
                                heart.remove();
                                heartsFinished++;
                                if (heartsFinished === 5 && totalHits === 0) {
                                    showImpact('MISSED!', '#888');
                                }
                            }
                        }, 25);

                        setTimeout(() => {
                            clearInterval(flyHeart);
                            heart.remove();
                        }, 1500);
                    }, i * 100);
                }

                setTimeout(() => {
                    game.isAttacking = false;
                }, 800);

            } else if (special.name === 'Lab Lightning') {
                // Tesla coil lightning attack - bolts travel toward enemy
                let totalHits = 0;
                let boltsFinished = 0;

                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        const bolt = document.createElement('div');
                        let boltX = fighterX + 50;
                        bolt.style.cssText = `
                            position: absolute;
                            left: ${boltX}px;
                            bottom: ${70 + (i - 2) * 15}px;
                            width: 30px;
                            height: 8px;
                            background: linear-gradient(90deg, #00ffff, #fff, #00ffff);
                            z-index: 150;
                            filter: drop-shadow(0 0 10px #00ffff);
                            clip-path: polygon(0% 50%, 15% 0%, 30% 50%, 45% 0%, 60% 50%, 75% 0%, 90% 50%, 100% 25%, 100% 75%, 90% 50%, 75% 100%, 60% 50%, 45% 100%, 30% 50%, 15% 100%, 0% 50%);
                        `;
                        arena.appendChild(bolt);

                        let hit = false;
                        const flyBolt = setInterval(() => {
                            boltX += 18;
                            bolt.style.left = boltX + 'px';

                            // Check against enemy's CURRENT position
                            if (!hit && Math.abs(boltX - game.dummyX) < 40) {
                                hit = true;
                                totalHits++;
                                clearInterval(flyBolt);
                                dealDamage(special.damage / 3, totalHits === 1 ? 'ALIVE!' : '');
                                bolt.style.transform = 'scale(1.5)';
                                setTimeout(() => bolt.remove(), 100);
                                boltsFinished++;
                            }

                            if (boltX > 850) {
                                clearInterval(flyBolt);
                                bolt.remove();
                                boltsFinished++;
                                if (boltsFinished === 5 && totalHits === 0) {
                                    showImpact('MISSED!', '#888');
                                }
                            }
                        }, 25);
                    }, i * 100);
                }

                setTimeout(() => {
                    game.isAttacking = false;
                }, 800);

            } else if (special.name === 'Time Warp') {
                // Teleport behind enemy - slower with visible charge

                // Visible charging effect - swirling portal
                const portal = document.createElement('div');
                portal.style.cssText = `
                    position: absolute;
                    left: ${fighterX + 10}px;
                    bottom: 80px;
                    width: 60px;
                    height: 60px;
                    border: 4px solid #cc0033;
                    border-radius: 50%;
                    border-top-color: transparent;
                    animation: portalSpin 0.3s linear infinite;
                    z-index: 150;
                `;
                arena.appendChild(portal);

                // Slow fade out
                fighter.style.transition = 'opacity 0.5s';
                fighter.style.opacity = '0.3';

                // Longer delay for enemy to react
                setTimeout(() => {
                    portal.remove();
                    fighter.style.opacity = '0';

                    setTimeout(() => {
                        // Teleport behind dummy
                        game.playerX = targetX + 80;
                        fighter.style.left = game.playerX + 'px';
                        fighter.style.transition = '';
                        fighter.style.opacity = '1';

                        // Afterimage effect
                        const afterimage = document.createElement('div');
                        afterimage.style.cssText = `
                            position: absolute;
                            left: ${fighterX}px;
                            bottom: 60px;
                            width: 50px;
                            height: 80px;
                            background: linear-gradient(180deg, #cc0033, transparent);
                            opacity: 0.5;
                            z-index: 100;
                            animation: fadeOut 0.5s forwards;
                        `;
                        arena.appendChild(afterimage);
                        setTimeout(() => afterimage.remove(), 500);

                        game.isAttacking = false;
                    }, 200);
                }, 600);

            } else if (special.name === 'FLOOR SHOW!') {
                // Ultimate: Full performance with proper hit detection

                // Spotlight effect follows the show
                const spotlight = document.createElement('div');
                spotlight.style.cssText = `
                    position: absolute;
                    left: 0;
                    top: 0;
                    right: 0;
                    bottom: 0;
                    background: radial-gradient(circle at ${fighterX + 30}px 100px,
                        transparent 50px, rgba(0,0,0,0.8) 200px);
                    z-index: 180;
                    animation: spotlightPulse 0.5s ease-in-out infinite;
                `;
                arena.appendChild(spotlight);

                // Stage effects - each travels toward enemy as a projectile
                const effectColors = ['#cc0033', '#ff69b4', '#ffd700', '#cc0033', '#fff'];
                const clipPaths = [
                    'polygon(50% 0%, 0% 100%, 100% 100%)',
                    'polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%)',
                    'polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%)',
                    'polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%)',
                    'polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%)'
                ];

                let totalHits = 0;
                let effectsLaunched = 0;
                let effectsFinished = 0;

                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        effectsLaunched++;
                        const el = document.createElement('div');
                        let effectX = fighterX + 60;
                        const effectY = 120 + (i % 3) * 30; // Varied heights

                        el.style.cssText = `
                            position: absolute;
                            width: 40px;
                            height: 40px;
                            left: ${effectX}px;
                            bottom: ${effectY}px;
                            z-index: 200;
                            background: ${effectColors[i]};
                            clip-path: ${clipPaths[i]};
                            box-shadow: 0 0 20px ${effectColors[i]};
                            transition: transform 0.1s;
                        `;
                        arena.appendChild(el);

                        let hit = false;
                        let rotation = 0;
                        const speed = 12 + i * 2; // Varying speeds

                        const flyEffect = setInterval(() => {
                            effectX += speed;
                            rotation += 20;
                            el.style.left = effectX + 'px';
                            el.style.transform = `rotate(${rotation}deg)`;

                            // Check if effect hits enemy's current position
                            if (!hit && Math.abs(effectX - game.dummyX) < 45) {
                                hit = true;
                                totalHits++;
                                dealDamage(special.damage / 5, '');
                                el.style.transform = `rotate(${rotation}deg) scale(1.5)`;
                                el.style.opacity = '0.8';
                            }

                            // Effect goes off screen
                            if (effectX > 850) {
                                clearInterval(flyEffect);
                                el.remove();
                                effectsFinished++;

                                // All effects done - show result
                                if (effectsFinished === 5) {
                                    spotlight.remove();
                                    if (totalHits > 0) {
                                        showImpact('FABULOUS!', '#ffd700');
                                    } else {
                                        showImpact('MISSED!', '#888');
                                    }
                                    game.isAttacking = false;
                                }
                            }
                        }, 30);
                    }, i * 250);
                }
            }
        }

        // CHARLY - The Biker
        function executeCharlySpecial(special, fighter) {
            const arena = document.getElementById('arena');
            const dummy = document.getElementById('npc-dummy');
            const dummyRect = dummy.getBoundingClientRect();
            const arenaRect = arena.getBoundingClientRect();
            const targetX = dummyRect.left - arenaRect.left;
            const fighterX = parseFloat(fighter.style.left) || game.playerX;

            if (special.name === 'Wheelie Strike') {
                // Pop a wheelie and charge forward - must reach enemy to hit
                fighter.classList.add('wheelie');

                const startX = fighterX;
                let x = startX;
                let hit = false;

                const charge = setInterval(() => {
                    x += 15;
                    fighter.style.left = x + 'px';

                    // Tire marks
                    const mark = document.createElement('div');
                    mark.style.cssText = `
                        position: absolute;
                        left: ${x - 10}px;
                        bottom: 60px;
                        width: 20px;
                        height: 3px;
                        background: #333;
                        opacity: 0.5;
                        z-index: 50;
                    `;
                    arena.appendChild(mark);
                    setTimeout(() => mark.remove(), 500);

                    // Check against enemy's CURRENT position
                    if (!hit && Math.abs(x - game.dummyX) < 50) {
                        hit = true;
                        clearInterval(charge);
                        dealDamage(special.damage, 'WHEELIE!');
                        game.playerX = x;
                        fighter.classList.remove('wheelie');
                        game.isAttacking = false;
                    } else if (x > 750) {
                        // Went too far without hitting
                        clearInterval(charge);
                        game.playerX = x;
                        fighter.classList.remove('wheelie');
                        if (!hit) {
                            showImpact('MISSED!', '#888');
                        }
                        game.isAttacking = false;
                    }
                }, 30);

            } else if (special.name === 'Excel Throw') {
                // Throw spreadsheets as projectiles - must hit enemy
                let totalHits = 0;
                let sheetsFinished = 0;

                for (let i = 0; i < 3; i++) {
                    setTimeout(() => {
                        const proj = document.createElement('div');
                        proj.innerHTML = `
                            <div style="
                                width: 30px;
                                height: 35px;
                                background: #fff;
                                border: 2px solid #217346;
                                border-radius: 2px;
                                display: grid;
                                grid-template-columns: repeat(3, 1fr);
                                grid-template-rows: repeat(4, 1fr);
                                gap: 1px;
                                padding: 2px;
                            ">
                                ${Array(12).fill('<div style="background:#217346;opacity:0.3;"></div>').join('')}
                            </div>
                        `;
                        proj.style.cssText = `
                            position: absolute;
                            left: ${fighterX + 60}px;
                            bottom: ${100 + i * 25}px;
                            z-index: 150;
                        `;
                        arena.appendChild(proj);

                        let px = fighterX + 60;
                        let rotation = 0;
                        let hit = false;

                        const fly = setInterval(() => {
                            px += 12;
                            rotation += 15;
                            proj.style.left = px + 'px';
                            proj.style.transform = `rotate(${rotation}deg)`;

                            // Check against enemy's CURRENT position
                            if (!hit && Math.abs(px - game.dummyX) < 45) {
                                hit = true;
                                totalHits++;
                                clearInterval(fly);
                                dealDamage(special.damage / 3, totalHits === 1 ? 'EXCEL!' : '');
                                proj.remove();
                                sheetsFinished++;
                            } else if (px > 850) {
                                clearInterval(fly);
                                proj.remove();
                                sheetsFinished++;
                                // Show missed after all sheets are done
                                if (sheetsFinished === 3 && totalHits === 0) {
                                    showImpact('MISSED!', '#888');
                                }
                            }
                        }, 25);
                    }, i * 150);
                }

                setTimeout(() => {
                    game.isAttacking = false;
                }, 800);

            } else if (special.name === 'Rev Bomb') {
                // Rev engine and create expanding shockwave

                // Engine revving effect
                const revs = 5;
                for (let i = 0; i < revs; i++) {
                    setTimeout(() => {
                        const smoke = document.createElement('div');
                        smoke.style.cssText = `
                            position: absolute;
                            left: ${fighterX - 20}px;
                            bottom: 60px;
                            width: 30px;
                            height: 30px;
                            background: radial-gradient(circle, #666, transparent);
                            border-radius: 50%;
                            z-index: 100;
                            animation: smokePuff 0.5s ease-out forwards;
                        `;
                        arena.appendChild(smoke);
                        setTimeout(() => smoke.remove(), 500);
                    }, i * 100);
                }

                // Shockwave that expands and checks enemy position
                setTimeout(() => {
                    const wave = document.createElement('div');
                    let waveRadius = 10;
                    let hit = false;
                    const waveCenter = fighterX + 30;

                    wave.style.cssText = `
                        position: absolute;
                        left: ${waveCenter - waveRadius}px;
                        bottom: ${60 - waveRadius/2}px;
                        width: ${waveRadius * 2}px;
                        height: ${waveRadius}px;
                        border: 3px solid #c0392b;
                        border-radius: 50%;
                        z-index: 150;
                        box-shadow: 0 0 10px #c0392b;
                    `;
                    arena.appendChild(wave);

                    const expand = setInterval(() => {
                        waveRadius += 12;
                        wave.style.width = (waveRadius * 2) + 'px';
                        wave.style.height = waveRadius + 'px';
                        wave.style.left = (waveCenter - waveRadius) + 'px';
                        wave.style.bottom = (60 - waveRadius/2) + 'px';
                        wave.style.opacity = Math.max(0, 1 - waveRadius / 300);

                        // Check if expanding wave reaches enemy's current position
                        const distanceToEnemy = Math.abs(game.dummyX - waveCenter);
                        if (!hit && distanceToEnemy < waveRadius + 30 && distanceToEnemy > waveRadius - 30) {
                            hit = true;
                            dealDamage(special.damage, 'VROOM!');
                        }

                        if (waveRadius > 350) {
                            clearInterval(expand);
                            wave.remove();
                            if (!hit) {
                                showImpact('MISSED!', '#888');
                            }
                            game.isAttacking = false;
                        }
                    }, 25);
                }, 500);

            } else if (special.name === 'HIGHWAY TO HELL!') {
                // Ultimate: Full speed charge with fire trail - must hit enemy
                fighter.classList.add('burning');
                const startX = fighterX;
                let x = startX;
                let totalHits = 0;
                let hitOnFirstPass = false;
                let hitOnSecondPass = false;

                // Fire trail - CSS flames
                const fireInterval = setInterval(() => {
                    const fire = document.createElement('div');
                    fire.style.cssText = `
                        position: absolute;
                        width: 20px;
                        height: 30px;
                        left: ${x - 30}px;
                        bottom: ${50 + Math.random() * 20}px;
                        z-index: 100;
                        background: linear-gradient(0deg, #ff4500 0%, #ff6600 40%, #ffcc00 70%, transparent 100%);
                        border-radius: 50% 50% 20% 20%;
                        filter: blur(2px);
                        animation: fireTrail 0.5s ease-out forwards;
                    `;
                    arena.appendChild(fire);
                    setTimeout(() => fire.remove(), 500);
                }, 50);

                const charge = setInterval(() => {
                    x += 20;
                    fighter.style.left = x + 'px';

                    // Check against enemy's CURRENT position
                    if (!hitOnFirstPass && Math.abs(x - game.dummyX) < 50) {
                        hitOnFirstPass = true;
                        totalHits++;
                        dealDamage(special.damage / 2, 'HIGHWAY!');
                    }

                    if (x > 800) {
                        clearInterval(charge);
                        clearInterval(fireInterval);

                        // Return from other side
                        x = -50;
                        fighter.style.left = x + 'px';

                        const returnCharge = setInterval(() => {
                            x += 25;
                            fighter.style.left = x + 'px';

                            // Check against enemy's CURRENT position on return
                            if (!hitOnSecondPass && Math.abs(x - game.dummyX) < 50) {
                                hitOnSecondPass = true;
                                totalHits++;
                                dealDamage(special.damage / 2, 'TO HELL!');
                            }

                            if (x >= startX) {
                                clearInterval(returnCharge);
                                game.playerX = startX;
                                fighter.style.left = startX + 'px';
                                fighter.classList.remove('burning');
                                if (totalHits === 0) {
                                    showImpact('MISSED!', '#888');
                                }
                                game.isAttacking = false;
                            }
                        }, 25);
                    }
                }, 25);
            }
        }

        // AUDREY II - Man-Eating Plant
        function executeAudreySpecial(special, fighter) {
            const arena = document.getElementById('arena');
            const dummy = document.getElementById('npc-dummy');
            const dummyRect = dummy.getBoundingClientRect();
            const arenaRect = arena.getBoundingClientRect();
            const targetX = dummyRect.left - arenaRect.left;
            const fighterX = parseFloat(fighter.style.left) || game.playerX;

            if (special.name === 'Vine Whip') {
                // Extend segmented vine with thorns - must reach enemy
                fighter.classList.add('attacking');

                const vineContainer = document.createElement('div');
                vineContainer.style.cssText = `
                    position: absolute;
                    left: ${fighterX + 40}px;
                    bottom: 95px;
                    z-index: 150;
                `;
                arena.appendChild(vineContainer);

                let segments = 0;
                let hit = false;
                const maxSegments = 15;

                const extend = setInterval(() => {
                    if (segments < maxSegments) {
                        // Add vine segment
                        const segment = document.createElement('div');
                        const yOffset = Math.sin(segments * 0.5) * 8;
                        segment.style.cssText = `
                            position: absolute;
                            left: ${segments * 25}px;
                            top: ${yOffset}px;
                            width: 28px;
                            height: 6px;
                            background: linear-gradient(90deg, #1a5c1a, #228b22, #32cd32);
                            border-radius: 3px;
                            transform: rotate(${Math.sin(segments * 0.4) * 5}deg);
                        `;
                        vineContainer.appendChild(segment);

                        // Add thorn every 3rd segment
                        if (segments % 3 === 0) {
                            const thorn = document.createElement('div');
                            thorn.style.cssText = `
                                position: absolute;
                                left: ${segments * 25 + 10}px;
                                top: ${yOffset - 8}px;
                                width: 0;
                                height: 0;
                                border-left: 4px solid transparent;
                                border-right: 4px solid transparent;
                                border-bottom: 10px solid #1a5c1a;
                            `;
                            vineContainer.appendChild(thorn);
                        }

                        segments++;

                        // Check for hit against enemy's CURRENT position
                        const vineEndX = fighterX + 40 + segments * 25;
                        if (!hit && Math.abs(vineEndX - game.dummyX) < 40) {
                            hit = true;
                            dealDamage(special.damage, 'WHIP!');
                        }
                    } else {
                        clearInterval(extend);
                        if (!hit) {
                            showImpact('MISSED!', '#888');
                        }
                        // Retract
                        setTimeout(() => {
                            vineContainer.style.transition = 'opacity 0.3s';
                            vineContainer.style.opacity = '0';
                            setTimeout(() => {
                                vineContainer.remove();
                                fighter.classList.remove('attacking');
                                game.isAttacking = false;
                            }, 300);
                        }, 200);
                    }
                }, 30);

            } else if (special.name === 'Feed Me!') {
                // Lunge and bite attack - must reach enemy
                fighter.classList.add('biting');

                const startX = fighterX;
                let x = startX;
                let hit = false;

                // Lunge forward
                const lunge = setInterval(() => {
                    x += 12;
                    fighter.style.left = x + 'px';

                    // Check against enemy's CURRENT position
                    if (!hit && Math.abs(x - game.dummyX) < 45) {
                        hit = true;
                        clearInterval(lunge);
                        dealDamage(special.damage, 'CHOMP!');

                        // Chomp animation
                        setTimeout(() => {
                            fighter.classList.remove('biting');

                            // Return to position
                            const returnInterval = setInterval(() => {
                                x -= 10;
                                fighter.style.left = x + 'px';
                                if (x <= startX) {
                                    clearInterval(returnInterval);
                                    game.playerX = startX;
                                    fighter.style.left = startX + 'px';
                                    game.isAttacking = false;
                                }
                            }, 30);
                        }, 300);
                    } else if (x > 750) {
                        // Went too far without hitting
                        clearInterval(lunge);
                        fighter.classList.remove('biting');
                        if (!hit) {
                            showImpact('MISSED!', '#888');
                        }
                        game.playerX = x;
                        game.isAttacking = false;
                    }
                }, 30);

            } else if (special.name === 'Siren Song') {
                // Audrey II sings - musical notes fly toward enemy
                let totalHits = 0;
                let notesFinished = 0;
                const noteSymbols = ['', '', '', '', ''];

                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        const note = document.createElement('div');
                        const waveHeight = Math.sin(i * 0.8) * 20;
                        note.textContent = noteSymbols[i];
                        note.style.cssText = `
                            position: absolute;
                            left: ${fighterX + 50}px;
                            bottom: ${110 + waveHeight}px;
                            font-size: 24px;
                            color: #228b22;
                            text-shadow: 0 0 8px #32cd32, 0 0 15px #7fff00;
                            z-index: 150;
                        `;
                        arena.appendChild(note);

                        let nx = fighterX + 50;
                        let wave = 0;
                        let hit = false;

                        const fly = setInterval(() => {
                            nx += 10;
                            wave += 0.3;
                            note.style.left = nx + 'px';
                            note.style.bottom = (110 + Math.sin(wave) * 25) + 'px';
                            note.style.transform = `rotate(${Math.sin(wave) * 15}deg)`;

                            // Check against enemy's CURRENT position
                            if (!hit && Math.abs(nx - game.dummyX) < 40) {
                                hit = true;
                                totalHits++;
                                clearInterval(fly);
                                dealDamage(special.damage / 5, totalHits === 1 ? 'SING!' : '');

                                // Note burst effect
                                note.style.transform = 'scale(1.5)';
                                note.style.opacity = '0';
                                note.style.transition = 'all 0.2s';
                                setTimeout(() => note.remove(), 200);
                                notesFinished++;
                            } else if (nx > 850) {
                                clearInterval(fly);
                                note.remove();
                                notesFinished++;
                                // Show missed after all notes
                                if (notesFinished === 5 && totalHits === 0) {
                                    showImpact('MISSED!', '#888');
                                }
                            }
                        }, 25);
                    }, i * 120);
                }

                setTimeout(() => {
                    game.isAttacking = false;
                }, 900);

            } else if (special.name === 'MEAN GREEN MOTHER!') {
                // Ultimate: Grow massive and attack with extending tentacles

                // Grow animation
                fighter.style.transform = 'scale(1)';
                fighter.style.transition = 'transform 0.5s';

                setTimeout(() => {
                    fighter.style.transform = 'scale(2)';
                }, 100);

                // Tentacles attack - each extends toward enemy
                let totalHits = 0;
                let tentaclesFinished = 0;
                const tentacleAngles = [-50, -35, -20, -5, 10, 25, 40, 55];

                for (let i = 0; i < 8; i++) {
                    setTimeout(() => {
                        const tentacle = document.createElement('div');
                        const baseAngle = tentacleAngles[i];
                        const startX = fighterX + 30;
                        const startY = 80;
                        let tentacleLength = 20;
                        let hit = false;

                        tentacle.style.cssText = `
                            position: absolute;
                            left: ${startX}px;
                            bottom: ${startY}px;
                            width: ${tentacleLength}px;
                            height: 15px;
                            background: linear-gradient(90deg, #228b22, #32cd32, #90ee90);
                            border-radius: 8px;
                            transform-origin: left center;
                            transform: rotate(${baseAngle}deg);
                            z-index: 150;
                        `;
                        arena.appendChild(tentacle);

                        // Tentacle extends toward enemy
                        const extend = setInterval(() => {
                            tentacleLength += 15;
                            tentacle.style.width = tentacleLength + 'px';

                            // Calculate tentacle tip position
                            const angleRad = baseAngle * Math.PI / 180;
                            const tipX = startX + tentacleLength * Math.cos(angleRad);
                            const tipY = startY + tentacleLength * Math.sin(angleRad);

                            // Check if tip hits enemy (enemy is at ground level ~60-120px)
                            const enemyBottom = 60;
                            const enemyTop = 120;
                            if (!hit && Math.abs(tipX - game.dummyX) < 50 && tipY >= -30 && tipY <= 80) {
                                hit = true;
                                totalHits++;
                                dealDamage(special.damage / 8, '');
                                tentacle.style.background = 'linear-gradient(90deg, #228b22, #ff4444, #ff6666)';
                            }

                            // Tentacle reaches max length
                            if (tentacleLength >= 350) {
                                clearInterval(extend);
                                setTimeout(() => {
                                    tentacle.style.opacity = '0';
                                    tentacle.style.transition = 'opacity 0.3s';
                                    setTimeout(() => tentacle.remove(), 300);
                                    tentaclesFinished++;

                                    // All tentacles done
                                    if (tentaclesFinished === 8) {
                                        if (totalHits > 0) {
                                            showImpact('FEED ME!', '#228b22');
                                        } else {
                                            showImpact('MISSED!', '#888');
                                        }
                                    }
                                }, 100);
                            }
                        }, 25);
                    }, i * 150);
                }

                setTimeout(() => {
                    fighter.style.transform = 'scale(1)';
                    setTimeout(() => {
                        fighter.style.transition = '';
                        game.isAttacking = false;
                    }, 500);
                }, 2500);
            }
        }

        function showResult(text) {
            document.getElementById('result-text').textContent = text;
            document.getElementById('result-overlay').classList.add('show');
        }

        function restartGame() {
            document.getElementById('result-overlay').classList.remove('show');
            game.dummyHealth = 200;
            game.playerHealth = 100;
            game.playerEnergy = 0;
            game.playerX = 100;

            // Reset dummy position
            game.dummyX = 650;
            game.dummyTargetX = 650;
            game.dummyMoveTimer = 0;

            const fighter = document.getElementById('player-fighter');
            if (fighter) {
                fighter.style.left = game.playerX + 'px';
                fighter.className = 'fighter ' + game.selectedCharacter + ' idle';
            }

            const dummy = document.getElementById('npc-dummy');
            if (dummy) {
                dummy.style.left = game.dummyX + 'px';
                dummy.classList.remove('frozen', 'burning', 'stunned');
            }

            updateUI();
        }
    </script>

    <!-- Tournament Mode Scripts -->
    <script src="tournament.js"></script>
    <script src="backgrounds.js"></script>
    <script src="opponent-ai.js"></script>
    <script src="game-controller.js"></script>
    <script src="tournament-integration.js"></script>
</body>
</html>
